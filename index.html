<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aridago - Boutique et Devis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <style>
        body { font-family: 'Manrope', sans-serif; background: linear-gradient(to bottom, #FFFBEB, #f7fafc); }
        .font-poppins { font-family: 'Poppins', sans-serif; }
        .theme-gradient-text { background: linear-gradient(90deg, #d92a2a, #f7b731); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .theme-gradient-bg { background: linear-gradient(90deg, #d92a2a, #f7b731); }
        .btn-primary { background: linear-gradient(90deg, #2ab57d, #2a9d8f); }
        .modal-backdrop { background-color: rgba(0,0,0,0.6); }
        .nav-link { padding: 8px 16px; border-radius: 9999px; transition: all 0.3s; font-weight: 600; border: 2px solid transparent; }
        .nav-link.active { border-color: #f7b731; background-color: white; color: #d92a2a; }
        .nav-link:not(.active):hover { background-color: rgba(255,255,255,0.2); }
        .thumbnail.active { border-color: #f7b731; box-shadow: 0 0 8px #f7b731; }
    </style>
</head>
<body>

    <div class="container mx-auto max-w-5xl p-4 md:p-8">
        
        <header class="text-center mb-10">
            <img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="mx-auto h-36 w-auto mb-6">
            <nav class="theme-gradient-bg p-2 rounded-full max-w-md mx-auto flex justify-center items-center space-x-2 text-white shadow-md">
                <button id="nav-boutique" class="nav-link active">Boutique</button>
                <button id="nav-devis" class="nav-link">Devis sur Mesure</button>
            </nav>
        </header>

        <!-- ================== SECTION BOUTIQUE (GRILLE) ================== -->
        <div id="boutique-section">
            <div class="text-center mb-12">
                 <h1 class="font-poppins text-3xl md:text-4xl font-extrabold text-gray-800">Nos Produits du Moment</h1>
                 <p class="mt-2 text-lg text-gray-600">Commandez directement nos articles sélectionnés pour vous.</p>
                 <div class="mt-6 max-w-lg mx-auto">
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 flex items-center pl-4">
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </span>
                        <input type="text" id="search-bar" placeholder="Rechercher un produit..." class="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-yellow-400 transition">
                    </div>
                 </div>
            </div>
            <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <p id="loading-products" class="text-center text-gray-500 col-span-full">Chargement des produits...</p>
            </div>
        </div>
        
        <!-- ================== SECTION PAGE PRODUIT ================== -->
        <div id="product-detail-section" class="hidden bg-white p-6 md:p-10 rounded-3xl shadow-lg"></div>

        <!-- ================== SECTION DEVIS SUR MESURE ================== -->
        <div id="devis-section" class="hidden">
            <div class="text-center mb-12">
                 <h1 class="font-poppins text-4xl md:text-5xl font-extrabold text-gray-800 leading-tight">
                    Commander en Chine ?<br>C'est maintenant <span class="theme-gradient-text">simple et rapide !</span>
                </h1>
                <p class="mt-4 text-lg text-gray-600 max-w-2xl mx-auto">
                    Remplissez ce formulaire pour recevoir votre devis personnalisé directement sur WhatsApp.
                </p>
             </div>
             <section class="mb-12">
                 <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="bg-white p-6 rounded-2xl shadow-sm">
                        <div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">1</div>
                        <h3 class="font-bold text-lg text-gray-800">Remplissez le formulaire</h3>
                        <p class="text-gray-500 text-sm mt-1">Ajoutez les liens et détails de tous vos produits.</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm">
                        <div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">2</div>
                        <h3 class="font-bold text-lg text-gray-800">Envoyez via WhatsApp</h3>
                        <p class="text-gray-500 text-sm mt-1">Un clic suffit pour nous transmettre votre demande.</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm">
                        <div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">3</div>
                        <h3 class="font-bold text-lg text-gray-800">Recevez la confirmation</h3>
                        <p class="text-gray-500 text-sm mt-1">Nous vérifions et validons la commande avec vous.</p>
                    </div>
                </div>
            </section>
             <main class="bg-white p-6 md:p-10 rounded-3xl shadow-lg">
                <form id="devis-form">
                    <fieldset class="border-b-2 border-gray-100 pb-8">
                        <legend class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="theme-gradient-bg w-10 h-10 flex items-center justify-center rounded-full text-white font-bold mr-4">1</span> Vos informations
                        </legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                            <div><label for="nom" class="block text-sm font-semibold text-gray-600 mb-1">Nom</label><input type="text" id="nom" name="nom" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                            <div><label for="prenom" class="block text-sm font-semibold text-gray-600 mb-1">Prénom</label><input type="text" id="prenom" name="prenom" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                            <div><label for="whatsapp" class="block text-sm font-semibold text-gray-600 mb-1">Numéro WhatsApp</label><input type="tel" id="whatsapp" name="whatsapp" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                            <div><label for="email" class="block text-sm font-semibold text-gray-600 mb-1">Email (Optionnel)</label><input type="email" id="email" name="email" class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                        </div>
                    </fieldset>
                    <fieldset class="mt-8">
                        <legend class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="theme-gradient-bg w-10 h-10 flex items-center justify-center rounded-full text-white font-bold mr-4">2</span> Vos produits
                        </legend>
                        <div id="product-list" class="space-y-6"></div>
                        <div class="mt-6"><button type="button" id="add-product" class="w-full flex items-center justify-center px-6 py-3 border-2 border-dashed border-red-300 text-sm font-semibold rounded-xl text-red-600 hover:bg-red-50 transition"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>Ajouter un autre produit</button></div>
                    </fieldset>
                    <div class="mt-10 text-center">
                        <button type="submit" class="inline-flex justify-center items-center py-4 px-16 text-lg font-bold rounded-xl text-white btn-primary shadow-lg hover:shadow-xl transform hover:scale-105 transition animate-pulse">
                            <ion-icon name="logo-whatsapp" class="mr-3 text-2xl"></ion-icon>
                            Envoyer ma demande
                        </button>
                    </div>
                </form>
            </main>
        </div>

        <!-- ================== SECTION ADMIN ================== -->
        <div id="admin-section" class="hidden mt-12 bg-gray-800 text-white p-6 md:p-10 rounded-3xl shadow-lg">
            <div id="admin-login">
                <h2 class="font-poppins text-3xl font-bold text-center mb-4">Accès Administrateur</h2>
                <div class="max-w-sm mx-auto">
                    <div class="mb-4">
                        <label for="admin-email" class="block text-sm font-semibold mb-1">Email</label>
                        <input type="email" id="admin-email" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-yellow-400 transition">
                    </div>
                    <div class="mb-4">
                        <label for="admin-password" class="block text-sm font-semibold mb-1">Mot de passe</label>
                        <input type="password" id="admin-password" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-yellow-400 transition">
                    </div>
                    <button id="admin-login-btn" class="mt-4 w-full btn-primary font-bold py-3 px-4 rounded-xl">Se connecter</button>
                    <p id="admin-error" class="text-red-400 text-center mt-2 hidden"></p>
                </div>
            </div>

            <div id="admin-dashboard" class="hidden">
                <h2 class="font-poppins text-3xl font-bold mb-6">Tableau de bord</h2>
                <div class="bg-gray-700 p-6 rounded-2xl mb-8">
                    <h3 id="admin-form-title" class="text-xl font-bold mb-4">Ajouter un nouveau produit</h3>
                    <form id="admin-product-form" class="space-y-4">
                        <input type="hidden" id="product-id">
                        <div><label class="block text-sm font-semibold mb-1">Nom du produit</label><input type="text" id="product-name" required class="w-full bg-gray-600 rounded-lg p-2 text-white"></div>
                        <div><label class="block text-sm font-semibold mb-1">Description</label><textarea id="product-description" required class="w-full bg-gray-600 rounded-lg p-2 text-white" rows="2"></textarea></div>
                        <div><label class="block text-sm font-semibold mb-1">Prix (en Ar)</label><input type="number" id="product-price" required class="w-full bg-gray-600 rounded-lg p-2 text-white"></div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Image(s) du produit</label>
                            <div class="flex flex-wrap gap-2 mt-2 items-center">
                                <div id="image-preview-container" class="flex flex-wrap gap-2"></div>
                                <label for="product-image-upload" class="cursor-pointer w-16 h-16 bg-gray-600 rounded flex items-center justify-center text-gray-400 hover:bg-gray-500 hover:text-white transition" title="Ajouter des images">
                                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                </label>
                            </div>
                            <input type="file" id="product-image-upload" multiple accept="image/*" class="hidden">
                            <input type="hidden" id="product-images-json">
                            <p id="upload-status" class="text-sm text-yellow-400 mt-1"></p>
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" id="admin-submit-btn" class="w-full btn-primary font-bold py-2 px-4 rounded-lg disabled:opacity-50">Ajouter le produit</button>
                            <button type="button" id="admin-cancel-btn" class="w-full bg-gray-500 font-bold py-2 px-4 rounded-lg hidden">Annuler</button>
                        </div>
                    </form>
                </div>
                <div>
                     <h3 class="text-xl font-bold mb-4">Produits existants</h3>
                     <div id="admin-product-list" class="space-y-4"></div>
                </div>
                 <button id="admin-logout-btn" class="mt-8 bg-red-600 font-bold py-2 px-4 rounded-lg mr-4">Se déconnecter</button>
            </div>
        </div>
        
        <footer class="mt-12 text-center text-gray-500 text-sm">
             <p>&copy; <span id="year"></span> Aridago - Tous droits réservés. <button id="admin-link" class="ml-1 underline text-gray-400 hover:text-gray-600">Admin</button></p>
        </footer>
    </div>
    
    <!-- BOUTON FLOTTANT FACEBOOK -->
    <a href="https://www.facebook.com/Aridagochine/" target="_blank" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-xl transform hover:scale-110 transition" title="Contactez-nous sur Facebook">
        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z"/></svg>
    </a>

    <!-- SDKs Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBa93ZQ34S4JEz6lc7yt_2ZrIiTc2Jqh9c",
      authDomain: "boutique-aridago.firebaseapp.com",
      projectId: "boutique-aridago",
      storageBucket: "boutique-aridago.appspot.com",
      messagingSenderId: "173722302642",
      appId: "1:173722302642:web:1cad436874f3b4270eb1ab"
    };

    // Initialisation de Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const productsCollection = db.collection('products');


document.addEventListener('DOMContentLoaded', function() {
    let boutiqueProducts = [];
    const productGrid = document.getElementById('product-grid');
    const loadingText = document.getElementById('loading-products');
    
    async function loadAndRenderProducts() {
        try {
            const snapshot = await productsCollection.orderBy("name").get();
            loadingText.style.display = 'none';
            boutiqueProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderBoutique();
            if (auth.currentUser) {
                renderAdminList();
            }
        } catch (error) {
            console.error("Erreur de chargement: ", error);
            loadingText.textContent = 'Erreur de chargement des produits.';
        }
    }

    loadAndRenderProducts();
    
    document.getElementById('year').textContent = new Date().getFullYear();

    const navBoutique = document.getElementById('nav-boutique');
    const navDevis = document.getElementById('nav-devis');

    function switchView(view) {
        document.getElementById('boutique-section').classList.toggle('hidden', view !== 'boutique');
        document.getElementById('devis-section').classList.toggle('hidden', view !== 'devis');
        document.getElementById('admin-section').classList.toggle('hidden', view !== 'admin');
        document.getElementById('product-detail-section').classList.toggle('hidden', view !== 'detail');
        navBoutique.classList.toggle('active', view === 'boutique' || view === 'detail');
        navDevis.classList.toggle('active', view === 'devis');
    }

    navBoutique.addEventListener('click', () => {
        switchView('boutique');
    });
    navDevis.addEventListener('click', () => switchView('devis'));

    // ================== LOGIQUE ADMIN AVEC AUTH ==================
    const IMGBB_API_KEY = '7dfb12ff69d1e1f349a28e4a788f2c1d';
    const adminLink = document.getElementById('admin-link');
    const adminLogin = document.getElementById('admin-login');
    const adminDashboard = document.getElementById('admin-dashboard');
    const adminEmailInput = document.getElementById('admin-email');
    const adminPasswordInput = document.getElementById('admin-password');
    const adminLoginBtn = document.getElementById('admin-login-btn');
    const adminError = document.getElementById('admin-error');
    const adminLogoutBtn = document.getElementById('admin-logout-btn');
    const adminProductForm = document.getElementById('admin-product-form');
    const adminProductList = document.getElementById('admin-product-list');

    auth.onAuthStateChanged(user => {
        if (user) {
            adminLogin.classList.add('hidden');
            adminDashboard.classList.remove('hidden');
            renderAdminList();
        } else {
            adminLogin.classList.remove('hidden');
            adminDashboard.classList.add('hidden');
        }
    });

    adminLink.addEventListener('click', () => switchView('admin'));

    adminLoginBtn.addEventListener('click', () => {
        const email = adminEmailInput.value;
        const password = adminPasswordInput.value;
        auth.signInWithEmailAndPassword(email, password)
            .catch(error => {
                adminError.textContent = "Email ou mot de passe incorrect.";
                adminError.classList.remove('hidden');
            });
    });

    adminLogoutBtn.addEventListener('click', () => {
        auth.signOut();
        switchView('boutique');
    });

    const productImageUpload = document.getElementById('product-image-upload');
    const uploadStatus = document.getElementById('upload-status');
    const hiddenImagesJson = document.getElementById('product-images-json');
    const imagePreviewContainer = document.getElementById('image-preview-container');

    async function uploadToImgBB(file) {
        const formData = new FormData();
        formData.append('image', file);
        const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData });
        if (!response.ok) throw new Error('Échec du téléversement');
        const data = await response.json();
        return data.data.url;
    }

    productImageUpload.addEventListener('change', async (e) => {
        const files = e.target.files;
        if (!files.length) return;
        uploadStatus.textContent = `Téléversement de ${files.length} image(s)...`;
        document.getElementById('admin-submit-btn').disabled = true;
        
        let currentImages = hiddenImagesJson.value ? JSON.parse(hiddenImagesJson.value) : [];

        try {
            const uploadPromises = Array.from(files).map(uploadToImgBB);
            const imageUrls = await Promise.all(uploadPromises);
            currentImages.push(...imageUrls);
            hiddenImagesJson.value = JSON.stringify(currentImages);
            renderImagePreviews(currentImages);
            uploadStatus.textContent = `${currentImages.length} image(s) prête(s).`;
        } catch (error) {
            uploadStatus.textContent = `Erreur: ${error.message}`;
        } finally {
            document.getElementById('admin-submit-btn').disabled = false;
            e.target.value = '';
        }
    });

    function renderImagePreviews(images) {
        imagePreviewContainer.innerHTML = '';
        images.forEach((imgUrl, index) => {
            imagePreviewContainer.innerHTML += `<div class="relative"><img src="${imgUrl}" class="w-16 h-16 object-cover rounded"><button type="button" class="absolute -top-1 -right-1 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold delete-img-btn" data-index="${index}">&times;</button></div>`;
        });
        document.querySelectorAll('.delete-img-btn').forEach(btn => btn.addEventListener('click', (e) => {
            const index = parseInt(e.currentTarget.dataset.index, 10);
            let currentImages = JSON.parse(hiddenImagesJson.value);
            currentImages.splice(index, 1);
            hiddenImagesJson.value = JSON.stringify(currentImages);
            renderImagePreviews(currentImages);
        }));
    }

    const adminFormTitle = document.getElementById('admin-form-title');
    const adminSubmitBtn = document.getElementById('admin-submit-btn');
    const adminCancelBtn = document.getElementById('admin-cancel-btn');
    
    adminProductForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('product-id').value;
        const productData = {
            name: document.getElementById('product-name').value,
            description: document.getElementById('product-description').value,
            price: parseFloat(document.getElementById('product-price').value),
            images: JSON.parse(hiddenImagesJson.value || '[]')
        };

        adminSubmitBtn.disabled = true;
        try {
            if (id) {
                await productsCollection.doc(id).update(productData);
            } else {
                await productsCollection.add(productData);
            }
            resetAdminForm();
            await loadAndRenderProducts();
        } catch (error) {
            console.error("Erreur d'écriture Firestore: ", error);
            alert("Une erreur s'est produite.");
        } finally {
            adminSubmitBtn.disabled = false;
        }
    });

    adminCancelBtn.addEventListener('click', resetAdminForm);

    function resetAdminForm() {
        adminProductForm.reset();
        document.getElementById('product-id').value = '';
        hiddenImagesJson.value = '[]';
        uploadStatus.textContent = '';
        imagePreviewContainer.innerHTML = '';
        adminSubmitBtn.textContent = 'Ajouter le produit';
        adminFormTitle.textContent = 'Ajouter un nouveau produit';
        adminCancelBtn.classList.add('hidden');
    }

    function renderAdminList() {
        adminProductList.innerHTML = '';
        boutiqueProducts.forEach(p => {
            adminProductList.innerHTML += `<div class="bg-gray-600 p-3 rounded-lg flex items-center justify-between"><div><p class="font-bold">${p.name}</p><p class="text-sm text-gray-400">${p.price.toLocaleString('fr-FR')} Ar</p></div><div class="space-x-2"><button class="edit-product-btn bg-blue-500 px-3 py-1 rounded" data-id="${p.id}">Modifier</button><button class="delete-product-btn bg-red-500 px-3 py-1 rounded" data-id="${p.id}">Supprimer</button></div></div>`;
        });
        
        document.querySelectorAll('.edit-product-btn').forEach(btn => btn.addEventListener('click', (e) => {
            const id = e.currentTarget.dataset.id;
            const product = boutiqueProducts.find(p => p.id === id);
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-price').value = product.price;
            hiddenImagesJson.value = JSON.stringify(product.images);
            renderImagePreviews(product.images);
            adminFormTitle.textContent = 'Modifier le produit';
            adminSubmitBtn.textContent = 'Mettre à jour';
            adminCancelBtn.classList.remove('hidden');
            window.scrollTo(0, adminProductForm.offsetTop);
        }));

        document.querySelectorAll('.delete-product-btn').forEach(btn => btn.addEventListener('click', async (e) => {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
                const id = e.currentTarget.dataset.id;
                try {
                    await productsCollection.doc(id).delete();
                    await loadAndRenderProducts();
                } catch (error) {
                    console.error("Erreur de suppression: ", error);
                    alert("Une erreur s'est produite.");
                }
            }
        }));
    }
    
    function renderBoutique(searchTerm = '') {
        const searchBar = document.getElementById('search-bar');
        const lowerCaseSearchTerm = (searchTerm || searchBar.value).toLowerCase();
        const filteredProducts = boutiqueProducts.filter(p => p.name.toLowerCase().includes(lowerCaseSearchTerm));
        
        if (boutiqueProducts.length === 0) {
             productGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">Aucun produit n'a été publié pour le moment.</p>`;
        } else if (filteredProducts.length === 0) {
            productGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">Aucun produit ne correspond à votre recherche.</p>`;
        } else {
            productGrid.innerHTML = ''; 
            filteredProducts.forEach(p => productGrid.innerHTML += createProductCard(p));
        }
        
        document.querySelectorAll('.view-product-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                const productId = e.currentTarget.dataset.id;
                renderProductDetail(productId);
                switchView('detail');
            });
        });
    }

    document.getElementById('search-bar').addEventListener('input', () => renderBoutique());

    function createProductCard(product) {
        const imageUrl = product.images && product.images.length > 0 ? product.images[0] : 'https://placehold.co/600x400/cccccc/ffffff?text=Image';
        return `<div class="bg-white rounded-2xl shadow-md overflow-hidden flex flex-col group view-product-btn cursor-pointer" data-id="${product.id}"><div class="overflow-hidden bg-gray-100"><img src="${imageUrl}" alt="${product.name}" class="w-full h-48 object-contain group-hover:scale-105 transition-transform duration-300"></div><div class="p-4 flex flex-col flex-grow"><h3 class="text-lg font-bold text-gray-800 flex-grow">${product.name}</h3><div class="mt-4"><span class="text-xl font-extrabold theme-gradient-text">${product.price.toLocaleString('fr-FR')} Ar</span></div></div></div>`;
    }

    function renderProductDetail(productId) {
        const product = boutiqueProducts.find(p => p.id === productId); if (!product) return;
        let thumbnailsHTML = product.images.map((img, index) => `<img src="${img}" class="thumbnail w-16 h-16 object-contain bg-gray-100 rounded-md cursor-pointer border-2 ${index === 0 ? 'active' : 'border-transparent'}" data-index="${index}">`).join('');
        
        const productDetailSection = document.getElementById('product-detail-section');
        productDetailSection.innerHTML = `<div><button id="back-to-shop" class="text-gray-600 font-semibold mb-6 flex items-center"><svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>Retour à la boutique</button></div><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div><div class="bg-gray-100 rounded-xl shadow-lg"><img id="main-product-image" src="${product.images[0]}" alt="${product.name}" class="w-full h-80 object-contain rounded-xl"></div><div id="thumbnail-container" class="flex flex-wrap gap-2 mt-4">${thumbnailsHTML}</div></div><div><h1 class="font-poppins text-4xl font-bold text-gray-800">${product.name}</h1><p class="mt-4 text-gray-600 whitespace-pre-wrap">${product.description}</p><p class="mt-6 text-4xl font-extrabold theme-gradient-text">${product.price.toLocaleString('fr-FR')} Ar</p><div class="mt-8"><a href="#" data-id="${product.id}" class="order-now-btn w-full inline-flex items-center justify-center text-center bg-green-600 hover:bg-green-700 transition text-white font-bold py-4 px-4 rounded-xl text-lg"><ion-icon name="logo-whatsapp" class="mr-3 text-2xl"></ion-icon>Commander maintenant</a></div></div></div>`;
        
        document.getElementById('back-to-shop').addEventListener('click', () => switchView('boutique'));
        
        document.querySelector('.order-now-btn').addEventListener('click', e => {
            e.preventDefault();
            const id = e.currentTarget.dataset.id;
            const product = boutiqueProducts.find(p => p.id === id);
            let orderText = `*COMMANDE DIRECTE ARIDAGO*\n\n- Produit: ${product.name}\n- Prix: ${product.price.toLocaleString('fr-FR')} Ar\n\n(Frais de Livraison non inclus)`;
            window.open(`https://wa.me/8615600021123?text=${encodeURIComponent(orderText)}`, '_blank');
        });

        const mainImage = document.getElementById('main-product-image'); const thumbnails = document.querySelectorAll('.thumbnail');
        thumbnails.forEach(thumb => { thumb.addEventListener('click', e => { const index = parseInt(e.currentTarget.dataset.index); mainImage.src = product.images[index]; thumbnails.forEach(t => t.classList.remove('active')); e.currentTarget.classList.add('active'); }); });
    }
});
</script>
</body>
</html>

