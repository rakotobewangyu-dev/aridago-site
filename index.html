<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aridago - Boutique, Devis & Transfert</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #FFFBEB;
        }
        :root {
            --primary-color: #d92a2a;
            --secondary-color: #f7b731;
        }
        .nav-link-underline::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: width 0.3s;
        }
        .nav-link-underline:hover::after, .nav-link-active::after {
            width: 100%;
        }
        .text-gradient {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-primary {
            background: linear-gradient(90deg, #d92a2a, #f7b731);
            color: white;
        }
        .btn-secondary {
            background-color: #2ab57d;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #2a9d8f;
        }
        .btn-whatsapp {
            background: linear-gradient(90deg, #25D366, #128C7E);
            color: white;
        }
        .theme-gradient-text {
            background: linear-gradient(90deg, #d92a2a, #f7b731);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .theme-gradient-bg { 
            background: linear-gradient(90deg, #d92a2a, #f7b731); 
        }
        .modal-backdrop { 
            background-color: rgba(0,0,0,0.6); 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hidden {
            display: none;
        }
        .rotate-180 {
            transform: rotate(180deg);
        }
        #confirmation-modal, #price-alert-modal, #link-alert-modal, #delete-confirm-modal {
            display: none;
        }
        .cursor-zoom-in { cursor: zoom-in; }
        .scroll-animate {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .scroll-animate.scrolled-in {
            opacity: 1;
            transform: translateY(0);
        }
        .category-filter {
            transition: all 0.3s ease-in-out;
            background-color: #f3f4f6;
            color: #4b5563;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
        }
        .category-filter:hover {
             transform: translateY(-2px);
             box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
             background-color: #e5e7eb;
        }
        .category-filter.active-filter {
            background: linear-gradient(90deg, #d92a2a, #f7b731);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(217, 42, 42, 0.3), 0 2px 4px -2px rgba(247, 183, 49, 0.3);
            transform: translateY(-2px);
        }
        .sr-only {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border-width: 0;
        }
        #category-filters {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        #category-filters::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-2 sm:px-4 py-2 flex items-center justify-between md:justify-start">
            <a href="#" class="nav-link flex-shrink-0" data-page="accueil">
                 <img src="https://i.ibb.co/4nXZ4R2V/image-removebg-preview.png" alt="Logo Aridago" class="h-14 w-auto">
            </a>
            
            <div class="flex-1 flex justify-end md:justify-start">
                 <nav class="flex items-center space-x-1 sm:space-x-2 md:space-x-4 text-[10px] sm:text-sm md:text-base">
                    <a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline px-1 sm:px-2" data-page="accueil">Accueil</a>
                    <a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline px-1 sm:px-2" data-page="boutique">Boutique</a>
                    <a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline px-1 sm:px-2" data-page="devis">Devis</a>
                    <a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline px-1 sm:px-2" data-page="echange">Transfert</a>
                    <a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline px-1 sm:px-2" data-page="apropos">À Propos</a>
                </nav>
            </div>
        </div>
    </header>

    <div style="background: linear-gradient(90deg, #d92a2a, #f7b731);" class="text-white text-center py-2">
        <p class="text-sm font-semibold px-2">Votre partenaire d'achat en Chine | Simple, rapide et fiable</p>
    </div>

    <main>
        <section id="page-accueil" class="page-content">
            <div class="relative bg-slate-900 text-white flex items-center justify-center min-h-[500px] overflow-hidden">
                <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://i.ibb.co/8q8LMyF/Gemini-Generated-Image-q83rbmq83rbmq83r.png');"></div>
                <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
                <div class="relative text-center max-w-3xl px-4 z-10">
                    <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">Commander en Chine ?<br>C'est maintenant <span class="text-gradient">simple et rapide !</span></h1>
                    <p class="text-lg md:text-xl text-slate-300 mb-8">Nous sommes votre partenaire de confiance pour le sourcing, l'accompagnement commercial et la logistique entre la Chine et Madagascar.</p>
                    <a href="#" class="btn-primary font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 shadow-lg nav-link animate-pulse" data-page="devis">Faire une commande</a>
                </div>
            </div>

            <section class="bg-white py-12 md:py-16">
                <div class="container mx-auto px-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 text-center">
                        <div class="feature p-4 scroll-animate">
                            <i class="fas fa-search-dollar text-4xl text-red-600 mb-4"></i>
                            <h3 class="font-bold text-lg mb-2">Recherche de produits</h3>
                            <p class="text-slate-600">Nous trouvons pour vous les meilleurs produits au meilleur prix.</p>
                        </div>
                        <div class="feature p-4 scroll-animate">
                            <i class="fas fa-handshake text-4xl text-red-600 mb-4"></i>
                            <h3 class="font-bold text-lg mb-2">Intermédiaire de confiance</h3>
                            <p class="text-slate-600">Nous gérons l'achat, la vérification et le paiement pour vous.</p>
                        </div>
                        <div class="feature p-4 scroll-animate">
                            <i class="fas fa-shipping-fast text-4xl text-red-600 mb-4"></i>
                            <h3 class="font-bold text-lg mb-2">Transport sécurisé</h3>
                            <p class="text-slate-600">Nous nous occupons de l'expédition de la Chine vers Madagascar.</p>
                        </div>
                    </div>
                </div>
            </section>

             <div id="popular-products-accueil" class="py-12 md:py-16 scroll-animate"></div>
        </section>

        <section id="page-boutique" class="page-content hidden">
            <div class="container mx-auto px-4 py-12 md:py-16">
                 <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold mb-2 text-gradient flex items-center justify-center">
                        <i class="fas fa-store mr-3"></i>Notre Boutique
                    </h2>
                    <p class="text-slate-600 text-lg">Commandez directement nos articles sélectionnés pour vous.</p>
                     <div class="mt-6 max-w-lg mx-auto relative flex items-center">
                        <input type="text" id="search-bar" placeholder="Rechercher par nom de produit..." class="w-full pl-6 pr-12 py-3 border-2 border-slate-200 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400 transition">
                        <button id="search-btn" class="absolute right-0 top-0 h-full w-12 flex items-center justify-center text-white rounded-r-full hover:opacity-90" style="background-color: var(--secondary-color);">
                            <i class="fas fa-search"></i>
                        </button>
                     </div>
                 </div>
                 <div id="category-filters" class="flex items-center gap-3 mb-8 overflow-x-auto whitespace-nowrap py-2 px-4 -mx-4 md:justify-center"></div>
                 <div id="product-grid" class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8">
                    <p id="loading-products" class="text-center text-gray-500 col-span-full">Chargement des produits...</p>
                 </div>
            </div>
        </section>

        <section id="page-devis" class="page-content hidden">
            <div class="container mx-auto max-w-4xl p-4 md:p-8">
                <header class="text-center mb-10 scroll-animate">
                    <img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="mx-auto h-24 md:h-36 w-auto mb-6">
                    <h1 class="text-3xl md:text-5xl font-extrabold text-gray-800 leading-tight">
                        Commander en Chine ?<br>C'est maintenant <span class="theme-gradient-text">simple et rapide !</span>
                    </h1>
                    <p class="mt-4 text-base md:text-lg text-gray-600 max-w-2xl mx-auto">
                        Remplissez ce formulaire pour recevoir votre devis personnalisé directement sur WhatsApp.
                    </p>
                </header>

                <section class="mb-12 scroll-animate">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 text-center">
                        <div class="bg-white p-6 rounded-2xl shadow-sm">
                            <div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">1</div>
                            <h3 class="font-bold text-lg text-gray-800">Remplissez le formulaire</h3>
                            <p class="text-gray-500 text-sm mt-1">Ajoutez les liens et détails de tous vos produits.</p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm">
                            <div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">2</div>
                            <h3 class="font-bold text-lg text-gray-800">Envoyez via WhatsApp</h3>
                            <p class="text-gray-500 text-sm mt-1">Un clic suffit pour nous transmettre votre demande.</p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm">
                            <div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">3</div>
                            <h3 class="font-bold text-lg text-gray-800">Recevez la confirmation</h3>
                            <p class="text-gray-500 text-sm mt-1">Nous vérifions et validons la commande avec vous.</p>
                        </div>
                    </div>
                </section>

                <main class="bg-white p-6 md:p-10 rounded-3xl shadow-lg scroll-animate">
                    <form id="devis-form">
                        <fieldset class="border-b-2 border-gray-100 pb-8">
                            <legend class="text-xl md:text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                <span class="theme-gradient-bg w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full text-white font-bold mr-4 text-base md:text-lg">1</span> Vos informations
                            </legend>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                                <div><label for="nom" class="block text-sm font-semibold text-gray-600 mb-1">Votre nom</label><input type="text" id="nom" name="nom" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                                <div><label for="entreprise" class="block text-sm font-semibold text-gray-600 mb-1">Nom de votre Entreprise (Optionnel)</label><input type="text" id="entreprise" name="entreprise" class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                                <div><label for="whatsapp" class="block text-sm font-semibold text-gray-600 mb-1">Numéro WhatsApp</label><input type="tel" id="whatsapp" name="whatsapp" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                                <div><label for="email" class="block text-sm font-semibold text-gray-600 mb-1">Email (Optionnel)</label><input type="email" id="email" name="email" class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                                <div class="md:col-span-2"><label for="adresse" class="block text-sm font-semibold text-gray-600 mb-1">Adresse de livraison</label><input type="text" id="adresse" name="adresse" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div>
                            </div>
                        </fieldset>
                        <fieldset class="mt-8">
                            <legend class="text-xl md:text-2xl font-bold text-gray-800 mb-6 flex items-center">
                                <span class="theme-gradient-bg w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full text-white font-bold mr-4 text-base md:text-lg">2</span> Vos produits
                            </legend>
                            <div id="product-list" class="space-y-6"></div>
                            <div class="mt-6"><button type="button" id="add-product" class="w-full flex items-center justify-center px-6 py-3 border-2 border-dashed border-red-300 text-sm font-semibold rounded-xl text-red-600 hover:bg-red-50 transition"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>Ajouter un autre produit</button></div>
                        </fieldset>
                        <div class="mt-10 text-center">
                            <button type="submit" class="inline-flex justify-center items-center py-3 px-8 md:py-4 md:px-16 text-base md:text-lg font-bold rounded-xl text-white btn-whatsapp shadow-lg hover:shadow-xl transform hover:scale-105 transition animate-pulse">
                                <ion-icon name="logo-whatsapp" class="mr-3 text-2xl"></ion-icon>
                                Envoyer ma commande
                            </button>
                        </div>
                    </form>
                </main>

                <section class="mt-12 bg-white p-6 md:p-10 rounded-3xl shadow-lg scroll-animate">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Questions fréquentes (FAQ)</h2>
                    <div id="faq-container" class="space-y-2"></div>
                </section>
            </div>
        </section>
        
       <section id="page-echange" class="page-content hidden">
            <div class="container mx-auto max-w-4xl p-4 md:p-8">
                <div class="w-full max-w-2xl mx-auto mb-10 mt-8">
                    <img src="https://i.ibb.co/2P2rS8F/Ariary-3.png" alt="Ariary-3" class="w-full h-auto rounded-2xl shadow-lg">
                </div>
                 <header class="text-center mb-10 scroll-animate">
                    <h1 class="text-3xl md:text-5xl font-extrabold text-gray-800 leading-tight">
                        Service de Transfert d'Argent<br><span class="theme-gradient-text">Ariary (MGA) & Yuan (RMB)</span>
                    </h1>
                    <p class="mt-4 text-base md:text-lg text-gray-600 max-w-2xl mx-auto">
                        Transférez votre argent simplement, rapidement et en toute sécurité pour vos transactions entre la Chine et Madagascar.
                    </p>
                </header>

                <main class="bg-white p-6 md:p-8 rounded-3xl shadow-xl scroll-animate">
                    <h2 class="text-2xl font-bold text-center mb-6 text-gray-800 flex items-center justify-center"><i class="fas fa-calculator mr-3 theme-gradient-text"></i>Profitez pleinement de tous nos services de Transfert</h2>

                    <div id="exchange-calculator" class="space-y-6">
                        <div class="bg-slate-50 p-4 rounded-2xl border-2 border-slate-200">
                            <label id="from-currency-label" for="from-amount" class="block text-sm font-semibold text-gray-500 mb-2">Vous envoyez</label>
                            <div class="relative flex items-center">
                                <input type="number" id="from-amount" name="from-amount" class="w-full bg-transparent text-3xl font-bold text-slate-800 focus:outline-none" placeholder="0">
                                <div id="from-currency-badge" class="flex-shrink-0 bg-green-600 text-white px-3 py-1 sm:px-4 sm:py-2 rounded-full text-base sm:text-lg font-bold flex items-center">MGA</div>
                            </div>
                        </div>

                        <div class="flex justify-center items-center">
                             <div class="w-full h-px bg-slate-200"></div>
                             <button id="swap-button" class="bg-white border-2 border-slate-200 hover:bg-slate-100 rounded-full w-12 h-12 sm:w-14 sm:h-14 flex-shrink-0 mx-4 flex items-center justify-center transition-transform transform hover:rotate-180">
                                 <i class="fas fa-exchange-alt text-slate-600 text-lg sm:text-xl"></i>
                             </button>
                             <div class="w-full h-px bg-slate-200"></div>
                        </div>

                        <div class="bg-slate-50 p-4 rounded-2xl border-2 border-slate-200">
                            <label id="to-currency-label" for="to-amount" class="block text-sm font-semibold text-gray-500 mb-2">Le bénéficiaire reçoit</label>
                            <div class="relative flex items-center">
                                <input type="number" id="to-amount" name="to-amount" class="w-full bg-transparent text-3xl font-bold text-slate-800 focus:outline-none" placeholder="0">
                                <div id="to-currency-badge" class="flex-shrink-0 bg-red-600 text-white px-3 py-1 sm:px-4 sm:py-2 rounded-full text-base sm:text-lg font-bold flex items-center">RMB</div>
                            </div>
                        </div>

                        <div id="rate-display" class="text-center text-gray-500 font-semibold pt-2 text-lg">Chargement du cours de change...</div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-200">
                         <label for="payment-method-select" class="block text-lg font-semibold text-gray-700 mb-4 text-center">1. Choisissez votre moyen de paiement</label>
                         <div id="payment-options-from"></div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-200">
                         <label for="reception-method-select" class="block text-lg font-semibold text-gray-700 mb-4 text-center">2. Choisissez le moyen de réception</label>
                         <div id="reception-options-to"></div>
                    </div>

                    <div class="mt-10 text-center">
                        <button id="exchange-whatsapp-btn" class="inline-flex justify-center items-center py-3 px-8 md:py-4 md:px-16 text-base md:text-lg font-bold rounded-xl text-white btn-whatsapp shadow-lg hover:shadow-xl transform hover:scale-105 transition">
                         <ion-icon name="logo-whatsapp" class="mr-3 text-2xl"></ion-icon>
                            Confirmer la transaction
                        </button>
                    </div>
                </main>
            </div>
        </section>

        <section id="page-apropos" class="page-content hidden">
            <div class="relative bg-slate-800 text-white flex items-center justify-center pt-24 pb-16 overflow-hidden">
                <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://i.ibb.co/8q8LMyF/Gemini-Generated-Image-q83rbmq83rbmq83r.png');"></div>
                <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
                <div class="relative text-center max-w-4xl px-4 z-10">
                    <h2 class="text-4xl md:text-5xl font-extrabold mb-4 leading-tight text-gradient">Votre Partenaire de Confiance Pour la Chine</h2>
                    <p class="text-lg md:text-xl text-slate-300">Nous avons créé Aridago pour rendre les achats en Chine simples, transparents et accessibles à tous depuis Madagascar.</p>
                </div>
            </div>

            <div class="bg-white">
                <div class="container mx-auto px-4 py-16 md:py-20">

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center mb-16 md:mb-24 scroll-animate">
                        <div class="order-last md:order-first">
                            <h3 class="text-3xl font-bold mb-6 text-gradient">Qui sommes-nous ?</h3>
                            <p class="text-slate-700 mb-4 text-base md:text-lg">
                                Fondé par des experts en commerce international durablement implantés à Madagascar et en Chine, Aridago est né d'une vision claire : devenir le <strong>partenaire de confiance</strong> des entreprises et particuliers malgaches. Nous avons identifié un besoin fondamental : la nécessité d'un intermédiaire fiable capable de surmonter les barrières linguistiques, culturelles et logistiques.
                            </p>
                            <p class="text-slate-700 text-base md:text-lg">
                                Notre double présence est notre plus grande force. L'équipe en Chine opère au plus près des fabricants, tandis que notre équipe à Madagascar assure une compréhension parfaite de vos besoins. Cette synergie unique nous permet de construire un <strong>pont solide et fiable</strong> entre votre projet et les meilleures opportunités du marché chinois.
                            </p>
                        </div>
                        <div>
                            <img src="https://i.ibb.co/pvdKjdPG/Capture-d-cran-2025-09-09-183658.png" alt="Équipe Aridago" class="rounded-xl shadow-2xl transform hover:scale-105 transition-transform duration-300">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center mb-16 md:mb-24 scroll-animate">
                        <div>
                            <img src="https://i.ibb.co/7dZdpFcJ/Untitled-design-1.png" alt="Services Aridago" class="rounded-xl shadow-2xl transform hover:scale-105 transition-transform duration-300">
                        </div>
                        <div>
                            <h3 class="text-3xl font-bold mb-6 text-gradient">Que faisons-nous ?</h3>
                            <p class="text-slate-700 mb-4 text-base md:text-lg">
                                Nous offrons un service complet d'intermédiaire d'achat. Vous avez trouvé un produit ? Nous nous occupons de tout : communication, négociation, et paiement sécurisé.
                            </p>
                            <p class="text-slate-700 text-base md:text-lg">
                                En plus, notre boutique vous propose une sélection de produits déjà en stock à Madagascar, prêts à être récupérés sur place pour une satisfaction immédiate.
                            </p>
                        </div>
                    </div>

                    <div class="text-center mb-16 md:mb-24 scroll-animate">
                        <h3 class="text-3xl md:text-4xl font-bold mb-12 text-gradient">Nos Domaines d'Expertise</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                            <div class="bg-slate-50 p-6 rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                                <h4 class="font-bold text-xl mb-2 text-blue-600">Produits Métallurgiques</h4>
                                <p class="text-slate-600">Aciers, aluminium, fer. Nous maîtrisons les nuances des matières premières aux produits semi-finis pour l'industrie.</p>
                            </div>
                            <div class="bg-slate-50 p-6 rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                                <h4 class="font-bold text-xl mb-2 text-blue-600">Produits Industriels</h4>
                                <p class="text-slate-600">Accès à un large éventail de machines-outils, pièces mécaniques et équipements spécialisés.</p>
                            </div>
                            <div class="bg-slate-50 p-6 rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                                <h4 class="font-bold text-xl mb-2 text-blue-600">Matériaux de Construction</h4>
                                <p class="text-slate-600">Partenaire de vos chantiers, nous sourçons tous les matériaux, du gros œuvre aux finitions.</p>
                            </div>
                            <div class="bg-slate-50 p-6 rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                                <h4 class="font-bold text-xl mb-2 text-blue-600">Meubles & Équipements de Maison</h4>
                                <p class="text-slate-600">Nous identifions les fabricants de qualité pour vos projets d'ameublement et vos appareils électroménagers.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mb-16 md:mb-24 scroll-animate">
                        <h3 class="text-3xl md:text-4xl font-bold mb-4">Notre Processus Simplifié</h3>
                        <p class="text-slate-600 text-base md:text-lg max-w-2xl mx-auto">En quatre étapes claires, nous vous accompagnons de la recherche à la livraison.</p>
                        <div class="mt-12 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 relative">
                            <div class="hidden md:block absolute top-10 left-0 w-full h-px bg-slate-200" style="z-index: 0;"></div>
                            
                            <div class="relative z-10 flex flex-col items-center p-4 md:p-6">
                                <div class="theme-gradient-bg w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full text-white font-bold text-2xl md:text-3xl mx-auto mb-4 shadow-lg border-4 border-white">1</div>
                                <h4 class="font-bold text-lg text-gray-800">Votre Demande</h4>
                                <p class="text-gray-500 text-sm mt-1">Vous soumettez votre demande via notre formulaire de devis détaillé.</p>
                            </div>
                            <div class="relative z-10 flex flex-col items-center p-4 md:p-6">
                                <div class="theme-gradient-bg w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full text-white font-bold text-2xl md:text-3xl mx-auto mb-4 shadow-lg border-4 border-white">2</div>
                                <h4 class="font-bold text-lg text-gray-800">Devis & Validation</h4>
                                <p class="text-gray-500 text-sm mt-1">Nous vous envoyons un devis clair. Après votre accord et un acompte, nous sécurisons l'achat.</p>
                            </div>
                            <div class="relative z-10 flex flex-col items-center p-4 md:p-6">
                                <div class="theme-gradient-bg w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full text-white font-bold text-2xl md:text-3xl mx-auto mb-4 shadow-lg border-4 border-white">3</div>
                                <h4 class="font-bold text-lg text-gray-800">Vérification</h4>
                                <p class="text-gray-500 text-sm mt-1">Nos équipes effectuent un contrôle qualité rigoureux et vous envoient photos et vidéos pour validation.</p>
                            </div>
                            <div class="relative z-10 flex flex-col items-center p-4 md:p-6">
                                <div class="theme-gradient-bg w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full text-white font-bold text-2xl md:text-3xl mx-auto mb-4 shadow-lg border-4 border-white">4</div>
                                <h4 class="font-bold text-lg text-gray-800">Expédition</h4>
                                <p class="text-gray-500 text-sm mt-1">Nous organisons le transport et le dédouanement pour une livraison fluide à Madagascar.</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-slate-50 rounded-2xl p-8 md:p-12 mb-16 md:mb-24 scroll-animate">
                        <h3 class="text-3xl md:text-4xl font-bold mb-12 text-center text-gradient">Nos Engagements</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div class="text-center p-8 bg-white rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                                <div class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-6 rounded-full bg-red-100 flex items-center justify-center">
                                    <i class="fas fa-shield-alt text-3xl text-red-600"></i>
                                </div>
                                <h4 class="font-bold text-xl mb-2">Confiance</h4>
                                <p class="text-slate-600">Transparence totale dans nos processus et nos tarifs pour une collaboration sereine.</p>
                            </div>
                            <div class="text-center p-8 bg-white rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                                <div class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-6 rounded-full bg-yellow-100 flex items-center justify-center">
                                    <i class="fas fa-bolt text-3xl text-yellow-600"></i>
                                </div>
                                <h4 class="font-bold text-xl mb-2">Efficacité</h4>
                                <p class="text-slate-600">Nous optimisons chaque étape pour vous garantir des délais de traitement rapides.</p>
                            </div>
                            <div class="text-center p-8 bg-white rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300">
                                <div class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-6 rounded-full bg-green-100 flex items-center justify-center">
                                    <i class="fas fa-hands-helping text-3xl text-green-600"></i>
                                </div>
                                <h4 class="font-bold text-xl mb-2">Accompagnement</h4>
                                <p class="text-slate-600">Nous offrons un support personnalisé et réactif à chaque étape de votre commande.</p>
                            </div>
                        </div>
                         <p class="text-center text-slate-700 mt-12 text-lg">Choisir Aridago, c'est choisir la sérénité. Nous assurons une <strong>sélection rigoureuse</strong> des fournisseurs, la <strong>négociation des meilleurs prix</strong>, une <strong>transparence totale</strong> et un <strong>service après-vente réactif</strong>.</p>
                    </div>

                    <div class="text-center theme-gradient-bg rounded-2xl p-10 text-white shadow-2xl">
                        <h3 class="text-3xl md:text-4xl font-bold mb-4">Prêt à simplifier vos achats ?</h3>
                        <p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto">Rejoignez les dizaines de clients qui nous font confiance pour leurs approvisionnements en Chine.</p>
                        <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                            <a href="#" class="bg-white text-red-600 font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 shadow-lg nav-link" data-page="devis">Demander un devis</a>
                            <a href="#" class="border-2 border-white text-white font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 hover:bg-white hover:text-red-600 nav-link" data-page="boutique">Explorer la Boutique</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-detail" class="page-content hidden bg-white py-12"></section>

        <section id="page-admin" class="page-content hidden container mx-auto px-4 py-16"></section>
    </main>
    
    <footer class="bg-slate-900 text-white">
        <div class="container mx-auto px-4 py-10">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8 text-center md:text-left">
                <div>
                     <img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="h-16 w-auto mb-4 mx-auto md:mx-0">
                    <p class="text-slate-400 mb-4">Votre intermédiaire d'achat N°1 en Chine. Qualité, confiance et service client.</p>
                    <div class="flex space-x-4 justify-center md:justify-start">
                        <a href="https://www.facebook.com/Aridagochine/" target="_blank" class="w-10 h-10 bg-slate-700 hover:bg-red-600 rounded-full flex items-center justify-center transition-colors"><i class="fab fa-facebook-f"></i></a>
                    </div>
                </div>
                 <div>
                     <h3 class="text-xl font-bold mb-4 relative pb-2 inline-block md:block after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-10 after:h-0.5 after:bg-secondary-color">Liens Rapides</h3>
                     <ul class="space-y-2">
                        <li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="accueil">Accueil</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="boutique">Boutique</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="devis">Devis sur Mesure</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="echange">Transfert</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="apropos">À Propos</a></li>
                     </ul>
                </div>
                 <div>
                     <h3 class="text-xl font-bold mb-4 relative pb-2 inline-block md:block after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-10 after:h-0.5 after:bg-secondary-color">Contact</h3>
                     <ul class="space-y-3 text-slate-400">
                         <li class="flex items-center justify-center md:justify-start"><i class="fab fa-whatsapp w-5 mr-2 text-green-400"></i><span>+86 156 0002 1123</span></li>
                         <li class="flex items-center justify-center md:justify-start"><i class="fas fa-envelope w-5 mr-2"></i><span>aridagoservice@hotmail.com</span></li>
                     </ul>
                </div>
            </div>
            <div class="text-center pt-8 border-t border-slate-700">
                <p class="text-slate-500">&copy; <span id="year"></span> Aridago - Tous droits réservés. <button id="admin-link-footer" class="ml-2 text-slate-500 hover:text-white hover:underline transition">Admin</button></p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/8615600021123" target="_blank" class="fixed bottom-24 right-6 bg-green-500 hover:bg-green-600 text-white w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transform hover:scale-110 transition z-40" title="Contactez-nous sur WhatsApp">
        <i class="fab fa-whatsapp text-3xl md:text-4xl"></i>
    </a>
    
    <a href="https://www.facebook.com/Aridagochine/" target="_blank" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transform hover:scale-110 transition z-40" title="Contactez-nous sur Facebook">
        <svg class="w-7 h-7 md:w-8 md:h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z"></path></svg>
    </a>

    <!-- Modals -->
    <div id="price-alert-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center m-4"><h3 class="text-lg font-bold text-gray-800">Attention sur le Prix Unitaire</h3><p class="text-gray-600 mt-2 text-sm">Afin de s'assurer que nous parlons bien du même produit au bon prix, veuillez indiquer le prix exact d'achat sur le site que vous avez choisi pour qu'au moment de notre achat il n'y ait pas d'erreur de commande.</p><button id="close-price-modal-btn" class="mt-6 w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg">Compris</button></div></div>
    <div id="link-alert-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center m-4"><h3 class="text-lg font-bold text-gray-800">Comment copier le lien ?</h3><p class="text-gray-600 mt-2 text-sm">Copiez-collez le lien du produit que vous souhaitez acheter sur les sites chinois suivants afin que nous puissions l'identifier et l'acheter pour vous : Alibaba, Taobao, 1688, JingDong, XianYu, etc.</p><button id="close-link-modal-btn" class="mt-6 w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg">Compris</button></div></div>
    
    <div id="confirmation-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-md p-8 text-center m-4 relative">
            <button id="close-confirmation-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold">&times;</button>
            <div class="mx-auto bg-green-100 rounded-full h-24 w-24 flex items-center justify-center">
                <svg class="h-16 w-16 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
            </div>
            <h2 class="mt-6 text-3xl font-extrabold text-gray-800">C'est presque fini !</h2>
            <p class="mt-4 text-gray-600">Votre devis a été préparé. Cliquez ci-dessous pour nous l'envoyer sur WhatsApp.</p>
            <a id="whatsapp-link" href="#" target="_blank" class="mt-8 inline-flex items-center justify-center w-full py-4 px-8 text-base font-bold rounded-xl text-white btn-primary">Confirmer et Envoyer sur WhatsApp</a>
        </div>
    </div>

    <div id="delete-confirm-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center m-4">
            <h3 class="text-lg font-bold text-gray-800">Confirmer la suppression</h3>
            <p class="text-gray-600 mt-2 text-sm">Êtes-vous sûr de vouloir supprimer ce produit ? Cette action est irréversible.</p>
            <div class="mt-6 flex justify-center gap-4">
                <button id="cancel-delete-btn" class="w-full bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">Annuler</button>
                <button id="confirm-delete-btn" class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Supprimer</button>
            </div>
        </div>
    </div>

    <div id="image-lightbox" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
        <button id="close-lightbox-btn" class="absolute top-4 right-4 text-white text-4xl font-bold hover:opacity-75">&times;</button>
        <img id="lightbox-img" src="" alt="Agrandissement du produit" class="max-w-full max-h-full object-contain rounded-lg">
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const firebaseConfig = {
      apiKey: "AIzaSyBa93ZQ34S4JEz6lc7yt_2ZrIiTc2Jqh9c",
      authDomain: "boutique-aridago.firebaseapp.com",
      projectId: "boutique-aridago",
      storageBucket: "boutique-aridago.appspot.com",
      messagingSenderId: "173722302642",
      appId: "1:173722302642:web:1cad436874f3b4270eb1ab"
    };
    const IMGBB_API_KEY = '7dfb12ff69d1e1f349a28e4a788f2c1d';

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const productsCollection = db.collection('products');
    const settingsCollection = db.collection('settings');

    let boutiqueProducts = [];
    const pages = document.querySelectorAll('.page-content');
    const navLinks = document.querySelectorAll('.nav-link');

    function initScrollAnimations() {
        const animatedElements = document.querySelectorAll('.scroll-animate');
        if ("IntersectionObserver" in window) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => entry.target.classList.toggle('scrolled-in', entry.isIntersecting));
            }, { threshold: 0.1 });
            animatedElements.forEach(el => observer.observe(el));
        } else {
            animatedElements.forEach(el => el.classList.add('scrolled-in'));
        }
    }
    
    function showPage(pageId, fromPopState = false) {
        pages.forEach(page => page.classList.add('hidden'));
        const targetPage = document.getElementById(pageId) || document.getElementById('page-accueil');
        targetPage.classList.remove('hidden');
        
        const activePageId = targetPage.id;

        document.querySelectorAll('header nav .nav-link, footer .nav-link').forEach(link => {
            const isTargetLink = `page-${link.dataset.page}` === activePageId;
            link.classList.toggle('nav-link-active', isTargetLink);
            link.classList.toggle('text-red-600', isTargetLink && link.closest('header'));
            link.classList.toggle('text-white', isTargetLink && link.closest('footer'));
        });

        if (!fromPopState) {
            const pageName = activePageId.replace('page-', '');
            if (`#${pageName}` !== window.location.hash) {
                history.pushState({ pageId: activePageId }, '', `#${pageName}`);
            }
        }
        
        window.scrollTo(0, 0);
        if (activePageId === 'page-boutique') renderBoutique();
        initScrollAnimations();
    }
    
    function viewProduct(productId) {
        renderProductDetail(productId);
        showPage('page-detail', true); 
        history.pushState({ pageId: 'page-detail', productId: productId }, '', `#detail/${productId}`);
        window.scrollTo(0, 0);
    }
    
    function router() {
        const hash = window.location.hash.substring(1);
        const [pageName, id] = hash.split('/');

        if (pageName === 'detail' && id) {
            if (boutiqueProducts.length > 0) {
                 renderProductDetail(id);
                 showPage('page-detail', true);
            } else {
                 window.initialRoute = { pageId: 'page-detail', productId: id };
            }
        } else {
            const pageId = `page-${pageName || 'accueil'}`;
            showPage(pageId, true);
        }
    }

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const pageId = `page-${this.dataset.page}`;
            showPage(pageId);
        });
    });
    
    document.getElementById('admin-link-footer').addEventListener('click', (e) => {
        e.preventDefault();
        showPage('page-admin');
    });

    window.addEventListener('popstate', (event) => router());
    document.getElementById('year').textContent = new Date().getFullYear();

    async function loadAndRenderProducts() {
        try {
            const snapshot = await productsCollection.orderBy("name").get();
            boutiqueProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderCategoryFilters();
            renderBoutique();
            renderPopularProducts(boutiqueProducts.filter(p => p.isFeatured).slice(0, 4));
            
            if (auth.currentUser) {
                initAdminPanel();
            }

        } catch (error) {
            console.error("Erreur de chargement: ", error);
            const loadingEl = document.getElementById('loading-products');
            if(loadingEl) loadingEl.textContent = 'Erreur de chargement des produits.';
        } finally {
            if (window.initialRoute) {
                renderProductDetail(window.initialRoute.productId);
                showPage(window.initialRoute.pageId, true);
                window.initialRoute = null;
            } else {
                 router();
            }
        }
    }

    function createProductCard(product) {
        const imageUrl = product.images?.[0] || 'https://placehold.co/600x400/cccccc/ffffff?text=Image';
        const stockBadge = product.inStockMadagascar
            ? `<div class="absolute top-2 left-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full flex items-center"><i class="fas fa-check-circle mr-1"></i> En stock</div>`
            : `<div class="absolute top-2 left-2 bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-full flex items-center"><i class="fas fa-shipping-fast mr-1"></i> Sur commande</div>`;
        const priceHTML = product.price > 0
            ? `<p class="text-gradient font-extrabold text-base sm:text-xl">${product.price.toLocaleString('fr-FR')} Ar</p>`
            : `<p class="text-gradient font-extrabold text-base sm:text-xl">Prix sur devis</p>`;

        return `<div class="bg-white rounded-xl shadow-lg overflow-hidden group transform hover:-translate-y-1 transition-transform duration-300 view-product-btn cursor-pointer scroll-animate" data-id="${product.id}"><div class="relative"><img src="${imageUrl}" alt="${product.name}" class="w-full h-40 sm:h-48 md:h-56 object-contain p-2 sm:p-4">${stockBadge}<div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><span class="text-white btn-primary py-2 px-5 rounded-full transform hover:scale-105 transition-transform text-sm">Voir</span></div></div><div class="p-2 sm:p-4 text-center"><h3 class="font-semibold text-sm sm:text-base mb-1 sm:mb-2 truncate">${product.name}</h3>${priceHTML}</div></div>`;
    }

    function addProductCardListeners() {
        document.querySelectorAll('.view-product-btn').forEach(btn => {
            btn.addEventListener('click', e => viewProduct(e.currentTarget.dataset.id));
        });
    }

    function normalizeString(str) {
        return str?.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "") || '';
    }

    function renderCategoryFilters() {
        const categories = ['Tous', ...new Set(boutiqueProducts.map(p => p.category).filter(Boolean))];
        const container = document.getElementById('category-filters');
        container.innerHTML = `<span class="font-semibold text-slate-600 mr-3 flex-shrink-0">Filtre :</span>` + categories.map((cat, index) => 
            `<button class="category-filter flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-full ${index === 0 ? 'active-filter' : ''}" data-category="${cat}">${cat}</button>`
        ).join('');
        container.querySelectorAll('.category-filter').forEach(btn => {
            btn.addEventListener('click', () => {
                container.querySelector('.active-filter')?.classList.remove('active-filter');
                btn.classList.add('active-filter');
                renderBoutique();
            });
        });
    }

    function renderBoutique() {
        const productGrid = document.getElementById('product-grid');
        const searchTerm = normalizeString(document.getElementById('search-bar')?.value);
        const activeCategory = document.querySelector('#category-filters .active-filter')?.dataset.category;
        
        let filteredProducts = boutiqueProducts.filter(p => {
            const nameMatch = !searchTerm || normalizeString(p.name).includes(searchTerm);
            const categoryMatch = !activeCategory || activeCategory === 'Tous' || p.category === activeCategory;
            return nameMatch && categoryMatch;
        });

        const loadingEl = document.getElementById('loading-products');
        if (loadingEl) {
            loadingEl.style.display = 'none';
        }

        productGrid.innerHTML = filteredProducts.length > 0
            ? filteredProducts.map(createProductCard).join('')
            : `<p class="text-center text-gray-500 col-span-full">Aucun produit ne correspond à votre recherche.</p>`;
        addProductCardListeners();
        initScrollAnimations();
    }
    
    function renderPopularProducts(products) {
        const container = document.getElementById('popular-products-accueil');
        if (!container || products.length === 0) return;
        container.innerHTML = `<div class="container mx-auto px-4"><div class="text-center mb-12"><h2 class="text-3xl md:text-4xl font-bold mb-2">Produits Populaires</h2><p class="text-slate-600 text-lg">Les articles les plus demandés</p></div><div class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8">${products.map(createProductCard).join('')}</div></div>`;
        addProductCardListeners();
        initScrollAnimations();
    }

    function renderProductDetail(productId) {
        const product = boutiqueProducts.find(p => p.id === productId); 
        if (!product) { showPage('page-boutique'); return; }
        
        const availabilityText = product.inStockMadagascar ? `<div class="mt-4 flex items-center text-green-600 font-semibold"><i class="fas fa-check-circle mr-2"></i>Produit disponible à Madagascar</div>` : `<div class="mt-4 flex items-center text-yellow-600 font-semibold"><i class="fas fa-shipping-fast mr-2"></i>Produit disponible sur commande</div>`;
        const priceDetailHTML = product.price > 0 ? `<p class="text-3xl md:text-4xl font-extrabold text-gradient my-4">${product.price.toLocaleString('fr-FR')} Ar</p>` : `<p class="text-3xl md:text-4xl font-extrabold text-gradient my-4">Prix sur devis</p>`;
        const thumbnailsHTML = (product.images || []).map((img, i) => `<img src="${img}" class="w-16 h-16 md:w-20 md:h-20 object-contain bg-slate-100 rounded-md cursor-pointer border-2 ${i === 0 ? 'border-red-500' : 'border-transparent'} thumbnail" data-index="${i}">`).join('');
        
        const detailSection = document.getElementById('page-detail');
        detailSection.innerHTML = `<div class="container mx-auto px-4"><button class="nav-link font-semibold mb-8 inline-flex items-center" data-page="boutique"><i class="fas fa-arrow-left mr-2"></i>Retour à la boutique</button><div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12"><div><div class="bg-slate-100 rounded-xl shadow-lg mb-4 cursor-zoom-in"><img id="main-product-image" src="${product.images?.[0]}" alt="${product.name}" class="w-full h-80 md:h-96 object-contain rounded-xl p-4"></div><div id="thumbnail-container" class="flex flex-wrap gap-4 justify-center">${thumbnailsHTML}</div></div><div><h1 class="text-3xl md:text-4xl font-bold text-slate-800">${product.name}</h1>${priceDetailHTML}${availabilityText}<p class="mt-4 text-slate-600 whitespace-pre-wrap">${product.description}</p><div class="mt-8"><a href="#" data-id="${product.id}" class="order-now-btn w-full inline-flex items-center justify-center text-center btn-secondary transition text-white font-bold py-4 px-4 rounded-xl text-lg"><i class="fab fa-whatsapp mr-3 text-2xl"></i>Commander maintenant</a></div></div></div></div>`;
        
        detailSection.querySelector('.nav-link').addEventListener('click', (e) => { e.preventDefault(); showPage('page-boutique'); });
        detailSection.querySelector('.order-now-btn').addEventListener('click', e => { 
            e.preventDefault();
            let orderText = `*COMMANDE DIRECTE ARIDAGO*\n\n- Produit: ${product.name}${product.price > 0 ? `\n- Prix: ${product.price.toLocaleString('fr-FR')} Ar` : ''}`;
            window.open(`https://wa.me/8615600021123?text=${encodeURIComponent(orderText)}`, '_blank');
        });
        
        const mainImage = document.getElementById('main-product-image');
        const thumbnails = detailSection.querySelectorAll('.thumbnail');
        thumbnails.forEach(thumb => thumb.addEventListener('click', e => {
            mainImage.src = product.images[e.currentTarget.dataset.index];
            thumbnails.forEach(t => t.classList.remove('border-red-500'));
            e.currentTarget.classList.add('border-red-500');
        }));

        const lightbox = document.getElementById('image-lightbox');
        const openLightbox = () => {
            document.getElementById('lightbox-img').src = mainImage.src;
            lightbox.classList.remove('hidden');
            lightbox.classList.add('flex');
        };
        const closeLightbox = () => lightbox.classList.add('hidden');
        detailSection.querySelector('.cursor-zoom-in').addEventListener('click', openLightbox);
        document.getElementById('close-lightbox-btn').addEventListener('click', closeLightbox);
        lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
    }

    function initSearchFunctionality() {
        const searchBar = document.getElementById('search-bar');
        const searchBtn = document.getElementById('search-btn');
        if (searchBar && searchBtn) {
            const performSearch = () => { if (!document.getElementById('page-boutique').classList.contains('hidden')) renderBoutique(); };
            searchBar.addEventListener('input', performSearch);
            searchBtn.addEventListener('click', performSearch);
            searchBar.addEventListener('keypress', e => { if (e.key === 'Enter') { e.preventDefault(); performSearch(); } });
        }
    }
    
    // LOGIQUE DEVIS
    function renderDevisFaq() {
        const faqContainer = document.querySelector('#page-devis #faq-container');
        if (!faqContainer) return;
        faqContainer.innerHTML = `
            <div class="faq-item bg-gray-50 rounded-xl">
                <button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center">
                    <span>Quels sont les frais de transport Chine-Madagascar ?</span>
                    <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="faq-answer hidden px-4 pb-4 text-gray-600">
                    <p>Les frais de transport ne sont pas inclus dans le devis initial. Ils dépendent du poids et du volume total de votre commande. Nous vous fournirons une estimation détaillée de ces frais lors de la confirmation de votre commande.</p>
                </div>
            </div>
            <div class="faq-item bg-gray-50 rounded-xl">
                <button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center">
                    <span>Quels sont les délais de livraison estimés ?</span>
                    <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="faq-answer hidden px-4 pb-4 text-gray-600">
                    <p>Les délais varient en fonction du type de transport choisi (aérien ou maritime). En général, comptez entre 3 à 10 jours pour le transport aérien et 30 à 60 jours pour le transport maritime, après réception de tous vos articles dans notre entrepôt en Chine.</p>
                </div>
            </div>
            <div class="faq-item bg-gray-50 rounded-xl">
                <button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center">
                    <span>Quels sont les moyens de paiement acceptés ?</span>
                    <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="faq-answer hidden px-4 pb-4 text-gray-600">
                    <p>Pour les paiements en <b>Yuan (CNY)</b>, nous acceptons : Alipay et WeChatPay.<br>Pour les paiements en <b>Ariary (MGA)</b>, nous acceptons : Espèce, MVola, Orange Money et Airtel Money.<br>Les détails vous seront communiqués lors de la validation de votre devis.</p>
                </div>
            </div>
            <div class="faq-item bg-gray-50 rounded-xl">
                <button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center">
                    <span>Comment garantissez-vous la qualité des produits ?</span>
                    <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div class="faq-answer hidden px-4 pb-4 text-gray-600">
                    <p>La qualité est notre priorité. Nos équipes en Chine effectuent un contrôle qualité systématique avant toute expédition. Nous vous envoyons des photos et des vidéos des produits pour que vous puissiez valider la conformité de votre commande avant son envoi.</p>
                </div>
            </div>`;
        document.querySelectorAll('#page-devis .faq-question').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.nextElementSibling.classList.toggle('hidden');
                btn.querySelector('svg').classList.toggle('rotate-180');
            });
        });
    }

    const devisForm = document.getElementById('devis-form');
    if (devisForm) {
        const productList = document.getElementById('product-list');
        const addProductBtn = document.getElementById('add-product');
        let productCount = 0;
        
        const createProductBlock = () => {
            productCount++;
            const div = document.createElement('div');
            div.className = 'p-5 border-2 border-gray-200 rounded-xl bg-gray-50/50 relative';
            div.innerHTML = `<h4 class="font-bold text-md text-gray-800 mb-4">Produit ${productCount}</h4> ${productCount > 1 ? '<button type="button" class="absolute top-4 right-4 text-red-500 hover:text-red-700 text-2xl font-bold remove-product">&times;</button>' : ''}<div class="space-y-4"><div><label class="text-sm font-semibold text-gray-600">Nom</label><input type="text" name="product_name_${productCount}" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div><div><label class="text-sm font-semibold text-gray-600">Lien</label><input type="url" name="product_link_${productCount}" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div><div><label class="text-sm font-semibold text-gray-600">Spécification</label><textarea name="product_spec_${productCount}" rows="2" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></textarea></div><div><label class="text-sm font-semibold text-gray-600">Quantité</label><input type="number" name="product_quantity_${productCount}" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div></div>`;
            productList.appendChild(div);
            div.querySelector('.remove-product')?.addEventListener('click', () => div.remove());
        };
        addProductBtn.addEventListener('click', createProductBlock);

        const confirmationModal = document.getElementById('confirmation-modal');
        const closeAndResetDevisModal = () => {
            confirmationModal.style.display = 'none';
            devisForm.reset();
            productList.innerHTML = '';
            productCount = 0;
            createProductBlock();
        };
        
        devisForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(devisForm);
            let text = `*Nouvelle Demande de Devis - ARIDAGO*\n\n*Client:* ${formData.get('nom')}\n*WhatsApp:* ${formData.get('whatsapp')}\n*Adresse:* ${formData.get('adresse')}\n-----------------------------------\n\n`;
            for (let i = 1; i <= productCount; i++) {
                if (formData.get(`product_name_${i}`)) {
                    text += `*Produit ${i}:* ${formData.get(`product_name_${i}`)}\n*Spécification:* ${formData.get(`product_spec_${i}`)}\n*Quantité:* ${formData.get(`product_quantity_${i}`)}\n*Lien:* ${formData.get(`product_link_${i}`)}\n\n`;
                }
            }
            document.getElementById('whatsapp-link').href = `https://wa.me/8615600021123?text=${encodeURIComponent(text)}`;
            confirmationModal.style.display = 'flex';
        });

        document.getElementById('whatsapp-link').addEventListener('click', () => setTimeout(closeAndResetDevisModal, 1500));
        document.getElementById('close-confirmation-modal').addEventListener('click', closeAndResetDevisModal);
        createProductBlock();
    }
    
    // LOGIQUE ÉCHANGE
    function initExchangeCalculator() {
        const fromAmountInput = document.getElementById('from-amount');
        if (!fromAmountInput) return;

        const toAmountInput = document.getElementById('to-amount');
        const fromCurrencyBadge = document.getElementById('from-currency-badge');
        const toCurrencyBadge = document.getElementById('to-currency-badge');
        const rateDisplay = document.getElementById('rate-display');
        const swapButton = document.getElementById('swap-button');
        const exchangeWhatsappBtn = document.getElementById('exchange-whatsapp-btn');
        const paymentOptionsContainer = document.getElementById('payment-options-from');
        const receptionOptionsContainer = document.getElementById('reception-options-to');

        let rates = { RMB_TO_MGA: 615, MGA_TO_RMB_DIVISOR: 625 };
        let isRmbToMga = false;

        const paymentMethods = {
            RMB: [{ id: 'alipay', name: 'Alipay' }, { id: 'wechatpay', name: 'WeChat Pay' }],
            MGA: [{ id: 'espece', name: 'Espèce' }, { id: 'mvola', name: 'MVola' }, { id: 'orangemoney', name: 'Orange Money' }, { id: 'airtelmoney', name: 'Airtel Money' }]
        };
        const receptionMethods = {
            RMB: [{ id: 'recept-alipay', name: 'Alipay' }, { id: 'recept-wechatpay', name: 'WeChat Pay' }],
            MGA: [{ id: 'recept-espece', name: 'Espèce' }, { id: 'recept-mvola', name: 'MVola' }, { id: 'recept-orangemoney', name: 'Orange Money' }, { id: 'recept-airtelmoney', name: 'Airtel Money' }]
        };

        const renderSelect = (container, id, methods) => {
            container.innerHTML = `<div class="relative">
                <select id="${id}" name="${id}" class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 pr-10 focus:outline-none focus:ring-2 focus:ring-yellow-400 appearance-none">
                    ${methods.map(opt => `<option value="${opt.name}">${opt.name}</option>`).join('')}
                </select>
                <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
            </div>`;
        };

        const updateDisplay = () => {
            const fromCurrency = isRmbToMga ? 'RMB' : 'MGA';
            const toCurrency = isRmbToMga ? 'MGA' : 'RMB';
            
            fromCurrencyBadge.textContent = fromCurrency;
            toCurrencyBadge.textContent = toCurrency;
            fromCurrencyBadge.className = `flex-shrink-0 text-white px-3 py-1 sm:px-4 sm:py-2 rounded-full text-base sm:text-lg font-bold flex items-center ${isRmbToMga ? 'bg-red-600' : 'bg-green-600'}`;
            toCurrencyBadge.className = `flex-shrink-0 text-white px-3 py-1 sm:px-4 sm:py-2 rounded-full text-base sm:text-lg font-bold flex items-center ${isRmbToMga ? 'bg-green-600' : 'bg-red-600'}`;
            rateDisplay.textContent = isRmbToMga ? `Cours de Change : 1 RMB ≈ ${rates.RMB_TO_MGA} MGA` : `Cours de Change : ${rates.MGA_TO_RMB_DIVISOR} MGA ≈ 1 RMB`;

            renderSelect(paymentOptionsContainer, 'payment-method-select', paymentMethods[fromCurrency]);
            renderSelect(receptionOptionsContainer, 'reception-method-select', receptionMethods[toCurrency]);
        };

        const calculate = (isFromInput) => {
            const fromValue = parseFloat(fromAmountInput.value);
            const rateMgaToRmb = 1 / rates.MGA_TO_RMB_DIVISOR;
            if (isFromInput) {
                if (!fromValue > 0) { toAmountInput.value = ''; return; }
                toAmountInput.value = (isRmbToMga ? fromValue * rates.RMB_TO_MGA : fromValue * rateMgaToRmb).toFixed(2);
            } else {
                const toValue = parseFloat(toAmountInput.value);
                if (!toValue > 0) { fromAmountInput.value = ''; return; }
                fromAmountInput.value = (isRmbToMga ? toValue / rates.RMB_TO_MGA : toValue / rateMgaToRmb).toFixed(2);
            }
        };

        fromAmountInput.addEventListener('input', () => calculate(true));
        toAmountInput.addEventListener('input', () => calculate(false));
        swapButton.addEventListener('click', () => {
            isRmbToMga = !isRmbToMga;
            fromAmountInput.value = '';
            toAmountInput.value = '';
            updateDisplay();
        });

        exchangeWhatsappBtn.addEventListener('click', () => {
            const fromAmount = parseFloat(fromAmountInput.value).toFixed(2);
            const toAmount = parseFloat(toAmountInput.value).toFixed(2);
            const paymentValue = document.getElementById('payment-method-select').value;
            const receptionValue = document.getElementById('reception-method-select').value;

            if (!(fromAmount > 0) || !(toAmount > 0)) {
                alert("Veuillez entrer un montant valide.");
                return;
            }

            const fromCurrency = isRmbToMga ? 'RMB' : 'MGA';
            const toCurrency = isRmbToMga ? 'MGA' : 'RMB';
            const exchangeRateText = isRmbToMga ? `${rates.RMB_TO_MGA} Ariary / Rmb` : `${rates.MGA_TO_RMB_DIVISOR} Ariary / Rmb`;

            const message = `NOUVELLE DEMANDE DE TRANSFERT D'ARGENT - ARIDAGO\n\n` +
                            `-----------------------------------\n` +
                            `Montant envoyé : ${fromAmount} ${fromCurrency}\n` +
                            `Montant à recevoir : ${toAmount} ${toCurrency}\n` +
                            `-----------------------------------\n` +
                            `Cours de Change: ${exchangeRateText}\n` +
                            `Moyen de paiement : ${paymentValue}\n` +
                            `Moyen de réception : ${receptionValue}`;

            window.open(`https://wa.me/8615600021123?text=${encodeURIComponent(message)}`, '_blank');
        });

        settingsCollection.doc('exchangeRates').get().then(doc => {
            if (doc.exists) {
                const data = doc.data();
                rates.RMB_TO_MGA = data.rmbToMga || rates.RMB_TO_MGA;
                rates.MGA_TO_RMB_DIVISOR = data.mgaToRmbDivisor || rates.MGA_TO_RMB_DIVISOR;
            }
        }).catch(err => console.error("Erreur de chargement des taux", err)).finally(updateDisplay);
    }
    
    // LOGIQUE ADMIN
    function initAdminPanel() {
        const adminSection = document.getElementById('page-admin');
        if (!adminSection) return;

        adminSection.innerHTML = `<div class="bg-slate-800 text-white p-6 md:p-10 rounded-3xl shadow-lg">
            <div id="admin-login">
                <h2 class="text-3xl font-bold text-center mb-4">Accès Administrateur</h2>
                <div class="max-w-sm mx-auto">
                    <div class="mb-4"><label for="admin-email" class="block text-sm font-semibold mb-1">Email</label><input type="email" id="admin-email" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white"></div>
                    <div class="mb-4"><label for="admin-password" class="block text-sm font-semibold mb-1">Mot de passe</label><input type="password" id="admin-password" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white"></div>
                    <button id="admin-login-btn" class="mt-4 w-full btn-primary font-bold py-3 px-4 rounded-xl">Se connecter</button>
                    <p id="admin-error" class="text-red-400 text-center mt-2 hidden"></p>
                </div>
            </div>
            <div id="admin-dashboard" class="hidden">
                 <h2 class="font-poppins text-3xl font-bold mb-6">Tableau de bord</h2>
                <div id="admin-stats" class="grid grid-cols-2 gap-4 mb-8"></div>

                <div class="bg-gray-700 p-6 rounded-2xl mb-8">
                    <h3 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-chart-line mr-3 text-green-400"></i>Gestion des Taux de Change</h3>
                    <div class="space-y-4">
                        <div>
                            <label for="admin-rate-rmb-mga" class="block text-sm font-semibold mb-1">Cours de Vente (1 RMB = X MGA)</label>
                            <input type="number" id="admin-rate-rmb-mga" step="any" placeholder="Ex: 615" class="w-full bg-gray-600 rounded-lg p-2 text-white">
                        </div>
                        <div>
                            <label for="admin-rate-mga-rmb" class="block text-sm font-semibold mb-1">Cours d'Achat (X MGA = 1 RMB)</label>
                            <input type="number" id="admin-rate-mga-rmb" step="any" placeholder="Ex: 625" class="w-full bg-gray-600 rounded-lg p-2 text-white">
                        </div>
                        <button id="admin-save-rates-btn" class="w-full btn-secondary font-bold py-2 px-4 rounded-lg flex items-center justify-center">
                            <i class="fas fa-save mr-2"></i>Sauvegarder les Cours
                        </button>
                        <p id="admin-rates-status" class="text-sm text-green-400 mt-1 text-center h-4"></p>
                    </div>
                </div>
                
                <div class="bg-gray-700 p-6 rounded-2xl mb-8 border-2 border-dashed border-yellow-400">
                    <h3 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-magic mr-3 text-yellow-400"></i>Générateur de Fiche Produit par IA</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold mb-1">Nom ou mots-clés du produit</label>
                            <input type="text" id="ai-text-name" placeholder="Ex: Sac à dos de voyage, Thermos intelligent..." class="w-full bg-gray-600 rounded-lg p-2 text-white">
                        </div>
                        <button id="ai-generate-text-btn" class="w-full btn-primary font-bold py-2 px-4 rounded-lg flex items-center justify-center disabled:opacity-50">
                            <i class="fas fa-rocket mr-2"></i>Générer la description
                        </button>
                        <p id="ai-text-status" class="text-sm text-yellow-400 mt-1 text-center h-4"></p>
                    </div>
                </div>

                <div class="bg-gray-700 p-6 rounded-2xl mb-8">
                    <h3 id="admin-form-title" class="text-xl font-bold mb-4">Fiche Produit</h3>
                    <form id="admin-product-form" class="space-y-4">
                        <input type="hidden" id="product-id">
                        <div><label>Nom</label><input type="text" id="product-name" required class="w-full bg-gray-600 rounded-lg p-2 text-white"></div>
                        <div><label>Catégorie</label><input type="text" id="product-category" list="category-suggestions" class="w-full bg-gray-600 rounded-lg p-2 text-white"><datalist id="category-suggestions"></datalist></div>
                        <div><label>Description</label><textarea id="product-description" required class="w-full bg-gray-600 rounded-lg p-2 text-white" rows="6"></textarea></div>
                        <div><label>Prix (Ar)</label><input type="number" id="product-price" class="w-full bg-gray-600 rounded-lg p-2 text-white"></div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="flex items-center"><input type="checkbox" id="product-in-stock" class="w-4 h-4 text-red-600 bg-gray-700 border-gray-600 rounded focus:ring-red-500"><label for="product-in-stock" class="ml-2 text-sm font-medium text-white">Disponible à Mada</label></div>
                            <div class="flex items-center"><input type="checkbox" id="product-featured" class="w-4 h-4 text-yellow-400 bg-gray-700 border-gray-600 rounded focus:ring-yellow-500"><label for="product-featured" class="ml-2 text-sm font-medium text-white">Mettre en avant</label></div>
                        </div>
                        <div><label>Image(s)</label><div class="flex flex-wrap gap-2 mt-2 items-center"><div id="image-preview-container" class="flex flex-wrap gap-2"></div><label for="product-image-upload" class="cursor-pointer w-16 h-16 bg-gray-600 rounded flex items-center justify-center text-gray-400 hover:bg-gray-500"><i class="fas fa-plus"></i></label></div><input type="file" id="product-image-upload" multiple accept="image/*" class="hidden"><input type="hidden" id="product-images-json"><p id="upload-status" class="text-sm text-yellow-400 mt-1"></p></div>
                        <div class="flex gap-4"><button type="submit" id="admin-submit-btn" class="w-full btn-secondary font-bold py-2 px-4 rounded-lg">Ajouter</button><button type="button" id="admin-cancel-btn" class="w-full bg-gray-500 font-bold py-2 px-4 rounded-lg hidden">Annuler</button></div>
                    </form>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Produits existants</h3>
                    <div id="admin-product-list" class="space-y-4"></div>
                </div>
                <div class="mt-8 flex flex-wrap gap-4 items-center">
                    <button id="admin-logout-btn" class="bg-red-600 hover:bg-red-700 font-bold py-2 px-4 rounded-lg">Se déconnecter</button>
                    <a href="https://rakotobewangyu-dev.github.io/Facturation/" target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg inline-flex items-center"><i class="fas fa-file-invoice-dollar mr-2"></i>Facturation</a>
                </div>
            </div>
        </div>`;
        
        const adminLogin = document.getElementById('admin-login');
        const adminDashboard = document.getElementById('admin-dashboard');
        const adminLoginBtn = document.getElementById('admin-login-btn');
        const adminLogoutBtn = document.getElementById('admin-logout-btn');
        const adminProductForm = document.getElementById('admin-product-form');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        const deleteConfirmModal = document.getElementById('delete-confirm-modal');
        const adminProductList = document.getElementById('admin-product-list');

        auth.onAuthStateChanged(user => {
            adminLogin.classList.toggle('hidden', !!user);
            adminDashboard.classList.toggle('hidden', !user);
            if(user) {
                renderAdminStats();
                renderAdminList();
                initAdminRateManagement();
                initAiFeatures();
            }
        });

        adminLoginBtn.addEventListener('click', () => {
            auth.signInWithEmailAndPassword(document.getElementById('admin-email').value, document.getElementById('admin-password').value)
                .catch(err => document.getElementById('admin-error').textContent = "Email ou mot de passe incorrect.");
        });
        adminLogoutBtn.addEventListener('click', () => auth.signOut());
        
        cancelDeleteBtn.addEventListener('click', () => deleteConfirmModal.style.display = 'none');
        confirmDeleteBtn.addEventListener('click', async () => {
            await productsCollection.doc(confirmDeleteBtn.dataset.id).delete();
            deleteConfirmModal.style.display = 'none';
            loadAndRenderProducts();
        });
        
        document.getElementById('product-image-upload').addEventListener('change', async (e) => {
            if (!e.target.files.length) return;
            document.getElementById('upload-status').textContent = `Téléversement en cours...`;
            try {
                const urls = await Promise.all(Array.from(e.target.files).map(uploadToImgBB));
                let currentImages = JSON.parse(document.getElementById('product-images-json').value || '[]');
                currentImages.push(...urls);
                document.getElementById('product-images-json').value = JSON.stringify(currentImages);
                renderImagePreviews(currentImages);
                document.getElementById('upload-status').textContent = `Prêt.`;
            } catch (error) {
                document.getElementById('upload-status').textContent = `Erreur: ${error.message}`;
            }
        });
        
        async function uploadToImgBB(file) {
            const formData = new FormData();
            formData.append('image', file);
            const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData });
            if (!res.ok) throw new Error('Échec du téléversement');
            const data = await res.json();
            return data.data.url;
        }

        function renderImagePreviews(images) {
            const container = document.getElementById('image-preview-container');
            container.innerHTML = images.map((url, i) => `<div class="relative"><img src="${url}" class="w-16 h-16 object-cover rounded"><button type="button" class="absolute -top-1 -right-1 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs delete-img-btn" data-index="${i}">&times;</button></div>`).join('');
            container.querySelectorAll('.delete-img-btn').forEach(btn => btn.addEventListener('click', e => {
                let currentImages = JSON.parse(document.getElementById('product-images-json').value);
                currentImages.splice(e.currentTarget.dataset.index, 1);
                document.getElementById('product-images-json').value = JSON.stringify(currentImages);
                renderImagePreviews(currentImages);
            }));
        }

        function resetAdminForm() {
            adminProductForm.reset();
            document.getElementById('product-id').value = '';
            document.getElementById('product-images-json').value = '[]';
            document.getElementById('upload-status').textContent = '';
            renderImagePreviews([]);
            document.getElementById('admin-submit-btn').textContent = 'Ajouter';
            document.getElementById('admin-cancel-btn').classList.add('hidden');
        }

        adminProductForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('product-id').value;
            const data = {
                name: document.getElementById('product-name').value,
                category: document.getElementById('product-category').value.trim() || null,
                description: document.getElementById('product-description').value,
                price: parseFloat(document.getElementById('product-price').value) || 0,
                inStockMadagascar: document.getElementById('product-in-stock').checked,
                isFeatured: document.getElementById('product-featured').checked,
                images: JSON.parse(document.getElementById('product-images-json').value || '[]')
            };

            if (id) await productsCollection.doc(id).update(data);
            else await productsCollection.add(data);
            
            resetAdminForm();
            loadAndRenderProducts();
        });
        
        document.getElementById('admin-cancel-btn').addEventListener('click', resetAdminForm);

        const renderAdminStats = () => {
             document.getElementById('admin-stats').innerHTML = `
                <div class="bg-gray-700 p-4 rounded-lg text-center">
                    <p class="text-3xl font-bold">${boutiqueProducts.length}</p>
                    <p class="text-sm text-gray-400">Produits au total</p>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg text-center">
                    <p class="text-3xl font-bold">${boutiqueProducts.filter(p => p.inStockMadagascar).length}</p>
                    <p class="text-sm text-gray-400">En stock à Mada</p>
                </div>
            `;
        };
        const renderAdminList = () => {
            const categories = [...new Set(boutiqueProducts.map(p => p.category).filter(Boolean))];
            document.getElementById('category-suggestions').innerHTML = categories.map(c => `<option value="${c}"></option>`).join('');

            adminProductList.innerHTML = boutiqueProducts.map(p => `
                <div class="bg-gray-600 p-3 rounded-lg flex items-center justify-between">
                    <div class="flex items-center gap-3 overflow-hidden">
                        <span class="h-3 w-3 rounded-full ${p.inStockMadagascar ? 'bg-green-500' : 'bg-yellow-500'} flex-shrink-0"></span>
                        <i class="fas fa-star ${p.isFeatured ? 'text-yellow-400' : 'text-gray-400/20'}"></i>
                        <div class="truncate"><p class="font-bold truncate">${p.name}</p><p class="text-xs text-gray-400 truncate">${p.category || 'Sans catégorie'}</p></div>
                    </div>
                    <div class="flex space-x-2 flex-shrink-0">
                        <button class="edit-product-btn bg-blue-500 px-3 py-1 rounded text-white text-sm" data-id="${p.id}">Modifier</button>
                        <button class="delete-product-btn bg-red-500 px-3 py-1 rounded text-white text-sm" data-id="${p.id}">Supprimer</button>
                    </div>
                </div>`).join('');
            
            adminProductList.querySelectorAll('.edit-product-btn').forEach(btn => btn.addEventListener('click', e => {
                const p = boutiqueProducts.find(prod => prod.id === e.currentTarget.dataset.id);
                document.getElementById('product-id').value = p.id;
                document.getElementById('product-name').value = p.name;
                document.getElementById('product-category').value = p.category || '';
                document.getElementById('product-description').value = p.description;
                document.getElementById('product-price').value = p.price || '';
                document.getElementById('product-in-stock').checked = p.inStockMadagascar;
                document.getElementById('product-featured').checked = p.isFeatured;
                document.getElementById('product-images-json').value = JSON.stringify(p.images || []);
                renderImagePreviews(p.images || []);
                document.getElementById('admin-submit-btn').textContent = 'Mettre à jour';
                document.getElementById('admin-cancel-btn').classList.remove('hidden');
                window.scrollTo(0, document.getElementById('admin-form-title').offsetTop);
            }));
            
            adminProductList.querySelectorAll('.delete-product-btn').forEach(btn => btn.addEventListener('click', e => {
                confirmDeleteBtn.dataset.id = e.currentTarget.dataset.id;
                deleteConfirmModal.style.display = 'flex';
            }));
        };

        function initAdminRateManagement() {
            const rmbMgaInput = document.getElementById('admin-rate-rmb-mga');
            const mgaRmbInput = document.getElementById('admin-rate-mga-rmb');
            const saveBtn = document.getElementById('admin-save-rates-btn');
            const statusEl = document.getElementById('admin-rates-status');

            settingsCollection.doc('exchangeRates').get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    if (data.rmbToMga) rmbMgaInput.value = data.rmbToMga;
                    if (data.mgaToRmbDivisor) mgaRmbInput.value = data.mgaToRmbDivisor;
                }
            });

            saveBtn.addEventListener('click', async () => {
                const rmbToMga = parseFloat(rmbMgaInput.value);
                const mgaToRmbDivisor = parseFloat(mgaRmbInput.value);
                if (isNaN(rmbToMga) || isNaN(mgaToRmbDivisor)) {
                    statusEl.textContent = "Taux invalides.";
                    return;
                }
                saveBtn.disabled = true;
                await settingsCollection.doc('exchangeRates').set({ rmbToMga, mgaToRmbDivisor }, { merge: true });
                statusEl.textContent = "Cours sauvegardés !";
                saveBtn.disabled = false;
                setTimeout(() => { statusEl.textContent = ''; }, 3000);
            });
        }
        
        async function callGenerativeApi(url, payload) {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) throw new Error(`Erreur API: ${response.statusText}`);
            return response.json();
        }

        function initAiFeatures() {
            const aiTextName = document.getElementById('ai-text-name');
            const aiGenerateTextBtn = document.getElementById('ai-generate-text-btn');
            const aiTextStatus = document.getElementById('ai-text-status');

            aiGenerateTextBtn.addEventListener('click', async () => {
                const productName = aiTextName.value.trim();
                if (!productName) {
                    aiTextStatus.textContent = 'Veuillez fournir un nom ou des mots-clés.';
                    return;
                }

                aiTextStatus.textContent = 'Génération du texte en cours...';
                aiGenerateTextBtn.disabled = true;

                try {
                    const apiKey = "AIzaSyDeTIQtd0xLZAIamRfajdQd2vAGrjIWGi4";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                    const prompt = `En tant qu'assistant de fiche produit, génère une description pour "${productName}". La description doit commencer par une seule phrase d'accroche courte et percutante. Juste après, à la ligne, continue avec une liste à puces concise (- Caractéristique : Valeur) des spécifications techniques et des caractéristiques clés. La réponse doit être en texte brut, sans formatage Markdown. Format attendu : NOM : [Nom clair du produit] ;;; DESCRIPTION : [Phrase d'accroche.]\n\n- Spécification : ...\n- Autre Spécification : ...`;

                    const payload = { contents: [{ parts: [{ text: prompt }] }] };
                    const result = await callGenerativeApi(apiUrl, payload);
                    const text = result.candidates[0].content.parts[0].text;
                    
                    const parts = text.split(';;;');
                    const generatedName = parts[0].replace('NOM :', '').trim();
                    const generatedDesc = parts[1].replace('DESCRIPTION :', '').trim();

                    document.getElementById('product-name').value = generatedName;
                    document.getElementById('product-description').value = generatedDesc;
                    aiTextStatus.textContent = 'Description générée avec succès !';

                } catch (error) {
                    console.error('Erreur du générateur de texte IA:', error);
                    aiTextStatus.textContent = `Erreur: ${error.message}`;
                } finally {
                    aiGenerateTextBtn.disabled = false;
                }
            });
        }
    }

    // APPEL INITIAL
    loadAndRenderProducts();
    initSearchFunctionality();
    initExchangeCalculator();
    renderDevisFaq();
    initAdminPanel();
});
</script>
</body>
</html>

