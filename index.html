<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aridago - Boutique et Devis</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            [cite_start]font-family: 'Poppins', sans-serif; [cite: 1]
            [cite_start]background-color: #FFFBEB; [cite: 2]
        }
        :root {
            [cite_start]--primary-color: #d92a2a; [cite: 3]
            [cite_start]--secondary-color: #f7b731; [cite: 3]
        }
        .nav-link-underline::after {
            [cite_start]content: ''; [cite: 4]
            [cite_start]position: absolute; [cite: 4]
            [cite_start]bottom: -4px; [cite: 4]
            [cite_start]left: 0; [cite: 4]
            [cite_start]width: 0; [cite: 4]
            [cite_start]height: 2px; [cite: 4]
            [cite_start]background-color: var(--primary-color); [cite: 4]
            [cite_start]transition: width 0.3s; [cite: 4]
        }
        .nav-link-underline:hover::after, .nav-link-active::after {
            [cite_start]width: 100%; [cite: 5]
        }
        .text-gradient {
            [cite_start]background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); [cite: 6]
            [cite_start]-webkit-background-clip: text; [cite: 7]
            [cite_start]-webkit-text-fill-color: transparent; [cite: 7]
        }
        .btn-primary {
            [cite_start]background: linear-gradient(90deg, #d92a2a, #f7b731); [cite: 8]
            [cite_start]color: white; [cite: 8]
        }
        .btn-secondary {
            [cite_start]background-color: #2ab57d; [cite: 9]
            [cite_start]color: white; [cite: 9]
        }
        .btn-secondary:hover {
            [cite_start]background-color: #2a9d8f; [cite: 10]
        }
        .btn-whatsapp {
            [cite_start]background: linear-gradient(90deg, #25D366, #128C7E); [cite: 11]
            [cite_start]color: white; [cite: 11]
        }
        .theme-gradient-text {
            [cite_start]background: linear-gradient(90deg, #d92a2a, #f7b731); [cite: 12]
            [cite_start]-webkit-background-clip: text; [cite: 12]
            [cite_start]-webkit-text-fill-color: transparent; [cite: 12]
        }
        .theme-gradient-bg { 
            [cite_start]background: linear-gradient(90deg, #d92a2a, #f7b731); [cite: 13]
        }
        .modal-backdrop { 
            [cite_start]background-color: rgba(0,0,0,0.6); [cite: 14]
            [cite_start]display: flex; [cite: 14]
            [cite_start]align-items: center; [cite: 14]
            [cite_start]justify-content: center; [cite: 14]
        }
        .hidden {
            [cite_start]display: none; [cite: 15]
        }
        .rotate-180 {
            [cite_start]transform: rotate(180deg); [cite: 16]
        }
        #confirmation-modal, #price-alert-modal, #link-alert-modal, #delete-confirm-modal {
            [cite_start]display: none; [cite: 17]
        }

        /* Styles pour l'outil de quotation intégré */
        .quotation-form-section {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            margin-bottom: 2rem;
        }
        .quotation-form-section h2 {
            border-bottom: 2px solid #ef4444;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        #quotation-preview-content {
            background: white;
            border: 1px solid #e5e7eb;
            font-family: 'Helvetica', 'Arial', sans-serif;
            color: #111827;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 2px solid #facc15;
        }
        #quotation-preview-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }
        #quotation-preview-content th, #quotation-preview-content td {
            border: 1px solid #d1d5db;
            padding: 0.75rem;
            font-size: 0.85rem;
        }
        #quotation-preview-content th {
            background-color: #16a34a;
            color: white;
            font-weight: bold;
        }
        #quotation-preview-content .text-right { text-align: right; }
        #quotation-preview-content .text-center { text-align: center; }
        #quotation-preview-content .font-bold { font-weight: bold; }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-2 sm:px-4 py-2 flex justify-between items-center">
            <div class="flex items-center space-x-2 sm:space-x-4">
                <a href="#" class="nav-link flex-shrink-0" data-page="accueil">
                     [cite_start]<img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="h-14 md:h-16 w-auto"> [cite: 18]
                </a>
                <nav class="flex items-center space-x-2 text-xs sm:space-x-4 md:space-x-6 sm:text-sm md:text-base">
                    [cite_start]<a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline nav-link-active" data-page="accueil">Accueil</a> [cite: 19]
                    [cite_start]<a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline" data-page="boutique">Boutique</a> [cite: 19]
                    [cite_start]<a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline" data-page="devis">Devis</a> [cite: 19]
                    [cite_start]<a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline" data-page="apropos">À Propos</a> [cite: 19]
                </nav>
            </div>
            
            [cite_start]<div class="flex items-center"> [cite: 20]
                [cite_start]<button id="admin-link-header" class="text-slate-700 hover:text-red-600 text-lg p-2"><i class="fas fa-user-shield"></i></button> [cite: 20]
            [cite_start]</div> [cite: 20]
        </div>
    </header>

    [cite_start]<div style="background: linear-gradient(90deg, #d92a2a, #f7b731);" class="text-white text-center py-2"> [cite: 21]
        [cite_start]<p class="text-sm font-semibold px-2">Votre partenaire d'achat en Chine | [cite: 22]
[cite_start]Simple, rapide et fiable</p> [cite: 22]
    </div>

    <main>

        <section id="page-accueil" class="page-content">
            <div class="relative bg-slate-900 text-white flex items-center justify-center min-h-[500px] overflow-hidden">
                <div class="absolute inset-0 bg-cover bg-center opacity-30" style="background-image: url('https://images.unsplash.com/photo-1578575437130-5278ce685a21?auto=format&fit=crop&w=1500&q=80');"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/50 to-transparent"></div>
                [cite_start]<div class="relative text-center max-w-3xl px-4 z-10"> [cite: 23]
                    [cite_start]<h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">Commander en Chine ?<br>C'est maintenant <span class="text-gradient">simple et rapide !</span></h1> [cite: 23]
                    [cite_start]<p class="text-lg md:text-xl text-slate-300 mb-8">Nous sommes votre intermédiaire de confiance pour tous vos achats en Chine, livrés à Madagascar.</p> [cite: 23]
                    [cite_start]<a href="#" class="btn-primary font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 shadow-lg nav-link" data-page="devis">Faire une commande</a> [cite: 24]
                </div>
            </div>

            <section class="bg-white py-12 md:py-16">
                <div class="container mx-auto px-4">
                    [cite_start]<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 text-center"> [cite: 25]
                        [cite_start]<div class="feature p-4"> [cite: 25]
                            [cite_start]<i class="fas fa-search-dollar text-4xl text-red-600 mb-4"></i> [cite: 25]
                            [cite_start]<h3 class="font-bold text-lg mb-2">Recherche de produits</h3> [cite: 25]
                            [cite_start]<p class="text-slate-600">Nous trouvons pour vous les meilleurs produits au meilleur prix.</p> [cite: 26]
                        [cite_start]</div> [cite: 25]
                        [cite_start]<div class="feature p-4"> [cite: 25]
                            [cite_start]<i class="fas fa-handshake text-4xl text-red-600 mb-4"></i> [cite: 27]
                            [cite_start]<h3 class="font-bold text-lg mb-2">Intermédiaire de confiance</h3> [cite: 27]
                            [cite_start]<p class="text-slate-600">Nous gérons l'achat, la vérification et le paiement pour vous.</p> [cite: 27]
                        [cite_start]</div> [cite: 28]
                        [cite_start]<div class="feature p-4"> [cite: 28]
                            [cite_start]<i class="fas fa-shipping-fast text-4xl text-red-600 mb-4"></i> [cite: 28]
                            [cite_start]<h3 class="font-bold text-lg mb-2">Transport sécurisé</h3> [cite: 29]
                            [cite_start]<p class="text-slate-600">Nous nous occupons de l'expédition de la Chine vers Madagascar.</p> [cite: 29]
                        [cite_start]</div> [cite: 28]
                    [cite_start]</div> [cite: 25]
                </div>
            [cite_start]</section> [cite: 30]

             [cite_start]<div id="popular-products-accueil" class="py-12 md:py-16"> [cite: 30]
                 [cite_start]</div> [cite: 30]
        </section>

        <section id="page-boutique" class="page-content hidden">
            <div class="container mx-auto px-4 py-12 md:py-16">
                 <div class="text-center mb-12">
                    [cite_start]<h2 class="text-3xl md:text-4xl font-bold mb-2">Notre Boutique</h2> [cite: 31]
                    [cite_start]<p class="text-slate-600 text-lg">Commandez directement nos articles sélectionnés pour vous, déjà à Madagascar.</p> [cite: 31]
                     <div class="mt-6 max-w-lg mx-auto relative flex items-center">
                        [cite_start]<input type="text" id="search-bar" placeholder="Rechercher par nom de produit..." class="w-full pl-6 pr-12 py-3 border-2 border-slate-200 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400 transition"> [cite: 32]
                        [cite_start]<button id="search-btn" class="absolute right-0 top-0 h-full w-12 flex items-center justify-center text-white rounded-r-full hover:opacity-90" style="background-color: var(--secondary-color);"> [cite: 32]
                            [cite_start]<i class="fas fa-search"></i> [cite: 32]
                        [cite_start]</button> [cite: 33]
                     [cite_start]</div> [cite: 31]
                 [cite_start]</div> [cite: 31]
                 [cite_start]<div id="product-grid" class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8"> [cite: 33]
                    [cite_start]<p id="loading-products" class="text-center text-gray-500 col-span-full">Chargement des produits...</p> [cite: 34]
                 [cite_start]</div> [cite: 33]
            </div>
        </section>

        <section id="page-devis" class="page-content hidden">
            <div class="container mx-auto max-w-4xl p-4 md:p-8">
        
                <header class="text-center mb-10">
                    [cite_start]<img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="mx-auto h-24 md:h-36 w-auto mb-6"> [cite: 35]
                    [cite_start]<h1 class="text-3xl md:text-5xl font-extrabold text-gray-800 leading-tight"> [cite: 35]
                        [cite_start]Commander en Chine ?<br>C'est maintenant <span class="theme-gradient-text">simple et rapide !</span> [cite: 35]
                    [cite_start]</h1> [cite: 36]
                    [cite_start]<p class="mt-4 text-base md:text-lg text-gray-600 max-w-2xl mx-auto"> [cite: 36]
                        [cite_start]Remplissez ce formulaire pour recevoir votre devis personnalisé directement sur WhatsApp. [cite: 36]
                    [cite_start]</p> [cite: 37]
                </header>

                <section class="mb-12">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 text-center">
                        <div class="bg-white p-6 rounded-2xl shadow-sm">
                            [cite_start]<div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">1</div> [cite: 38]
                            [cite_start]<h3 class="font-bold text-lg text-gray-800">Remplissez le formulaire</h3> [cite: 38]
                            [cite_start]<p class="text-gray-500 text-sm mt-1">Ajoutez les liens et détails de tous vos produits.</p> [cite: 38]
                        [cite_start]</div> [cite: 39]
                        [cite_start]<div class="bg-white p-6 rounded-2xl shadow-sm"> [cite: 39]
                            [cite_start]<div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">2</div> [cite: 39]
                            [cite_start]<h3 class="font-bold text-lg text-gray-800">Envoyez via WhatsApp</h3> [cite: 40]
                            [cite_start]<p class="text-gray-500 text-sm mt-1">Un clic suffit pour nous transmettre votre demande.</p> [cite: 40]
                        [cite_start]</div> [cite: 39]
                        [cite_start]<div class="bg-white p-6 rounded-2xl shadow-sm"> [cite: 41]
                            [cite_start]<div class="theme-gradient-bg w-12 h-12 flex items-center justify-center rounded-full text-white font-bold text-xl mx-auto mb-4">3</div> [cite: 41]
                            [cite_start]<h3 class="font-bold text-lg text-gray-800">Recevez la confirmation</h3> [cite: 41]
                            [cite_start]<p class="text-gray-500 text-sm mt-1">Nous vérifions et validons la commande avec vous.</p> [cite: 42]
                        [cite_start]</div> [cite: 41]
                    </div>
                </section>

                [cite_start]<main class="bg-white p-6 md:p-10 rounded-3xl shadow-lg"> [cite: 43]
                    [cite_start]<form id="devis-form"> [cite: 43]
                        [cite_start]<fieldset class="border-b-2 border-gray-100 pb-8"> [cite: 43]
                            [cite_start]<legend class="text-xl md:text-2xl font-bold text-gray-800 mb-6 flex items-center"> [cite: 43]
                                [cite_start]<span class="theme-gradient-bg w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full text-white font-bold mr-4 text-base md:text-lg">1</span> Vos informations [cite: 44]
                            [cite_start]</legend> [cite: 43]
                            [cite_start]<div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4"> [cite: 44]
                                [cite_start]<div><label for="nom" class="block text-sm font-semibold text-gray-600 mb-1">Nom</label><input type="text" id="nom" name="nom" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div> [cite: 45]
                                [cite_start]<div><label for="prenom" class="block text-sm font-semibold text-gray-600 mb-1">Prénom</label><input type="text" id="prenom" name="prenom" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div> [cite: 46]
                                [cite_start]<div><label for="whatsapp" class="block text-sm font-semibold text-gray-600 mb-1">Numéro WhatsApp</label><input type="tel" id="whatsapp" name="whatsapp" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div> [cite: 46]
                                [cite_start]<div><label for="email" class="block text-sm font-semibold text-gray-600 mb-1">Email (Optionnel)</label><input type="email" id="email" name="email" class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-yellow-400 transition"></div> [cite: 47]
                            [cite_start]</div> [cite: 44]
                        [cite_start]</fieldset> [cite: 43]
                        [cite_start]<fieldset class="mt-8"> [cite: 48]
                            [cite_start]<legend class="text-xl md:text-2xl font-bold text-gray-800 mb-6 flex items-center"> [cite: 48]
                                [cite_start]<span class="theme-gradient-bg w-8 h-8 md:w-10 md:h-10 flex items-center justify-center rounded-full text-white font-bold mr-4 text-base md:text-lg">2</span> Vos produits [cite: 48]
                            [cite_start]</legend> [cite: 48]
                            [cite_start]<div id="product-list" class="space-y-6"></div> [cite: 49]
                            [cite_start]<div class="mt-6"><button type="button" id="add-product" class="w-full flex items-center justify-center px-6 py-3 border-2 border-dashed border-red-300 text-sm font-semibold rounded-xl text-red-600 hover:bg-red-50 transition"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>Ajouter un autre produit</button></div> [cite: 49]
                        [cite_start]</fieldset> [cite: 50]
                        [cite_start]<div class="mt-10 text-center"> [cite: 50]
                            [cite_start]<button type="submit" class="inline-flex justify-center items-center py-3 px-8 md:py-4 md:px-16 text-base md:text-lg font-bold rounded-xl text-white btn-whatsapp shadow-lg hover:shadow-xl transform hover:scale-105 transition animate-pulse"> [cite: 50]
                                [cite_start]<ion-icon name="logo-whatsapp" class="mr-3 text-2xl"></ion-icon> [cite: 51]
                                [cite_start]Envoyer ma commande [cite: 51]
                            [cite_start]</button> [cite: 50]
                        [cite_start]</div> [cite: 52]
                    [cite_start]</form> [cite: 43]
                </main>

                <section class="mt-12 bg-white p-6 md:p-10 rounded-3xl shadow-lg">
                    [cite_start]<h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Questions fréquentes (FAQ)</h2> [cite: 52]
                    [cite_start]<div id="faq-container" class="space-y-2"> [cite: 53]
                        [cite_start]<div class="faq-item bg-gray-50 rounded-xl"> [cite: 53]
                            [cite_start]<button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center"> [cite: 53]
                                [cite_start]<span>Quels sont les frais de transport Chine-Madagascar ?</span> [cite: 54]
                                [cite_start]<svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> [cite: 54]
                            [cite_start]</button> [cite: 53]
                            [cite_start]<div class="faq-answer hidden px-4 pb-4 text-gray-600"> [cite: 55]
                                [cite_start]<p>Les frais de transport ne sont pas inclus dans le devis initial. [cite: 56]
[cite_start]Ils dépendent du poids et du volume total de votre commande. [cite: 56]
[cite_start]Nous vous fournirons une estimation détaillée de ces frais lors de la confirmation de votre commande.</p> [cite: 57]
                            [cite_start]</div> [cite: 55]
                        [cite_start]</div> [cite: 53]
                        [cite_start]<div class="faq-item bg-gray-50 rounded-xl"> [cite: 53]
                            [cite_start]<button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center"> [cite: 58]
                                [cite_start]<span>Quels sont les délais de livraison estimés ?</span> [cite: 58]
                                [cite_start]<svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> [cite: 59]
                            [cite_start]</button> [cite: 58]
                            [cite_start]<div class="faq-answer hidden px-4 pb-4 text-gray-600"> [cite: 59]
                                [cite_start]<p>Les délais varient en fonction du type de transport choisi (aérien ou maritime). [cite: 60]
[cite_start]En général, comptez entre 7 à 15 jours pour le transport aérien et 30 à 45 jours pour le transport maritime, après réception de tous vos articles dans notre entrepôt en Chine.</p> [cite: 61]
                            [cite_start]</div> [cite: 59]
                        [cite_start]</div> [cite: 62]
                        [cite_start]<div class="faq-item bg-gray-50 rounded-xl"> [cite: 62]
                            [cite_start]<button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center"> [cite: 62]
                                [cite_start]<span>Quels sont les moyens de paiement acceptés ?</span> [cite: 62]
                                [cite_start]<svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg> [cite: 63]
                            [cite_start]</button> [cite: 62]
                            [cite_start]<div class="faq-answer hidden px-4 pb-4 text-gray-600"> [cite: 63]
                                [cite_start]<p>Pour les paiements en <b>Yuan (CNY)</b>, nous acceptons : Alipay et WeChat Pay.<br>Pour les paiements en <b>Ariary (MGA)</b>, nous acceptons : MVola, Orange Money et Airtel Money.<br>Les détails vous seront communiqués lors de la validation de votre devis.</p> [cite: 64]
                            [cite_start]</div> [cite: 63]
                        [cite_start]</div> [cite: 65]
                    [cite_start]</div> [cite: 52]
                </section>
                
                <footer class="mt-12 text-center text-gray-500 text-sm">
                    [cite_start]<div class="flex justify-center items-center space-x-6 mb-4"> [cite: 66]
                        [cite_start]<a href="https://www.facebook.com/Aridagochine/" target="_blank" class="hover:text-blue-600 transition"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z"/></svg></a> [cite: 66]
                    [cite_start]</div> [cite: 66]
                    [cite_start]<p>&copy; [cite: 67]
[cite_start]<span class="current-year"></span> Aridago - Tous droits réservés.</p> [cite: 67]
                </footer>

            </div>
        </section>

        <section id="page-apropos" class="page-content hidden">
            <div class="relative bg-slate-800 text-white flex items-center justify-center pt-24 pb-16 overflow-hidden">
                [cite_start]<div class="absolute inset-0 bg-cover bg-center opacity-20" style="background-image: url('https://images.unsplash.com/photo-1578575437130-5278ce685a21?auto=format&fit=crop&w=1500&q=80');"></div> [cite: 68]
                [cite_start]<div class="absolute inset-0 bg-gradient-to-t from-slate-800 via-slate-800/70 to-transparent"></div> [cite: 68]
                [cite_start]<div class="relative text-center max-w-4xl px-4 z-10"> [cite: 68]
                    [cite_start]<h2 class="text-4xl md:text-5xl font-extrabold mb-4 leading-tight">Votre Partenaire de Confiance Pour la Chine</h2> [cite: 68]
                    [cite_start]<p class="text-lg md:text-xl text-slate-300">Nous avons créé Aridago pour rendre les achats en Chine simples, transparents et accessibles à tous depuis Madagascar.</p> [cite: 69]
                [cite_start]</div> [cite: 68]
            </div>

            <div class="bg-white">
                <div class="container mx-auto px-4 py-16 md:py-20">

                    [cite_start][cite: 70, 71]
                    [cite_start]<div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center mb-16 md:mb-24"> [cite: 71]
                        [cite_start]<div class="order-last md:order-first"> [cite: 71]
                            [cite_start]<h3 class="text-3xl font-bold mb-6 text-gradient">Qui sommes-nous ?</h3> [cite: 71]
                            [cite_start]<p class="text-slate-700 mb-4 text-base md:text-lg"> [cite: 72]
                                [cite_start]Fondé par des passionnés de commerce international basés à la fois à Madagascar et en Chine, Aridago est né d'un constat simple : l'accès aux produits chinois de qualité peut être complexe et intimidant. [cite: 72]
                            [cite_start]</p> [cite: 73]
                            [cite_start]<p class="text-slate-700 text-base md:text-lg"> [cite: 73]
                                [cite_start]Nous sommes une équipe d'experts dédiés à devenir votre partenaire de confiance, facilitant vos achats en Chine avec transparence et efficacité. [cite: 73]
                            [cite_start]</p> [cite: 74]
                        [cite_start]</div> [cite: 71]
                        [cite_start]<div> [cite: 74]
                            [cite_start]<img src="https://images.unsplash.com/photo-1560472354-b33ff0c44a43?auto=format&fit=crop&w=800&q=80" alt="Équipe Aridago" class="rounded-xl shadow-2xl transform hover:scale-105 transition-transform duration-300"> [cite: 74]
                        [cite_start]</div> [cite: 75]
                    [cite_start]</div> [cite: 71]

                    [cite_start][cite: 76]
                    [cite_start]<div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center mb-16 md:mb-24"> [cite: 76]
                        [cite_start]<div> [cite: 76]
                            [cite_start]<img src="https://images.unsplash.com/photo-1563013544-824ae1b704d3?auto=format&fit=crop&w=800&q=80" alt="Services Aridago" class="rounded-xl shadow-2xl transform hover:scale-105 transition-transform duration-300"> [cite: 76]
                        [cite_start]</div> [cite: 77]
                        [cite_start]<div> [cite: 77]
                            [cite_start]<h3 class="text-3xl font-bold mb-6 text-gradient">Que faisons-nous ?</h3> [cite: 77]
                            [cite_start]<p class="text-slate-700 mb-4 text-base md:text-lg"> [cite: 78]
                                [cite_start]Nous offrons un service complet d'intermédiaire d'achat. [cite: 79]
[cite_start]Vous avez trouvé un produit ? [cite: 79]
[cite_start]Nous nous occupons de tout : communication, négociation, et paiement sécurisé. [cite: 79]
                            [cite_start]</p> [cite: 80]
                            [cite_start]<p class="text-slate-700 text-base md:text-lg"> [cite: 80]
                                [cite_start]En plus, notre boutique vous propose une sélection de produits déjà en stock à Madagascar, prêts à être récupérés sur place pour une satisfaction immédiate. [cite: 80]
                            [cite_start]</p> [cite: 81]
                        [cite_start]</div> [cite: 77]
                    [cite_start]</div> [cite: 76]

                    <div class="text-center mb-16 md:mb-24">
                        [cite_start]<h3 class="text-3xl md:text-4xl font-bold mb-4">Notre Processus Simplifié</h3> [cite: 82]
                        [cite_start]<p class="text-slate-600 text-base md:text-lg max-w-2xl mx-auto">En quatre étapes claires, nous vous accompagnons de la recherche à la livraison.</p> [cite: 82]
                        [cite_start]<div class="mt-12 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 relative"> [cite: 82]
                            [cite_start]<div class="hidden md:block absolute top-10 left-0 w-full h-px bg-slate-200" style="z-index: 0;"></div> [cite: 83]
                            
                            [cite_start]<div class="relative z-10 flex flex-col items-center p-4 md:p-6"> [cite: 84]
                                [cite_start]<div class="theme-gradient-bg w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full text-white font-bold text-2xl md:text-3xl mx-auto mb-4 shadow-lg border-4 border-white">1</div> [cite: 84]
                                [cite_start]<h4 class="font-bold text-lg text-gray-800">Votre Demande</h4> [cite: 85]
                                [cite_start]<p class="text-gray-500 text-sm mt-1">Vous soumettez votre demande via notre formulaire de devis détaillé.</p> [cite: 85]
                            [cite_start]</div> [cite: 84]
                            [cite_start]<div class="relative z-10 flex flex-col items-center p-4 md:p-6"> [cite: 86]
                                [cite_start]<div class="theme-gradient-bg w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full text-white font-bold text-2xl md:text-3xl mx-auto mb-4 shadow-lg border-4 border-white">2</div> [cite: 86]
                                [cite_start]<h4 class="font-bold text-lg text-gray-800">Devis & Validation</h4> [cite: 87]
                                [cite_start]<p class="text-gray-500 text-sm mt-1">Nous vous envoyons un devis clair. [cite: 87]
[cite_start]Après votre accord, nous procédons à l'achat.</p> [cite: 88]
                            [cite_start]</div> [cite: 86]
                            [cite_start]<div class="relative z-10 flex flex-col items-center p-4 md:p-6"> [cite: 88]
                                [cite_start]<div class="theme-gradient-bg w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full text-white font-bold text-2xl md:text-3xl mx-auto mb-4 shadow-lg border-4 border-white">3</div> [cite: 89]
                                [cite_start]<h4 class="font-bold text-lg text-gray-800">Vérification</h4> [cite: 89]
                                [cite_start]<p class="text-gray-500 text-sm mt-1">Nous recevons et vérifions la qualité de vos produits dans notre entrepôt en Chine.</p> [cite: 90]
                            [cite_start]</div> [cite: 88]
                            [cite_start]<div class="relative z-10 flex flex-col items-center p-4 md:p-6"> [cite: 90]
                                [cite_start]<div class="theme-gradient-bg w-16 h-16 md:w-20 md:h-20 flex items-center justify-center rounded-full text-white font-bold text-2xl md:text-3xl mx-auto mb-4 shadow-lg border-4 border-white">4</div> [cite: 91]
                                [cite_start]<h4 class="font-bold text-lg text-gray-800">Expédition</h4> [cite: 91]
                                [cite_start]<p class="text-gray-500 text-sm mt-1">Nous expédions vos articles en toute sécurité vers Madagascar.</p> [cite: 91]
                            [cite_start]</div> [cite: 92]
                        </div>
                    </div>

                    [cite_start]<div class="bg-slate-50 rounded-2xl p-8 md:p-12 mb-16 md:mb-24"> [cite: 93]
                        [cite_start]<h3 class="text-3xl md:text-4xl font-bold mb-12 text-center text-gradient">Ce qui nous définit</h3> [cite: 93]
                        [cite_start]<div class="grid grid-cols-1 md:grid-cols-3 gap-8"> [cite: 93]
                            [cite_start]<div class="text-center p-8 bg-white rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300"> [cite: 94]
                                [cite_start]<div class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-6 rounded-full bg-red-100 flex items-center justify-center"> [cite: 94]
                                    [cite_start]<i class="fas fa-shield-alt text-3xl text-red-600"></i> [cite: 94]
                                [cite_start]</div> [cite: 95]
                                [cite_start]<h4 class="font-bold text-xl mb-2">Confiance</h4> [cite: 95]
                                [cite_start]<p class="text-slate-600">Transparence totale dans nos processus et nos tarifs pour une collaboration sereine.</p> [cite: 96]
                            [cite_start]</div> [cite: 94]
                            [cite_start]<div class="text-center p-8 bg-white rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300"> [cite: 96]
                                [cite_start]<div class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-6 rounded-full bg-yellow-100 flex items-center justify-center"> [cite: 97]
                                    [cite_start]<i class="fas fa-bolt text-3xl text-yellow-600"></i> [cite: 97]
                                [cite_start]</div> [cite: 97]
                                [cite_start]<h4 class="font-bold text-xl mb-2">Efficacité</h4> [cite: 98]
                                [cite_start]<p class="text-slate-600">Nous optimisons chaque étape pour vous garantir des délais de traitement rapides.</p> [cite: 98]
                            [cite_start]</div> [cite: 96]
                            [cite_start]<div class="text-center p-8 bg-white rounded-xl shadow-lg transform hover:-translate-y-2 transition-transform duration-300"> [cite: 99]
                                [cite_start]<div class="w-16 h-16 md:w-20 md:h-20 mx-auto mb-6 rounded-full bg-green-100 flex items-center justify-center"> [cite: 99]
                                    [cite_start]<i class="fas fa-hands-helping text-3xl text-green-600"></i> [cite: 100]
                                [cite_start]</div> [cite: 99]
                                [cite_start]<h4 class="font-bold text-xl mb-2">Accompagnement</h4> [cite: 100]
                                [cite_start]<p class="text-slate-600">Nous offrons un support personnalisé et réactif à chaque étape de votre commande.</p> [cite: 101]
                            [cite_start]</div> [cite: 99]
                        [cite_start]</div> [cite: 93]
                    [cite_start]</div> [cite: 93]

                    [cite_start]<div class="text-center theme-gradient-bg rounded-2xl p-10 text-white shadow-2xl"> [cite: 102]
                        [cite_start]<h3 class="text-3xl md:text-4xl font-bold mb-4">Prêt à simplifier vos achats ?</h3> [cite: 102]
                        [cite_start]<p class="text-lg md:text-xl mb-8 max-w-2xl mx-auto">Rejoignez les dizaines de clients qui nous font confiance pour leurs approvisionnements en Chine.</p> [cite: 103]
                        [cite_start]<div class="flex flex-col sm:flex-row justify-center items-center gap-4"> [cite: 103]
                            [cite_start]<a href="#" class="bg-white text-red-600 font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 shadow-lg nav-link" data-page="devis">Demander un devis</a> [cite: 103]
                            [cite_start]<a href="#" class="border-2 border-white text-white font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 hover:bg-white hover:text-red-600 nav-link" data-page="boutique">Explorer la Boutique</a> [cite: 104]
                        [cite_start]</div> [cite: 103]
                    [cite_start]</div> [cite: 102]
                [cite_start]</div> [cite: 105]
            </div>
        </section>

        <section id="page-detail" class="page-content hidden bg-white py-12"></section>

        <section id="page-admin" class="page-content hidden container mx-auto px-4 py-16">
        </section>

    </main>
    
    <footer class="bg-slate-900 text-white">
        <div class="container mx-auto px-4 py-10">
            [cite_start]<div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8 text-center md:text-left"> [cite: 106]
                [cite_start]<div> [cite: 106]
                     [cite_start]<img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="h-16 w-auto mb-4 mx-auto md:mx-0"> [cite: 106]
                    [cite_start]<p class="text-slate-400 mb-4">Votre intermédiaire d'achat N°1 en Chine. [cite: 107]
[cite_start]Qualité, confiance et service client.</p> [cite: 107]
                    [cite_start]<div class="flex space-x-4 justify-center md:justify-start"> [cite: 107]
                        [cite_start]<a href="https://www.facebook.com/Aridagochine/" target="_blank" class="w-10 h-10 bg-slate-700 hover:bg-red-600 rounded-full flex items-center justify-center transition-colors"><i class="fab fa-facebook-f"></i></a> [cite: 107]
                    [cite_start]</div> [cite: 107]
                [cite_start]</div> [cite: 108]
                 [cite_start]<div> [cite: 108]
                     [cite_start]<h3 class="text-xl font-bold mb-4 relative pb-2 inline-block md:block after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-10 after:h-0.5 after:bg-secondary-color">Liens Rapides</h3> [cite: 108]
                     [cite_start]<ul class="space-y-2"> [cite: 108]
                        [cite_start]<li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="accueil">Accueil</a></li> [cite: 109]
                        [cite_start]<li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="boutique">Boutique</a></li> [cite: 109]
                        [cite_start]<li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="devis">Devis sur Mesure</a></li> [cite: 109]
                        [cite_start]<li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="apropos">À Propos</a></li> [cite: 109]
                     [cite_start]</ul> [cite: 110]
                [cite_start]</div> [cite: 108]
                 [cite_start]<div> [cite: 110]
                     [cite_start]<h3 class="text-xl font-bold mb-4 relative pb-2 inline-block md:block after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-10 after:h-0.5 after:bg-secondary-color">Contact</h3> [cite: 110]
                     [cite_start]<ul class="space-y-3 text-slate-400"> [cite: 111]
                         [cite_start]<li class="flex items-center justify-center md:justify-start"><i class="fab fa-whatsapp w-5 mr-2 text-green-400"></i><span>+86 156 0002 1123</span></li> [cite: 111]
                         [cite_start]<li class="flex items-center justify-center md:justify-start"><i class="fas fa-envelope w-5 mr-2"></i><span>aridagoservice@hotmail.com</span></li> [cite: 111]
                     [cite_start]</ul> [cite: 111]
                [cite_start]</div> [cite: 112]
            </div>
            [cite_start]<div class="text-center pt-8 border-t border-slate-700"> [cite: 112]
                [cite_start]<p class="text-slate-500">&copy; [cite: 113]
[cite_start]<span id="year"></span> Aridago - Tous droits réservés.</p> [cite: 113]
            </div>
        </div>
    </footer>

    <a href="https://www.facebook.com/Aridagochine/" target="_blank" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center shadow-xl transform hover:scale-110 transition z-40" title="Contactez-nous sur Facebook">
        <svg class="w-7 h-7 md:w-8 md:h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z"></path></svg>
    </a>

    [cite_start]<div id="price-alert-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center m-4"><h3 class="text-lg font-bold text-gray-800">Attention sur le Prix Unitaire</h3><p class="text-gray-600 mt-2 text-sm">Afin de s'assurer que nous parlons bien du même produit au bon prix, veuillez indiquer le prix exact d'achat sur le site que vous avez choisi pour qu'au moment de notre achat il n'y ait pas d'erreur de commande.</p><button id="close-price-modal-btn" class="mt-6 w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg">Compris</button></div></div> [cite: 114]
    [cite_start]<div id="link-alert-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center m-4"><h3 class="text-lg font-bold text-gray-800">Comment copier le lien ?</h3><p class="text-gray-600 mt-2 text-sm">Copiez-collez le lien du produit que vous souhaitez acheter sur les sites chinois suivants afin que nous puissions l'identifier et l'acheter pour vous : Alibaba, Taobao, 1688, JingDong, XianYu, etc.</p><button id="close-link-modal-btn" class="mt-6 w-full bg-yellow-500 text-white font-bold py-2 px-4 rounded-lg">Compris</button></div></div> [cite: 115]
    <div id="confirmation-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop"><div class="bg-white rounded-3xl shadow-2xl w-full max-w-md p-8 text-center m-4"><div class="mx-auto bg-green-100 rounded-full h-24 w-24 flex items-center justify-center"><svg class="h-16 w-16 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><h2 class="mt-6 text-3xl font-extrabold text-gray-800">C'est presque fini !</h2><p class="mt-4 text-gray-600">Votre devis a été préparé. [cite_start]Cliquez ci-dessous pour nous l'envoyer sur WhatsApp.</p><a id="whatsapp-link" href="#" target="_blank" class="mt-8 inline-flex items-center justify-center w-full py-4 px-8 text-base font-bold rounded-xl text-white btn-primary">Confirmer et Envoyer sur WhatsApp</a></div></div> [cite: 116]
    <div id="delete-confirm-modal" class="fixed inset-0 z-50 items-center justify-center hidden modal-backdrop">
        <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 text-center m-4">
            <h3 class="text-lg font-bold text-gray-800">Confirmer la suppression</h3>
            [cite_start]<p class="text-gray-600 mt-2 text-sm">Êtes-vous sûr de vouloir supprimer ce produit ? [cite: 117]
[cite_start]Cette action est irréversible.</p> [cite: 117]
            <div class="mt-6 flex justify-center gap-4">
                <button id="cancel-delete-btn" class="w-full bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg">Annuler</button>
                <button id="confirm-delete-btn" class="w-full bg-red-600 text-white font-bold py-2 px-4 rounded-lg">Supprimer</button>
            </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    [cite_start]<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script> [cite: 118]
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // ================== CONFIGURATION FIREBASE & IMGBB ==================
    const firebaseConfig = {
      apiKey: "AIzaSyBa93ZQ34S4JEz6lc7yt_2ZrIiTc2Jqh9c",
      authDomain: "boutique-aridago.firebaseapp.com",
      projectId: "boutique-aridago",
      storageBucket: "boutique-aridago.appspot.com",
      messagingSenderId: "173722302642",
      appId: "1:173722302642:web:1cad436874f3b4270eb1ab"
    };
    [cite_start]const IMGBB_API_KEY = '7dfb12ff69d1e1f349a28e4a788f2c1d'; [cite: 119]

    // Initialisation de Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    [cite_start]const productsCollection = db.collection('products'); [cite: 120]

    let boutiqueProducts = [];
    
    // ================== GESTION DE LA NAVIGATION (Single Page App) ==================
    [cite_start]const pages = document.querySelectorAll('.page-content'); [cite: 121]
    [cite_start]const navLinks = document.querySelectorAll('.nav-link'); [cite: 121]

    function showPage(pageId) {
        pages.forEach(page => {
            const isTargetPage = page.id === pageId;
            page.classList.toggle('hidden', !isTargetPage);
        });
        [cite_start]document.querySelectorAll('header .nav-link, footer .nav-link').forEach(link => { [cite: 122]
             [cite_start]const isTargetLink = `page-${link.dataset.page}` === pageId; [cite: 122]
            [cite_start]link.classList.toggle('nav-link-active', isTargetLink); [cite: 122]
             [cite_start]if (link.closest('header')) { [cite: 122]
                [cite_start]link.classList.toggle('text-red-600', isTargetLink); [cite: 122]
             [cite_start]} [cite: 122]
        [cite_start]}); [cite: 122]
        [cite_start]window.scrollTo(0, 0); [cite: 123]

        [cite_start]if (pageId === 'page-boutique') { [cite: 123]
            [cite_start]renderBoutique(); [cite: 124]
        }
    }

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const pageId = `page-${this.dataset.page}`;
            showPage(pageId);
        });
    });
    [cite_start]document.getElementById('admin-link-header').addEventListener('click', () => showPage('page-admin')); [cite: 125]
    
    // Initialisation
    document.getElementById('year').textContent = new Date().getFullYear();
    document.querySelector('.current-year').textContent = new Date().getFullYear();
    // ================== LOGIQUE BOUTIQUE (Dynamique avec Firebase) ==================
    [cite_start]async function loadAndRenderProducts() { [cite: 126]
        try {
            [cite_start]const snapshot = await productsCollection.orderBy("name").get(); [cite: 126]
            [cite_start]if (snapshot.empty) { [cite: 127]
                [cite_start]console.log("Firebase est vide. Utilisation des produits d'exemple."); [cite: 127]
                [cite_start]boutiqueProducts = [ [cite: 128]
                    [cite_start]{ id: 'mock1', name: 'Sac à dos de voyage Pro', description: 'Imperméable, grande capacité avec de multiples compartiments.\nIdéal pour les voyages et le quotidien.', price: 125000, images: ['https://i.imgur.com/v14n2v4.jpeg', 'https://i.imgur.com/1z4kY9M.jpeg'] }, [cite: 129]
                    [cite_start]{ id: 'mock2', name: 'Thermos intelligent LED', description: 'Affiche la température, conserve la chaleur pendant 12h.\nAcier inoxydable de haute qualité.', price: 65000, images: ['https://i.imgur.com/5J7Rz72.jpeg'] }, [cite: 130]
                    [cite_start]{ id: 'mock3', name: 'Montre connectée Sport', description: 'Suivi cardiaque, GPS intégré, étanche IP68 et multiples modes sportifs.', price: 210000, images: ['https://i.imgur.com/eBq62vJ.jpeg', 'https://i.imgur.com/b5k9g7g.jpeg'] }, [cite: 130]
                    [cite_start]{ id: 'mock4', name: 'Mini-projecteur portable HD', description: 'Transformez n\'importe quel mur en cinéma.\nCompact, léger et compatible avec tous vos appareils.', price: 350000, images: ['https://i.imgur.com/e692w9d.jpeg'] } [cite: 131]
                ];
            } else {
                [cite_start]boutiqueProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })); [cite: 132]
            }
            
            [cite_start]renderBoutique(); [cite: 133]
            [cite_start]renderPopularProducts(boutiqueProducts.slice(0, 4)); [cite: 134]

            [cite_start]if (auth.currentUser) { [cite: 134]
                [cite_start]renderAdminList(); [cite: 135]
            }
        } catch (error) {
            [cite_start]console.error("Erreur de chargement: ", error); [cite: 135]
            [cite_start]if(document.getElementById('loading-products')) { [cite: 136]
                [cite_start]document.getElementById('loading-products').textContent = 'Erreur de chargement des produits.'; [cite: 136]
            [cite_start]} [cite: 137]
        }
    }

    function createProductCard(product) {
        [cite_start]const imageUrl = product.images && product.images.length > 0 ? [cite: 138]
 [cite_start]product.images[0] : 'https://placehold.co/600x400/cccccc/ffffff?text=Image'; [cite: 138]
        return `
            <div class="bg-white rounded-xl shadow-lg overflow-hidden group transform hover:-translate-y-1 transition-transform duration-300 view-product-btn cursor-pointer" data-id="${product.id}">
                <div class="relative">
                    <img src="${imageUrl}" alt="${product.name}" class="w-full h-40 sm:h-48 md:h-56 object-contain p-2 sm:p-4">
                    [cite_start]<div class="absolute top-2 left-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full flex items-center"> [cite: 139]
                        <i class="fas fa-check-circle mr-1"></i> En stock
                    </div>
                    <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        [cite_start]<span class="text-white btn-primary py-2 px-5 rounded-full transform hover:scale-105 transition-transform text-sm">Voir</span> [cite: 140]
                    </div>
                </div>
                <div class="p-2 sm:p-4 text-center">
                    <h3 class="font-semibold text-sm sm:text-base mb-1 sm:mb-2 truncate">${product.name}</h3>
                    [cite_start]<p class="text-gradient font-extrabold text-base sm:text-xl">${product.price.toLocaleString('fr-FR')} Ar</p> [cite: 141]
                </div>
            [cite_start]</div>`; [cite: 142]
    }

    function addProductCardListeners() {
        document.querySelectorAll('.view-product-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                const productId = e.currentTarget.dataset.id;
                renderProductDetail(productId);
                showPage('page-detail');
            });
        [cite_start]}); [cite: 143]
    }

    function normalizeString(str) {
        [cite_start]if (!str) return ''; [cite: 143]
        [cite_start]return str [cite: 144]
            [cite_start].toLowerCase() [cite: 144]
            [cite_start].normalize("NFD") [cite: 144]
            [cite_start].replace(/[\u0300-\u036f]/g, ""); [cite: 144]
    [cite_start]} [cite: 145]

    function renderBoutique() {
        [cite_start]const productGrid = document.getElementById('product-grid'); [cite: 145]
        [cite_start]const loadingText = document.getElementById('loading-products'); [cite: 146]
        [cite_start]const searchBar = document.getElementById('search-bar'); [cite: 146]
        
        [cite_start]const normalizedSearchTerm = normalizeString(searchBar ? searchBar.value : ''); [cite: 146]
        [cite_start]const searchKeywords = normalizedSearchTerm.split(' ').filter(k => k); [cite: 147]

        const filteredProducts = boutiqueProducts.filter(p => {
            const productName = p.name || '';
            const normalizedProductName = normalizeString(productName);
            return searchKeywords.every(keyword => normalizedProductName.includes(keyword));
        });
        [cite_start]if (loadingText) loadingText.style.display = 'none'; [cite: 148]

        [cite_start]if (boutiqueProducts.length === 0) { [cite: 148]
            [cite_start]productGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">Aucun produit n'a été publié pour le moment.</p>`; [cite: 148]
        [cite_start]} else if (filteredProducts.length === 0) { [cite: 149]
            [cite_start]productGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">Aucun produit ne correspond à votre recherche pour "${searchBar.value}".</p>`; [cite: 149]
        } else {
            [cite_start]productGrid.innerHTML = filteredProducts.map(createProductCard).join(''); [cite: 150]
        }
        
        [cite_start]addProductCardListeners(); [cite: 151]
    [cite_start]} [cite: 152]
    
    function renderPopularProducts(products) {
        [cite_start]const container = document.getElementById('popular-products-accueil'); [cite: 152]
        [cite_start]if (!container) return; [cite: 153]

        [cite_start]if (products.length === 0) { [cite: 153]
            [cite_start]container.innerHTML = ''; [cite: 153]
            [cite_start]return; [cite: 154]
        }

        container.innerHTML = `
             <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold mb-2">Produits Populaires</h2>
                    <p class="text-slate-600 text-lg">Les articles les plus demandés par nos clients</p>
                [cite_start]</div> [cite: 155]
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 md:gap-8">
                    ${products.map(createProductCard).join('')}
                </div>
            </div>`;
        [cite_start]addProductCardListeners(); [cite: 156]
    }

    function renderProductDetail(productId) {
        [cite_start]const product = boutiqueProducts.find(p => p.id === productId); [cite: 156]
        [cite_start]if (!product) return; [cite: 157]
        
        [cite_start]let thumbnailsHTML = (product.images || []).map((img, index) => `<img src="${img}" class="w-16 h-16 md:w-20 md:h-20 object-contain bg-slate-100 rounded-md cursor-pointer border-2 ${index === 0 ? 'border-red-500' : 'border-transparent'} thumbnail" data-index="${index}">`).join(''); [cite: 157]
        [cite_start]const productDetailSection = document.getElementById('page-detail'); [cite: 158]
        productDetailSection.innerHTML = `
        <div class="container mx-auto px-4">
            <button class="nav-link font-semibold mb-8 inline-flex items-center" data-page="boutique"><i class="fas fa-arrow-left mr-2"></i>Retour à la boutique</button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
                <div>
                    <div class="bg-slate-100 rounded-xl shadow-lg mb-4">
                        [cite_start]<img id="main-product-image" src="${product.images[0]}" alt="${product.name}" class="w-full h-80 md:h-96 object-contain rounded-xl p-4"> [cite: 159]
                    </div>
                    <div id="thumbnail-container" class="flex flex-wrap gap-4 justify-center">${thumbnailsHTML}</div>
                </div>
                [cite_start]<div> [cite: 160]
                    [cite_start]<h1 class="text-3xl md:text-4xl font-bold text-slate-800">${product.name}</h1> [cite: 160]
                    [cite_start]<p class="text-3xl md:text-4xl font-extrabold text-gradient my-4">${product.price.toLocaleString('fr-FR')} Ar</p> [cite: 160]
                    <div class="mt-4 flex items-center text-green-600 font-semibold">
                        [cite_start]<i class="fas fa-check-circle mr-2"></i>Produit disponible à Madagascar [cite: 161]
                    </div>
                    [cite_start]<p class="mt-4 text-slate-600 whitespace-pre-wrap">${product.description}</p> [cite: 161]
                    <div class="mt-8">
                        [cite_start]<a href="#" data-id="${product.id}" class="order-now-btn w-full inline-flex items-center justify-center text-center btn-secondary transition text-white font-bold py-4 px-4 rounded-xl text-lg"><i class="fab fa-whatsapp mr-3 text-2xl"></i>Commander maintenant</a> [cite: 162]
                    </div>
                </div>
            </div>
        </div>`;
        [cite_start]productDetailSection.querySelector('.nav-link').addEventListener('click', (e) => { [cite: 163]
            [cite_start]e.preventDefault(); [cite: 163]
            [cite_start]showPage('page-boutique'); [cite: 163]
        [cite_start]}); [cite: 163]
        [cite_start]productDetailSection.querySelector('.order-now-btn').addEventListener('click', e => { [cite: 164]
            [cite_start]e.preventDefault(); [cite: 164]
            [cite_start]const id = e.currentTarget.dataset.id; [cite: 164]
            [cite_start]const p = boutiqueProducts.find(p => p.id === id); [cite: 164]
            [cite_start]let orderText = `*COMMANDE DIRECTE ARIDAGO*\n\n- Produit: ${p.name}\n- Prix: ${p.price.toLocaleString('fr-FR')} Ar\n\n(Frais de Livraison non inclus)`; [cite: 164]
            [cite_start]window.open(`https://wa.me/8615600021123?text=${encodeURIComponent(orderText)}`, '_blank'); [cite: 164]
        [cite_start]}); [cite: 164]
        [cite_start]const mainImage = document.getElementById('main-product-image'); [cite: 165]
        [cite_start]const thumbnails = document.querySelectorAll('.thumbnail'); [cite: 165]
        thumbnails.forEach(thumb => {
            thumb.addEventListener('click', e => {
                const index = parseInt(e.currentTarget.dataset.index);
                mainImage.src = product.images[index];
                thumbnails.forEach(t => t.classList.remove('border-red-500'));
                e.currentTarget.classList.add('border-red-500');
            [cite_start]}); [cite: 166]
        [cite_start]}); [cite: 165]
    [cite_start]} [cite: 167]

    function initSearchFunctionality() {
        [cite_start]const searchBar = document.getElementById('search-bar'); [cite: 167]
        [cite_start]const searchBtn = document.getElementById('search-btn'); [cite: 168]
        
        [cite_start]if (searchBar && searchBtn) { [cite: 168]
            const performSearch = () => {
                 if (document.getElementById('page-boutique').offsetParent !== null) {
                    [cite_start]renderBoutique(); [cite: 168]
                [cite_start]} [cite: 169]
            };
            searchBar.addEventListener('input', performSearch);
            searchBtn.addEventListener('click', performSearch);
            [cite_start]searchBar.addEventListener('keypress', (e) => { [cite: 170]
                [cite_start]if (e.key === 'Enter') { [cite: 170]
                    [cite_start]e.preventDefault(); [cite: 170]
                    [cite_start]performSearch(); [cite: 170]
                [cite_start]} [cite: 170]
            [cite_start]}); [cite: 170]
        [cite_start]} [cite: 171]
    }
    
    // ================== LOGIQUE DEVIS SUR MESURE ==================
    [cite_start]const devisForm = document.getElementById('devis-form'); [cite: 171]
    [cite_start]const productList = document.getElementById('product-list'); [cite: 172]
    [cite_start]const addProductBtn = document.getElementById('add-product'); [cite: 172]
    [cite_start]const confirmationModal = document.getElementById('confirmation-modal'); [cite: 172]
    [cite_start]const whatsappLink = document.getElementById('whatsapp-link'); [cite: 172]
    [cite_start]const priceAlertModal = document.getElementById('price-alert-modal'); [cite: 172]
    [cite_start]const closePriceModalBtn = document.getElementById('close-price-modal-btn'); [cite: 173]
    [cite_start]const linkAlertModal = document.getElementById('link-alert-modal'); [cite: 173]
    [cite_start]const closeLinkModalBtn = document.getElementById('close-link-modal-btn'); [cite: 173]
    
    let productCount = 0;
    [cite_start]let hasShownPriceAlert = localStorage.getItem('hasShownPriceAlert_Aridago'); [cite: 173]
    [cite_start]let hasShownLinkAlert = localStorage.getItem('hasShownLinkAlert_Aridago'); [cite: 174]

    function createProductBlock() {
        productCount++;
        const productDiv = document.createElement('div');
        [cite_start]productDiv.className = 'p-5 border-2 border-gray-200 rounded-xl bg-gray-50/50 relative'; [cite: 175]
        [cite_start]productDiv.innerHTML = `<h4 class="font-bold text-md text-gray-800 mb-4">Produit ${productCount}</h4> ${productCount > 1 ? [cite: 175]
[cite_start]'<button type="button" class="absolute top-4 right-4 text-red-500 hover:text-red-700 text-2xl font-bold remove-product">&times;</button>' : ''}<div class="space-y-4"><div><label class="text-sm font-semibold text-gray-600">Nom du produit</label><input type="text" name="product_name_${productCount}" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div><div><label class="text-sm font-semibold text-gray-600">Lien du produit</label><input type="url" name="product_link_${productCount}" required class="link-input w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div><div><label class="text-sm font-semibold text-gray-600">Spécification du Produit (ex: Couleur, Taille)</label><textarea name="product_spec_${productCount}" rows="2" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></textarea></div><div class="grid grid-cols-2 gap-4"><div><label class="text-sm font-semibold text-gray-600">Prix Unitaire (CNY)</label><input type="number" step="0.01" name="product_price_${productCount}" required class="price-input w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div><div><label class="text-sm font-semibold text-gray-600">Quantité</label><input type="number" name="product_quantity_${productCount}" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div></div></div>`; [cite: 176]
        [cite_start]productList.appendChild(productDiv); [cite: 177]
        
        [cite_start]productDiv.querySelector('.link-input').addEventListener('focus', () => { [cite: 177]
            [cite_start]if (!hasShownLinkAlert) linkAlertModal.style.display = 'flex'; [cite: 177]
        [cite_start]}); [cite: 177]
        [cite_start]productDiv.querySelector('.price-input').addEventListener('focus', () => { [cite: 178]
            [cite_start]if (!hasShownPriceAlert) priceAlertModal.style.display = 'flex'; [cite: 178]
        [cite_start]}); [cite: 178]
        [cite_start]const removeBtn = productDiv.querySelector('.remove-product'); [cite: 179]
        [cite_start]if (removeBtn) removeBtn.addEventListener('click', () => productDiv.remove()); [cite: 179]
    }

    [cite_start]if(addProductBtn) addProductBtn.addEventListener('click', createProductBlock); [cite: 179]
    [cite_start]if(closePriceModalBtn) closePriceModalBtn.addEventListener('click', () => { [cite: 180]
        [cite_start]priceAlertModal.style.display = 'none'; [cite: 180]
        [cite_start]localStorage.setItem('hasShownPriceAlert_Aridago', 'true'); [cite: 180]
        [cite_start]hasShownPriceAlert = true; [cite: 180]
    [cite_start]}); [cite: 180]
    [cite_start]if(closeLinkModalBtn) closeLinkModalBtn.addEventListener('click', () => { [cite: 181]
        [cite_start]linkAlertModal.style.display = 'none'; [cite: 181]
        [cite_start]localStorage.setItem('hasShownLinkAlert_Aridago', 'true'); [cite: 181]
        [cite_start]hasShownLinkAlert = true; [cite: 181]
    [cite_start]}); [cite: 181]
    [cite_start]if(devisForm) devisForm.addEventListener('submit', function(e) { [cite: 182]
        [cite_start]e.preventDefault(); [cite: 182]
        [cite_start]const formData = new FormData(devisForm); [cite: 182]
        [cite_start]const data = Object.fromEntries(formData.entries()); [cite: 182]
        [cite_start]let devisText = ""; [cite: 182]
        [cite_start]let totalCny = 0; [cite: 182]
        [cite_start]const devisId = `ADG-${Date.now().toString().slice(-6)}`; [cite: 182]
        
        [cite_start]devisText += `*Nouvelle Demande de Devis - ARIDAGO*\n\n*Référence:* ${devisId}\n*Client:* ${data.nom} ${data.prenom}\n*WhatsApp:* ${data.whatsapp}\n`; [cite: 182]
        
        [cite_start]if (data.email) devisText += `*Email:* ${data.email}\n`; [cite: 183]
        [cite_start]devisText += `-----------------------------------\n\n`; [cite: 183]
        
        [cite_start]const products = []; [cite: 183]
        [cite_start]const productElements = productList.querySelectorAll('.p-5'); [cite: 183]
        productElements.forEach((p_el) => {
            const nameInput = p_el.querySelector('input[name^="product_name_"]');
            if (nameInput && nameInput.value) {
                [cite_start]const id = nameInput.name.split('_').pop(); [cite: 184]
                [cite_start]products.push({ [cite: 184]
                    [cite_start]name: formData.get(`product_name_${id}`), [cite: 184]
                    [cite_start]link: formData.get(`product_link_${id}`), [cite: 184]
                    [cite_start]spec: formData.get(`product_spec_${id}`), [cite: 184]
                    [cite_start]price: parseFloat(formData.get(`product_price_${id}`)), [cite: 185]
                    [cite_start]quantity: parseInt(formData.get(`product_quantity_${id}`), 10) [cite: 185]
                });
            [cite_start]} [cite: 186]
        });
        
        products.forEach((p, index) => {
            const subTotal = p.price * p.quantity;
            totalCny += subTotal;
            devisText += `*Produit ${index + 1}:* ${p.name}\n*Spécification:* ${p.spec}\n*Prix Unitaire:* ${p.price.toFixed(2)} CNY\n*Quantité:* ${p.quantity}\n*Lien:* ${p.link}\n*Sous-total:* ${subTotal.toFixed(2)} CNY\n\n`;
        });
        [cite_start]const fraisService = totalCny * 0.10; [cite: 187]
        [cite_start]const totalFinalCny = totalCny + fraisService; [cite: 187]
        [cite_start]const totalAriary = totalFinalCny * 700; [cite: 187]
        [cite_start]devisText += `-----------------------------------\n*Total Produits:* ${totalCny.toFixed(2)} CNY\n*Frais de service (10%):* ${fraisService.toFixed(2)} CNY\n*Total en Yuan:* ${totalFinalCny.toFixed(2)} CNY\n\n*Total en Ariary:* ${totalAriary.toLocaleString('fr-FR')} Ar\n\n*NOTE IMPORTANTE:*\nLes frais de transport Chine à Madagascar ne sont pas inclus dans ce devis.`; [cite: 188]
        [cite_start]whatsappLink.href = `https://wa.me/8615600021123?text=${encodeURIComponent(devisText)}`; [cite: 189]
        [cite_start]confirmationModal.style.display = 'flex'; [cite: 189]
    });
    
    [cite_start]if(confirmationModal) confirmationModal.addEventListener('click', e => { [cite: 189]
        if (e.target === confirmationModal) {
            confirmationModal.style.display = 'none';
            devisForm.reset();
            productList.innerHTML = '';
            createProductBlock();
        }
    });
    [cite_start]if(productList) createProductBlock(); [cite: 190]
    
    document.querySelectorAll('.faq-question').forEach(button => {
        button.addEventListener('click', () => {
            const answer = button.nextElementSibling;
            const icon = button.querySelector('svg, i');
            answer.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        });
    });
    
    // ================== DÉBUT: LOGIQUE DE L'OUTIL DE QUOTATION INTÉGRÉ ==================
    const logoTopLeftUrl = "https://i.ibb.co/HDBqLXCT/Aridago-Logo-removebg-preview.png";
    const logoBottomRightUrl = "https://i.ibb.co/mFyw1zmW/Sary-sonia.png";

    let quotationState = {
        documentTitle: 'QUOTATION',
        quotationNumber: '0000000001',
        quotationDate: new Date().toISOString().split('T')[0],
        quotationCity: 'Antananarivo',
        clientName: 'Nom du client',
        clientPhone: '+261 34 00 0000 00',
        clientEmail: 'nomprenom@exemple.com',
        clientAddress: 'Antananarivo, centre-ville 123',
        items: [
            { id: 2, description: 'Produit 2', quantity: 2, price: 30000, isText: false, directPrice: 0, align: 'left' },
            { id: 1, description: 'Produit 1', quantity: 1, price: 100000, isText: false, directPrice: 0, align: 'left' },
            { id: 3, description: 'Dédouanement + Fret', quantity: 0, price: 0, isText: true, directPrice: 50000, align: 'left' }
        ],
        notes: 'Les frais de transport Chine à Madagascar ne sont pas inclus dans cette Quotation.',
        paymentMethod: 'Espèces',
        exchangeRate: 700,
        senderInfo: 'Mr. Wang Yu (+86 15600021123)',
    };

    let isRmbToAriary = true;
    let isQuotationToolInitialized = false;

    function getFormattedDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString + 'T00:00:00');
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        let formatted = new Intl.DateTimeFormat('fr-FR', options).format(date);
        return formatted.charAt(0).toUpperCase() + formatted.slice(1);
    }
    
    function renderQuotationPreview() {
        const previewContainer = document.getElementById('quotation-preview-content');
        if (!previewContainer) return;
        
        let tableRows = '';
        let total = 0;
        quotationState.items.forEach(item => {
            const isSpecialItem = item.description.trim().toLowerCase() === 'dédouanement + fret';
            if (item.isText || isSpecialItem) {
                const directPrice = item.directPrice || 0;
                total += directPrice;
                tableRows += `
                    <tr>
                        <td colspan="3" class="font-bold" style="text-align: ${item.align || 'left'};">${item.description}</td>
                        <td class="text-right font-bold">${directPrice.toLocaleString('fr-FR')}</td>
                    </tr>
                `;
            } else {
                const itemTotal = item.quantity * item.price;
                total += itemTotal;
                tableRows += `
                    <tr>
                        <td style="text-align: ${item.align || 'left'};">${item.description}</td>
                        <td class="text-center">${item.quantity.toLocaleString('fr-FR')}</td>
                        <td class="text-right">${item.price.toLocaleString('fr-FR')}</td>
                        <td class="text-right">${itemTotal.toLocaleString('fr-FR')}</td>
                    </tr>
                `;
            }
        });

        const totalRmb = quotationState.exchangeRate > 0 ? total / quotationState.exchangeRate : 0;

        tableRows += `
            <tr style="background-color: #f3f4f6;">
                <td colspan="3" class="text-right font-bold" style="font-size: 1.1rem;">TOTAUX</td>
                <td class="text-right font-bold" style="font-size: 1.1rem;">
                    ${total.toLocaleString('fr-FR')} Ar
                    <br>
                    <span style="font-size: 0.9rem; font-weight: 500;">(${totalRmb.toFixed(2)} RMB)</span>
                </td>
            </tr>
        `;
        
        let paymentTermsText = `(1) Mode de paiement: ${quotationState.paymentMethod}\n(2) Prix de Change: 1 RMB = ${quotationState.exchangeRate} Ariary`;
        
        let signatureHtml = '';
        if (quotationState.documentTitle === 'DEVIS') {
            signatureHtml = `<img src="${logoBottomRightUrl}" alt="Signature" style="width: 160px; height: auto; margin-left: auto; margin-top: 0.5rem;">`;
        }

        previewContainer.innerHTML = `
            <div style="background-color: #fefce8; padding: 1.5rem 2rem; border-bottom: 3px solid #f59e0b;">
                 <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <img src="${logoTopLeftUrl}" alt="Aridago Logo" style="width: 180px; height: auto;">
                    </div>
                    <div class="text-right">
                        <h3 style="font-size: 2.5rem; font-weight: 700; color: #000000; line-height: 1;">${quotationState.documentTitle}</h3>
                        <p style="margin-top: 0.5rem;"><strong>Numéro :</strong> ${quotationState.quotationNumber}</p>
                    </div>
                </div>
            </div>
            <div style="padding: 2rem;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: end; margin-bottom: 2rem;">
                     <div>
                        <p style="background-color: #e5e7eb; padding: 0.25rem 0.5rem; display: inline-block; font-weight: bold; margin-bottom: 0.5rem; border-radius: 4px;">CONSIGNÉE À :</p>
                        <p><span class="font-bold">Nom :</span> ${quotationState.clientName}</p>
                        <p><span class="font-bold">Tél :</span> ${quotationState.clientPhone}</p>
                        <p><span class="font-bold">Email :</span> ${quotationState.clientEmail}</p>
                        <p><span class="font-bold">Adresse :</span> ${quotationState.clientAddress}</p>
                    </div>
                    <p class="text-right"><strong>${quotationState.quotationCity}</strong>, ${getFormattedDate(quotationState.quotationDate)}</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>DESCRIPTION</th>
                            <th>QUANTITÉ</th>
                            <th>PRIX UNITAIRE (Ar)</th>
                            <th>TOTAL (Ar)</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 2rem; align-items: start;">
                    <div style="font-size: 0.8rem;">
                        <div style="margin-bottom: 1rem;">
                            <p class="font-bold">Note importante:</p>
                            <p style="white-space: pre-wrap;">${quotationState.notes}</p>
                        </div>
                         <div>
                            <p class="font-bold">Terme de paiement:</p>
                            <p style="white-space: pre-wrap;">${paymentTermsText}</p>
                        </div>
                    </div>
                    <div style="text-align: right;">
                         <p class="font-bold">Expéditeur</p>
                         ${signatureHtml}
                         <p style="margin-top: 1rem;">${quotationState.senderInfo}</p>
                    </div>
                </div>
            </div>
        `;
    }

    function renderItemsForm() {
        const container = document.getElementById('items-container');
        if (!container) return;
        container.innerHTML = '';
        quotationState.items.forEach((item, index) => {
            const row = document.createElement('div');
            row.className = 'grid grid-cols-12 gap-2 items-center';
            const isSpecialItem = item.description.trim().toLowerCase() === 'dédouanement + fret';
            const standardInputs = `
                <div class="col-span-3 md:col-span-2">
                    <input type="number" placeholder="Qté" data-id="${item.id}" data-field="quantity" value="${item.quantity}" class="w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div class="col-span-4 md:col-span-2">
                    <input type="number" placeholder="P.U. (Ar)" data-id="${item.id}" data-field="price" value="${item.price}" class="w-full p-2 border border-gray-300 rounded-md">
                </div>
            `;
            const textOnlyInput = `
                <div class="col-span-7 md:col-span-4">
                     <input type="number" placeholder="Prix Total (Ar)" data-id="${item.id}" data-field="directPrice" value="${item.directPrice || 0}" class="w-full p-2 border border-gray-300 rounded-md">
                </div>
            `;
            row.innerHTML = `
                <div class="col-span-12 md:col-span-3">
                    <input type="text" placeholder="Description" data-id="${item.id}" data-field="description" value="${item.description}" class="w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div class="col-span-12 md:col-span-1 flex items-center justify-start space-x-1">
                    <button title="Aligner à gauche" data-id="${item.id}" data-align="left" class="align-btn p-1 rounded ${item.align === 'left' ? 'bg-blue-500 text-white' : 'bg-gray-200'}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h10M4 18h16" /></svg></button>
                    <button title="Centrer" data-id="${item.id}" data-align="center" class="align-btn p-1 rounded ${item.align === 'center' ? 'bg-blue-500 text-white' : 'bg-gray-200'}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M7 12h10M4 18h16" /></svg></button>
                    <button title="Aligner à droite" data-id="${item.id}" data-align="right" class="align-btn p-1 rounded ${item.align === 'right' ? 'bg-blue-500 text-white' : 'bg-gray-200'}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M10 12h10M4 18h16" /></svg></button>
                </div>
                ${item.isText || isSpecialItem ? textOnlyInput : standardInputs}
                <div class="col-span-3 md:col-span-2 flex items-center justify-center">
                    <input type="checkbox" data-id="${item.id}" data-field="isText" class="h-5 w-5 text-red-600 focus:ring-red-500 border-gray-300 rounded" ${item.isText || isSpecialItem ? 'checked' : ''} ${isSpecialItem ? 'disabled' : ''}>
                    <label class="ml-2 text-sm text-gray-600">Texte seul</label>
                </div>
                <div class="col-span-1 flex flex-col items-center justify-center">
                    <button title="Monter" data-id="${item.id}" class="move-up-btn p-1 rounded ${index === 0 ? 'opacity-25 cursor-not-allowed' : 'hover:bg-gray-200'}" ${index === 0 ? 'disabled' : ''}>
                       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
                    </button>
                    <button title="Descendre" data-id="${item.id}" class="move-down-btn p-1 rounded ${index === quotationState.items.length - 1 ? 'opacity-25 cursor-not-allowed' : 'hover:bg-gray-200'}" ${index === quotationState.items.length - 1 ? 'disabled' : ''}>
                       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                </div>
                <div class="col-span-1 text-right">
                    <button data-id="${item.id}" class="removeItemBtn bg-red-100 text-red-600 p-2 rounded-full hover:bg-red-200 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>
            `;
            container.appendChild(row);
        });
        updateTotalAndPreview();
    }

    function updateTotalAndPreview() {
        const total = quotationState.items.reduce((acc, item) => {
            const isSpecialItem = item.description.trim().toLowerCase() === 'dédouanement + fret';
            if (item.isText || isSpecialItem) {
                return acc + (item.directPrice || 0);
            } else {
                return acc + (item.quantity * item.price);
            }
        }, 0);

        const totalRmb = quotationState.exchangeRate > 0 ? total / quotationState.exchangeRate : 0;
        
        const totalDisplayEl = document.getElementById('totalDisplay');
        if (totalDisplayEl) {
            totalDisplayEl.innerHTML = `
                ${total.toLocaleString('fr-FR')} Ar
                <br>
                <span class="text-xl font-semibold text-gray-500">(${totalRmb.toFixed(2)} RMB)</span>`;
        }
            
        renderQuotationPreview();
    }

    function syncStateWithForm() {
        quotationState.documentTitle = document.getElementById('documentTitleSelect').value;
        quotationState.quotationNumber = document.getElementById('quotationNumber').value;
        quotationState.quotationDate = document.getElementById('quotationDate').value;
        quotationState.quotationCity = document.getElementById('quotationCity').value;
        quotationState.clientName = document.getElementById('clientName').value;
        quotationState.clientPhone = document.getElementById('clientPhone').value;
        quotationState.clientEmail = document.getElementById('clientEmail').value;
        quotationState.clientAddress = document.getElementById('clientAddress').value;
        quotationState.notes = document.getElementById('notes').value;
        quotationState.paymentMethod = document.getElementById('paymentMethodSelect').value;
        quotationState.exchangeRate = parseFloat(document.getElementById('exchangeRateInput').value) || 0;
        quotationState.senderInfo = document.getElementById('senderInfo').value;
        updateTotalAndPreview();
    }

    function updateConverterUI() {
        const inputLabel = document.getElementById('converterInputLabel');
        const outputLabel = document.getElementById('converterOutputLabel');
        const converterInput = document.getElementById('converterInput');

        if (!inputLabel || !outputLabel || !converterInput) return;

        if (isRmbToAriary) {
            inputLabel.textContent = 'Montant en RMB (¥)';
            outputLabel.textContent = 'Équivalent en Ariary';
            converterInput.placeholder = 'Entrez la valeur en RMB';
        } else {
            inputLabel.textContent = 'Montant en Ariary (Ar)';
            outputLabel.textContent = 'Équivalent en RMB';
            converterInput.placeholder = 'Entrez la valeur en Ariary';
        }
        updateConverter();
    }

    function updateConverter() {
        const amountEl = document.getElementById('converterInput');
        if (!amountEl) return;
        const amount = parseFloat(amountEl.value) || 0;
        const resultEl = document.getElementById('converterOutputResult');
        const exchangeRate = quotationState.exchangeRate;

        if (isRmbToAriary) {
            const calculatedAriary = amount * exchangeRate;
            resultEl.textContent = `${calculatedAriary.toLocaleString('fr-FR')} Ar`;
        } else {
            const calculatedRmb = exchangeRate > 0 ? amount / exchangeRate : 0;
            resultEl.textContent = `${calculatedRmb.toFixed(2).replace('.', ',')} RMB`;
        }
    }

    function initQuotationTool() {
        document.getElementById('documentTitleSelect').value = quotationState.documentTitle;
        document.getElementById('quotationNumber').value = quotationState.quotationNumber;
        document.getElementById('quotationDate').value = quotationState.quotationDate;
        document.getElementById('quotationCity').value = quotationState.quotationCity;
        document.getElementById('clientName').value = quotationState.clientName;
        document.getElementById('clientPhone').value = quotationState.clientPhone;
        document.getElementById('clientEmail').value = quotationState.clientEmail;
        document.getElementById('clientAddress').value = quotationState.clientAddress;
        document.getElementById('notes').value = quotationState.notes;
        document.getElementById('paymentMethodSelect').value = quotationState.paymentMethod;
        document.getElementById('exchangeRateInput').value = quotationState.exchangeRate;
        document.getElementById('senderInfo').value = quotationState.senderInfo;

        renderItemsForm();
        
        document.getElementById('quotation-tool-form').addEventListener('input', syncStateWithForm);

        document.getElementById('addItemBtn').addEventListener('click', () => {
            quotationState.items.push({ id: Date.now(), description: '', quantity: 1, price: 0, isText: false, directPrice: 0, align: 'left' });
            renderItemsForm();
        });

        document.getElementById('items-container').addEventListener('input', (e) => {
            if (e.target.dataset.id) {
                const id = parseInt(e.target.dataset.id);
                const field = e.target.dataset.field;
                const item = quotationState.items.find(i => i.id === id);
                if (item) {
                    if (e.target.type === 'checkbox') {
                        item[field] = e.target.checked;
                    } else if (e.target.type === 'number') {
                        item[field] = parseFloat(e.target.value) || 0;
                    } else {
                        item[field] = e.target.value;
                    }
                    if(item.description.trim().toLowerCase() === 'dédouanement + fret'){
                        item.isText = true;
                    }
                }
                 renderItemsForm();
            }
        });

        document.getElementById('items-container').addEventListener('click', (e) => {
            const removeItemBtn = e.target.closest('.removeItemBtn');
            if (removeItemBtn) {
                const id = parseInt(removeItemBtn.dataset.id);
                quotationState.items = quotationState.items.filter(i => i.id !== id);
                renderItemsForm();
            }

            const alignBtn = e.target.closest('.align-btn');
            if(alignBtn){
                const id = parseInt(alignBtn.dataset.id);
                const align = alignBtn.dataset.align;
                const item = quotationState.items.find(i => i.id === id);
                if(item){
                    item.align = align;
                    renderItemsForm();
                }
            }

            const moveUpBtn = e.target.closest('.move-up-btn');
            if (moveUpBtn) {
                const id = parseInt(moveUpBtn.dataset.id);
                const index = quotationState.items.findIndex(i => i.id === id);
                if (index > 0) {
                    [quotationState.items[index - 1], quotationState.items[index]] = [quotationState.items[index], quotationState.items[index - 1]];
                    renderItemsForm();
                }
            }

            const moveDownBtn = e.target.closest('.move-down-btn');
            if (moveDownBtn) {
                const id = parseInt(moveDownBtn.dataset.id);
                const index = quotationState.items.findIndex(i => i.id === id);
                if (index < quotationState.items.length - 1) {
                    [quotationState.items[index + 1], quotationState.items[index]] = [quotationState.items[index], quotationState.items[index + 1]];
                    renderItemsForm();
                }
            }
        });

        document.getElementById('generateImageBtn').addEventListener('click', () => {
            const elementToCapture = document.getElementById('quotation-preview-content');
            html2canvas(elementToCapture, { scale: 2, useCORS: true }).then(canvas => {
                const imageURL = canvas.toDataURL('image/png');
                const downloadLink = document.createElement('a');
                downloadLink.href = imageURL;
                downloadLink.download = `${quotationState.documentTitle}_${quotationState.quotationNumber}.png`;
                downloadLink.click();
            });
        });

        document.getElementById('swapConverterBtn').addEventListener('click', () => {
            isRmbToAriary = !isRmbToAriary;
            document.getElementById('converterInput').value = '';
            updateConverterUI();
        });
        document.getElementById('converterInput').addEventListener('input', updateConverter);
        document.getElementById('exchangeRateInput').addEventListener('input', ()=>{
            syncStateWithForm();
            updateConverter();
        });

        updateConverterUI();
    }
    // ================== FIN: LOGIQUE DE L'OUTIL DE QUOTATION INTÉGRÉ ==================

    // ================== LOGIQUE ADMIN ==================
    const adminSection = document.getElementById('page-admin');
    
    // HTML de l'outil de quotation à insérer dans le modal
    const quotationToolHTML = `
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Générateur de Document</h1>
                <p class="text-lg text-gray-500">Inspiré par le format Aridago Expert Service</p>
            </div>
            <div id="quotation-tool-form" class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-8">
                    <div class="quotation-form-section">
                        <h2>Informations Générales</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="documentTitleSelect" class="block text-sm font-medium text-gray-700 mb-1">Type de Document</label>
                                <select id="documentTitleSelect" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                                    <option value="QUOTATION">Quotation</option>
                                    <option value="DEVIS">Devis</option>
                                </select>
                            </div>
                            <div>
                                <label for="quotationNumber" class="block text-sm font-medium text-gray-700 mb-1">Numéro de Référence</label>
                                <input type="text" id="quotationNumber" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label for="quotationDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                <input type="date" id="quotationDate" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label for="quotationCity" class="block text-sm font-medium text-gray-700 mb-1">Ville</label>
                                <input type="text" id="quotationCity" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                            </div>
                        </div>
                    </div>
                    <div class="quotation-form-section">
                        <h2>CONSIGNÉE (Client)</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label for="clientName" class="block text-sm font-medium text-gray-700 mb-1">Nom du client</label><input type="text" id="clientName" class="w-full p-2 border border-gray-300 rounded-md"></div>
                            <div><label for="clientPhone" class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label><input type="text" id="clientPhone" class="w-full p-2 border border-gray-300 rounded-md"></div>
                            <div><label for="clientEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="clientEmail" class="w-full p-2 border border-gray-300 rounded-md"></div>
                            <div><label for="clientAddress" class="block text-sm font-medium text-gray-700 mb-1">Adresse</label><input type="text" id="clientAddress" class="w-full p-2 border border-gray-300 rounded-md"></div>
                        </div>
                    </div>
                    <div class="quotation-form-section">
                        <h2>Articles</h2>
                        <div id="items-container" class="space-y-4"></div>
                        <button id="addItemBtn" class="mt-4 bg-red-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-600 transition-colors">Ajouter une ligne</button>
                    </div>
                     <div class="quotation-form-section">
                        <h2>Pied de Page</h2>
                        <div class="grid grid-cols-1 gap-6">
                            <div><label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Note importante</label><textarea id="notes" rows="3" class="w-full p-2 border border-gray-300 rounded-md"></textarea></div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="paymentMethodSelect" class="block text-sm font-medium text-gray-700 mb-1">Mode de paiement</label>
                                    <select id="paymentMethodSelect" class="w-full p-2 border border-gray-300 rounded-md">
                                        <option>Espèces</option><option>Mvola</option><option>Airtel Money</option><option>Orange Money</option>
                                    </select>
                                </div>
                                 <div><label for="exchangeRateInput" class="block text-sm font-medium text-gray-700 mb-1">Cours de change (1 RMB en Ariary)</label><input type="number" id="exchangeRateInput" class="w-full p-2 border border-gray-300 rounded-md"></div>
                            </div>
                            <div><label for="senderInfo" class="block text-sm font-medium text-gray-700 mb-1">Informations de l'expéditeur</label><input type="text" id="senderInfo" class="w-full p-2 border border-gray-300 rounded-md"></div>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-1">
                    <div class="quotation-form-section sticky top-8">
                        <h2 class="text-center">Action</h2>
                        <div class="text-center my-6">
                            <span class="text-3xl font-bold text-gray-800" id="totalDisplay">0.00 Ar</span>
                            <p class="text-gray-500">Total</p>
                        </div>
                        <button id="generateImageBtn" class="w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-600 transition-colors text-lg">Télécharger l'Aperçu (Image)</button>
                    </div>
                    <div class="quotation-form-section sticky top-48">
                        <div class="flex justify-between items-center">
                            <h2 class="text-center mb-0 border-b-0 pb-0">Convertisseur</h2>
                            <button id="swapConverterBtn" title="Inverser la conversion" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
                            </button>
                        </div>
                        <div class="mt-4"><label id="converterInputLabel" for="converterInput" class="block text-sm font-medium text-gray-700 mb-1"></label><input type="number" id="converterInput" class="w-full p-2 border border-gray-300 rounded-md"></div>
                        <div class="mt-4 text-center">
                            <p id="converterOutputLabel" class="text-sm text-gray-500"></p><p id="converterOutputResult" class="text-2xl font-bold text-green-600"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="quotation-form-section mt-8">
                <h2>Aperçu du Document</h2>
                <div id="quotation-preview-content"></div>
            </div>
        </div>
    `;

    adminSection.innerHTML = `
        <div class="bg-slate-800 text-white p-6 md:p-10 rounded-3xl shadow-lg">
            <div id="admin-login">
                <h2 class="font-poppins text-3xl font-bold text-center mb-4">Accès Administrateur</h2>
                <div class="max-w-sm mx-auto">
                    <div class="mb-4"><label for="admin-email" class="block text-sm font-semibold mb-1">Email</label><input type="email" id="admin-email" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div>
                    <div class="mb-4"><label for="admin-password" class="block text-sm font-semibold mb-1">Mot de passe</label><input type="password" id="admin-password" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div>
                    <button id="admin-login-btn" class="mt-4 w-full btn-primary font-bold py-3 px-4 rounded-xl">Se connecter</button>
                    <p id="admin-error" class="text-red-400 text-center mt-2 hidden"></p>
                </div>
            </div>
            <div id="admin-dashboard" class="hidden">
                <h2 class="font-poppins text-3xl font-bold mb-6">Tableau de bord</h2>
                <div class="bg-gray-700 p-6 rounded-2xl mb-8">
                    <h3 id="admin-form-title" class="text-xl font-bold mb-4">Ajouter un nouveau produit</h3>
                    <form id="admin-product-form" class="space-y-4">
                        <input type="hidden" id="product-id">
                        <div><label class="block text-sm font-semibold mb-1">Nom</label><input type="text" id="product-name" required class="w-full bg-gray-600 rounded-lg p-2 text-white"></div>
                        <div><label class="block text-sm font-semibold mb-1">Description</label><textarea id="product-description" required class="w-full bg-gray-600 rounded-lg p-2 text-white" rows="2"></textarea></div>
                        <div><label class="block text-sm font-semibold mb-1">Prix (Ar)</label><input type="number" id="product-price" required class="w-full bg-gray-600 rounded-lg p-2 text-white"></div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Image(s)</label>
                            <div class="flex flex-wrap gap-2 mt-2 items-center">
                                <div id="image-preview-container" class="flex flex-wrap gap-2"></div>
                                <label for="product-image-upload" class="cursor-pointer w-16 h-16 bg-gray-600 rounded flex items-center justify-center text-gray-400 hover:bg-gray-500 hover:text-white transition"><i class="fas fa-plus"></i></label>
                            </div>
                            <input type="file" id="product-image-upload" multiple accept="image/*" class="hidden">
                            <input type="hidden" id="product-images-json">
                            <p id="upload-status" class="text-sm text-yellow-400 mt-1"></p>
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                            <button type="submit" id="admin-submit-btn" class="w-full btn-secondary font-bold py-2 px-4 rounded-lg disabled:opacity-50">Ajouter</button>
                            <button type="button" id="admin-cancel-btn" class="w-full bg-gray-500 font-bold py-2 px-4 rounded-lg hidden">Annuler</button>
                        </div>
                    </form>
                </div>
                <div>
                     <h3 class="text-xl font-bold mb-4">Produits existants</h3>
                     <div id="admin-product-list" class="space-y-4"></div>
                </div>
                 <div class="mt-8 pt-6 border-t border-gray-700 flex flex-col sm:flex-row gap-4">
                    <button id="admin-logout-btn" class="bg-red-600 font-bold py-2 px-4 rounded-lg">Se déconnecter</button>
                    <button id="open-quotation-tool-btn" class="bg-blue-600 font-bold py-2 px-4 rounded-lg">Générateur de Devis/Quotation</button>
                </div>
            </div>
        </div>
        <div id="quotation-tool-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-70 hidden items-start justify-center overflow-y-auto p-4">
            <div class="relative bg-gray-100 rounded-lg shadow-xl w-full max-w-7xl my-8">
                <button id="close-quotation-tool-btn" class="absolute top-2 right-4 text-gray-500 hover:text-gray-800 text-3xl font-bold z-10">&times;</button>
                <div class="p-4 lg:p-8">
                    ${quotationToolHTML}
                </div>
            </div>
        </div>
    [cite_start]`; [cite: 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, 202]

    [cite_start]const adminLogin = document.getElementById('admin-login'); [cite: 203]
    [cite_start]const adminDashboard = document.getElementById('admin-dashboard'); [cite: 203]
    [cite_start]const adminEmailInput = document.getElementById('admin-email'); [cite: 203]
    [cite_start]const adminPasswordInput = document.getElementById('admin-password'); [cite: 203]
    [cite_start]const adminLoginBtn = document.getElementById('admin-login-btn'); [cite: 203]
    [cite_start]const adminError = document.getElementById('admin-error'); [cite: 204]
    [cite_start]const adminLogoutBtn = document.getElementById('admin-logout-btn'); [cite: 204]
    [cite_start]const adminProductForm = document.getElementById('admin-product-form'); [cite: 204]
    [cite_start]const adminProductList = document.getElementById('admin-product-list'); [cite: 204]
    
    [cite_start]const deleteConfirmModal = document.getElementById('delete-confirm-modal'); [cite: 204]
    [cite_start]const confirmDeleteBtn = document.getElementById('confirm-delete-btn'); [cite: 205]
    [cite_start]const cancelDeleteBtn = document.getElementById('cancel-delete-btn'); [cite: 205]
    
    // Modal de l'outil de quotation
    const quotationToolModal = document.getElementById('quotation-tool-modal');
    const openQuotationToolBtn = document.getElementById('open-quotation-tool-btn');
    const closeQuotationToolBtn = document.getElementById('close-quotation-tool-btn');

    openQuotationToolBtn.addEventListener('click', () => {
        quotationToolModal.style.display = 'flex';
        if (!isQuotationToolInitialized) {
            initQuotationTool();
            isQuotationToolInitialized = true;
        }
    });

    closeQuotationToolBtn.addEventListener('click', () => {
        quotationToolModal.style.display = 'none';
    });
    
    auth.onAuthStateChanged(user => {
        if (user) {
            adminLogin.classList.add('hidden');
            adminDashboard.classList.remove('hidden');
            renderAdminList();
        } else {
            adminLogin.classList.remove('hidden');
            adminDashboard.classList.add('hidden');
        }
    [cite_start]}); [cite: 206]

    adminLoginBtn.addEventListener('click', () => {
        const email = adminEmailInput.value;
        const password = adminPasswordInput.value;
        auth.signInWithEmailAndPassword(email, password)
            .catch(error => {
                adminError.textContent = "Email ou mot de passe incorrect.";
                adminError.classList.remove('hidden');
            [cite_start]}); [cite: 207]
    });

    adminLogoutBtn.addEventListener('click', () => {
        auth.signOut();
        showPage('page-accueil');
    });
    [cite_start]const productImageUpload = document.getElementById('product-image-upload'); [cite: 208]
    [cite_start]const uploadStatus = document.getElementById('upload-status'); [cite: 208]
    [cite_start]const hiddenImagesJson = document.getElementById('product-images-json'); [cite: 208]
    [cite_start]const imagePreviewContainer = document.getElementById('image-preview-container'); [cite: 208]
    [cite_start]async function uploadToImgBB(file) { [cite: 209]
        [cite_start]const formData = new FormData(); [cite: 209]
        [cite_start]formData.append('image', file); [cite: 209]
        [cite_start]const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData }); [cite: 210]
        [cite_start]if (!response.ok) throw new Error('Échec du téléversement'); [cite: 210]
        [cite_start]const data = await response.json(); [cite: 211]
        [cite_start]return data.data.url; [cite: 211]
    }

    productImageUpload.addEventListener('change', async (e) => {
        const files = e.target.files;
        if (!files.length) return;
        uploadStatus.textContent = `Téléversement de ${files.length} image(s)...`;
        document.getElementById('admin-submit-btn').disabled = true;
        
        let currentImages = hiddenImagesJson.value ? JSON.parse(hiddenImagesJson.value) : [];

        try {
            [cite_start]const uploadPromises = Array.from(files).map(uploadToImgBB); [cite: 212]
            [cite_start]const imageUrls = await Promise.all(uploadPromises); [cite: 212]
            [cite_start]currentImages.push(...imageUrls); [cite: 212]
            [cite_start]hiddenImagesJson.value = JSON.stringify(currentImages); [cite: 212]
            [cite_start]renderImagePreviews(currentImages); [cite: 212]
            [cite_start]uploadStatus.textContent = `${currentImages.length} image(s) prête(s).`; [cite: 212]
        } catch (error) {
            [cite_start]uploadStatus.textContent = `Erreur: ${error.message}`; [cite: 213]
        } finally {
            document.getElementById('admin-submit-btn').disabled = false;
            [cite_start]e.target.value = ''; [cite: 214]
        }
    });

    function renderImagePreviews(images) {
        imagePreviewContainer.innerHTML = '';
        [cite_start]images.forEach((imgUrl, index) => { [cite: 215]
            [cite_start]imagePreviewContainer.innerHTML += `<div class="relative"><img src="${imgUrl}" class="w-16 h-16 object-cover rounded"><button type="button" class="absolute -top-1 -right-1 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold delete-img-btn" data-index="${index}">&times;</button></div>`; [cite: 215]
        });
        [cite_start]document.querySelectorAll('.delete-img-btn').forEach(btn => btn.addEventListener('click', (e) => { [cite: 216]
            [cite_start]const index = parseInt(e.currentTarget.dataset.index, 10); [cite: 216]
            [cite_start]let currentImages = JSON.parse(hiddenImagesJson.value); [cite: 216]
            [cite_start]currentImages.splice(index, 1); [cite: 216]
            [cite_start]hiddenImagesJson.value = JSON.stringify(currentImages); [cite: 216]
            [cite_start]renderImagePreviews(currentImages); [cite: 216]
        [cite_start]})); [cite: 216]
    [cite_start]} [cite: 217]

    [cite_start]const adminFormTitle = document.getElementById('admin-form-title'); [cite: 217]
    [cite_start]const adminSubmitBtn = document.getElementById('admin-submit-btn'); [cite: 217]
    [cite_start]const adminCancelBtn = document.getElementById('admin-cancel-btn'); [cite: 217]
    [cite_start]adminProductForm.addEventListener('submit', async (e) => { [cite: 218]
        [cite_start]e.preventDefault(); [cite: 218]
        [cite_start]const id = document.getElementById('product-id').value; [cite: 218]
        [cite_start]const productData = { [cite: 218]
            [cite_start]name: document.getElementById('product-name').value, [cite: 218]
            [cite_start]description: document.getElementById('product-description').value, [cite: 218]
            [cite_start]price: parseFloat(document.getElementById('product-price').value), [cite: 218]
            [cite_start]images: JSON.parse(hiddenImagesJson.value || '[]') [cite: 218]
        };

        [cite_start]adminSubmitBtn.disabled = true; [cite: 219]
        try {
            if (id) {
                await productsCollection.doc(id).update(productData);
            } else {
                await productsCollection.add(productData);
            }
            [cite_start]resetAdminForm(); [cite: 220]
            [cite_start]await loadAndRenderProducts(); [cite: 220]
        } catch (error) {
            console.error("Erreur d'écriture Firestore: ", error);
            alert("Une erreur s'est produite.");
        } finally {
            adminSubmitBtn.disabled = false;
        [cite_start]} [cite: 221]
    });

    [cite_start]adminCancelBtn.addEventListener('click', resetAdminForm); [cite: 221]

    function resetAdminForm() {
        adminProductForm.reset();
        [cite_start]document.getElementById('product-id').value = ''; [cite: 222]
        [cite_start]hiddenImagesJson.value = '[]'; [cite: 222]
        [cite_start]uploadStatus.textContent = ''; [cite: 222]
        [cite_start]imagePreviewContainer.innerHTML = ''; [cite: 222]
        adminSubmitBtn.textContent = 'Ajouter';
        [cite_start]adminFormTitle.textContent = 'Ajouter un nouveau produit'; [cite: 223]
        [cite_start]adminCancelBtn.classList.add('hidden'); [cite: 223]
    }
    
    [cite_start]cancelDeleteBtn.addEventListener('click', () => { [cite: 223]
        [cite_start]deleteConfirmModal.style.display = 'none'; [cite: 223]
    [cite_start]}); [cite: 223]
    [cite_start]confirmDeleteBtn.addEventListener('click', async () => { [cite: 224]
        [cite_start]const id = confirmDeleteBtn.dataset.id; [cite: 224]
        [cite_start]if (id) { [cite: 224]
            try {
                await productsCollection.doc(id).delete();
                await loadAndRenderProducts();
            } catch (error) {
                [cite_start]console.error("Erreur de suppression: ", error); [cite: 225]
                [cite_start]alert("Une erreur s'est produite lors de la suppression."); [cite: 225]
            } finally {
                [cite_start]deleteConfirmModal.style.display = 'none'; [cite: 225]
            }
        }
    });
    [cite_start]function renderAdminList() { [cite: 226]
        [cite_start]if (!adminProductList) return; [cite: 226]
        adminProductList.innerHTML = '';
        [cite_start]boutiqueProducts.forEach(p => { [cite: 227]
            [cite_start]adminProductList.innerHTML += `<div class="bg-gray-600 p-3 rounded-lg flex items-center justify-between"><div><p class="font-bold">${p.name}</p><p class="text-sm text-gray-400">${p.price.toLocaleString('fr-FR')} Ar</p></div><div class="flex space-x-2"><button class="edit-product-btn bg-blue-500 px-3 py-1 rounded text-white text-sm" data-id="${p.id}">Modifier</button><button class="delete-product-btn bg-red-500 px-3 py-1 rounded text-white text-sm" data-id="${p.id}">Supprimer</button></div></div>`; [cite: 227]
        });
        [cite_start]document.querySelectorAll('.edit-product-btn').forEach(btn => btn.addEventListener('click', (e) => { [cite: 228]
            [cite_start]const id = e.currentTarget.dataset.id; [cite: 228]
            [cite_start]const product = boutiqueProducts.find(p => p.id === id); [cite: 228]
            [cite_start]document.getElementById('product-id').value = product.id; [cite: 228]
            [cite_start]document.getElementById('product-name').value = product.name; [cite: 228]
            [cite_start]document.getElementById('product-description').value = product.description; [cite: 228]
            [cite_start]document.getElementById('product-price').value = product.price; [cite: 228]
            [cite_start]hiddenImagesJson.value = JSON.stringify(product.images || []); [cite: 229]
            [cite_start]renderImagePreviews(product.images || []); [cite: 229]
            [cite_start]adminFormTitle.textContent = 'Modifier le produit'; [cite: 229]
            [cite_start]adminSubmitBtn.textContent = 'Mettre à jour'; [cite: 229]
            [cite_start]adminCancelBtn.classList.remove('hidden'); [cite: 229]
            [cite_start]adminSection.scrollIntoView({ behavior: 'smooth' }); [cite: 229]
        [cite_start]})); [cite: 228]
        [cite_start]document.querySelectorAll('.delete-product-btn').forEach(btn => btn.addEventListener('click', (e) => { [cite: 230]
            [cite_start]const id = e.currentTarget.dataset.id; [cite: 230]
            [cite_start]confirmDeleteBtn.dataset.id = id; [cite: 230]
            [cite_start]deleteConfirmModal.style.display = 'flex'; [cite: 230]
        [cite_start]})); [cite: 230]
    [cite_start]} [cite: 231]

    // ================== APPEL INITIAL ==================
    [cite_start]showPage('page-accueil'); [cite: 231]
    [cite_start]loadAndRenderProducts(); [cite: 231]
    [cite_start]initSearchFunctionality(); [cite: 231]
});
</script>
</body>
</html>
