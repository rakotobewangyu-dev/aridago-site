<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aridago - Boutique et Devis</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            [cite_start]font-family: 'Poppins', sans-serif; [cite: 1]
            [cite_start]background-color: #FFFBEB; [cite: 2]
        }
        :root {
            [cite_start]--primary-color: #d92a2a; [cite: 3]
            [cite_start]--secondary-color: #f7b731; [cite: 3]
        }
        .nav-link-underline::after {
            [cite_start]content: ''; [cite: 4]
            [cite_start]position: absolute; [cite: 4]
            [cite_start]bottom: -4px; [cite: 4]
            [cite_start]left: 0; [cite: 4]
            [cite_start]width: 0; [cite: 4]
            [cite_start]height: 2px; [cite: 4]
            [cite_start]background-color: var(--primary-color); [cite: 4]
            [cite_start]transition: width 0.3s; [cite: 4]
        }
        .nav-link-underline:hover::after, .nav-link-active::after {
            [cite_start]width: 100%; [cite: 5]
        }
        .text-gradient {
            [cite_start]background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); [cite: 6]
            [cite_start]-webkit-background-clip: text; [cite: 7]
            [cite_start]-webkit-text-fill-color: transparent; [cite: 7]
        }
        .btn-primary {
            [cite_start]background: linear-gradient(90deg, #d92a2a, #f7b731); [cite: 8]
            [cite_start]color: white; [cite: 8]
        }
        .btn-secondary {
            [cite_start]background-color: #2ab57d; [cite: 9]
            [cite_start]color: white; [cite: 9]
        }
        .btn-secondary:hover {
            [cite_start]background-color: #2a9d8f; [cite: 10]
        }
        .btn-whatsapp {
            [cite_start]background: linear-gradient(90deg, #25D366, #128C7E); [cite: 11]
            [cite_start]color: white; [cite: 11]
        }
        .theme-gradient-text {
            [cite_start]background: linear-gradient(90deg, #d92a2a, #f7b731); [cite: 12]
            [cite_start]-webkit-background-clip: text; [cite: 12]
            [cite_start]-webkit-text-fill-color: transparent; [cite: 12]
        }
        .theme-gradient-bg { 
            [cite_start]background: linear-gradient(90deg, #d92a2a, #f7b731); [cite: 13]
        }
        .modal-backdrop { 
            [cite_start]background-color: rgba(0,0,0,0.6); [cite: 14]
            [cite_start]display: flex; [cite: 14]
            [cite_start]align-items: center; [cite: 14]
            [cite_start]justify-content: center; [cite: 14]
        }
        .hidden {
            [cite_start]display: none; [cite: 15]
        }
        .rotate-180 {
            [cite_start]transform: rotate(180deg); [cite: 16]
        }
        #confirmation-modal, #price-alert-modal, #link-alert-modal, #delete-confirm-modal {
            [cite_start]display: none; [cite: 17]
        }

        /* DÉBUT DE L'AJOUT : Styles pour l'outil de devis */
        .form-section {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            margin-bottom: 2rem;
        }
        .form-section h2 {
            border-bottom: 2px solid #ef4444;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
        }
        #quotation-preview {
            background: white;
            border: 1px solid #e5e7eb;
            font-family: 'Helvetica', 'Arial', sans-serif;
            color: #111827;
            border-radius: 0.5rem;
            overflow: hidden;
            border: 2px solid #facc15;
        }
        #quotation-preview table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }
        #quotation-preview th, #quotation-preview td {
            border: 1px solid #d1d5db;
            padding: 0.75rem;
            font-size: 0.85rem;
        }
        #quotation-preview th {
            background-color: #16a34a;
            color: white;
            font-weight: bold;
        }
        #quotation-preview .text-right { text-align: right; }
        #quotation-preview .text-center { text-align: center; }
        #quotation-preview .font-bold { font-weight: bold; }
        /* FIN DE L'AJOUT */
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-2 sm:px-4 py-2 flex justify-between items-center">
            <div class="flex items-center space-x-2 sm:space-x-4">
                <a href="#" class="nav-link flex-shrink-0" data-page="accueil">
                     [cite_start]<img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="h-14 md:h-16 w-auto"> [cite: 18]
                </a>
                <nav class="flex items-center space-x-2 text-xs sm:space-x-4 md:space-x-6 sm:text-sm md:text-base">
                    [cite_start]<a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline nav-link-active" data-page="accueil">Accueil</a> [cite: 19]
                    [cite_start]<a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline" data-page="boutique">Boutique</a> [cite: 19]
                    [cite_start]<a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline" data-page="devis">Devis</a> [cite: 19]
                    [cite_start]<a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline" data-page="apropos">À Propos</a> [cite: 19]
                </nav>
            </div>
            
            [cite_start]<div class="flex items-center"> [cite: 20]
                [cite_start]<button id="admin-link-header" class="text-slate-700 hover:text-red-600 text-lg p-2"><i class="fas fa-user-shield"></i></button> [cite: 20]
            </div>
        </div>
    </header>

    [cite_start]<div style="background: linear-gradient(90deg, #d92a2a, #f7b731);" class="text-white text-center py-2"> [cite: 21]
        [cite_start]<p class="text-sm font-semibold px-2">Votre partenaire d'achat en Chine | [cite: 22]
[cite_start]Simple, rapide et fiable</p> [cite: 22]
    </div>

    <main>
        <section id="page-accueil" class="page-content">
            <div class="relative bg-slate-900 text-white flex items-center justify-center min-h-[500px] overflow-hidden">
                <div class="absolute inset-0 bg-cover bg-center opacity-30" style="background-image: url('https://images.unsplash.com/photo-1578575437130-5278ce685a21?auto=format&fit=crop&w=1500&q=80');"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/50 to-transparent"></div>
                [cite_start]<div class="relative text-center max-w-3xl px-4 z-10"> [cite: 23]
                    <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">Commander en Chine ?<br>C'est maintenant <span class="text-gradient">simple et rapide !</span></h1>
                    <p class="text-lg md:text-xl text-slate-300 mb-8">Nous sommes votre intermédiaire de confiance pour tous vos achats en Chine, livrés à Madagascar.</p>
                    [cite_start]<a href="#" class="btn-primary font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 shadow-lg nav-link" data-page="devis">Faire une commande</a> [cite: 24]
                </div>
            </div>
        </section>

        <section id="page-admin" class="page-content hidden container mx-auto px-4 py-16"></section>
    </main>
    
    <footer class="bg-slate-900 text-white">
        </footer>

    <div id="quotation-tool-modal" class="fixed inset-0 z-[100] bg-black bg-opacity-70 hidden items-start justify-center overflow-y-auto p-4">
        <div class="relative bg-gray-100 rounded-lg shadow-xl w-full max-w-7xl my-8">
            <button id="close-quotation-tool-btn" class="absolute top-2 right-4 text-gray-500 hover:text-gray-800 text-3xl font-bold z-10">&times;</button>
            <div class="p-4 lg:p-8">
                </div>
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', function() {
    
    // ===================================================================
    // DÉBUT DE L'AJOUT : LOGIQUE ET HTML DE L'OUTIL DE QUOTATION
    // ===================================================================

    let isQuotationToolInitialized = false;

    const quotationToolHTML = `
        <div class="max-w-7xl mx-auto">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Générateur de Document</h1>
                <p class="text-lg text-gray-500">Inspiré par le format Aridago Expert Service</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-8">
                    
                    <div class="form-section">
                        <h2>Informations Générales</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="documentTitleSelect" class="block text-sm font-medium text-gray-700 mb-1">Type de Document</label>
                                <select id="documentTitleSelect" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                                    <option value="QUOTATION">Quotation</option>
                                    <option value="DEVIS">Devis</option>
                                </select>
                            </div>
                            <div>
                                <label for="quotationNumber" class="block text-sm font-medium text-gray-700 mb-1">Numéro de Référence</label>
                                <input type="text" id="quotationNumber" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500" value="0000000001">
                            </div>
                            <div>
                                <label for="quotationDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                <input type="date" id="quotationDate" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                            </div>
                            <div>
                                <label for="quotationCity" class="block text-sm font-medium text-gray-700 mb-1">Ville</label>
                                <input type="text" id="quotationCity" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500" value="Antananarivo">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2>CONSIGNÉE (Client)</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="clientName" class="block text-sm font-medium text-gray-700 mb-1">Nom du client</label>
                                <input type="text" id="clientName" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500" value="Nom du client">
                            </div>
                            <div>
                                <label for="clientPhone" class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                                <input type="text" id="clientPhone" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500" value="+261 34 00 0000 00">
                            </div>
                            <div>
                                <label for="clientEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                <input type="email" id="clientEmail" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500" value="nomprenom@exemple.com">
                            </div>
                            <div>
                                <label for="clientAddress" class="block text-sm font-medium text-gray-700 mb-1">Adresse</label>
                                <input type="text" id="clientAddress" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500" value="Antananarivo, centre-ville 123">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h2>Articles</h2>
                        <div id="items-container" class="space-y-4"></div>
                        <button id="addItemBtn" class="mt-4 bg-red-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-600 transition-colors">
                            Ajouter une ligne
                        </button>
                    </div>

                     <div class="form-section">
                        <h2>Pied de Page</h2>
                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                <label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Note importante</label>
                                <textarea id="notes" rows="3" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">Les frais de transport Chine à Madagascar ne sont pas inclus dans cette Quotation.</textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="paymentMethodSelect" class="block text-sm font-medium text-gray-700 mb-1">Mode de paiement</label>
                                    <select id="paymentMethodSelect" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                                        <option>Espèces</option>
                                        <option>Mvola</option>
                                        <option>Airtel Money</option>
                                        <option>Orange Money</option>
                                    </select>
                                </div>
                                 <div>
                                    <label for="exchangeRateInput" class="block text-sm font-medium text-gray-700 mb-1">Cours de change (1 RMB en Ariary)</label>
                                    <input type="number" id="exchangeRateInput" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500" value="700">
                                </div>
                            </div>
                            <div>
                                <label for="senderInfo" class="block text-sm font-medium text-gray-700 mb-1">Informations de l'expéditeur</label>
                                <input type="text" id="senderInfo" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500" value="Mr. Wang Yu (+86 15600021123)">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-1">
                    <div class="form-section sticky top-8">
                        <h2 class="text-center">Action</h2>
                        <div class="text-center my-6">
                            <span class="text-3xl font-bold text-gray-800" id="totalDisplay">0.00 Ar</span>
                            <p class="text-gray-500">Total</p>
                        </div>
                        <button id="generateImageBtn" class="w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-600 transition-colors text-lg">
                            Télécharger l'Aperçu (Image)
                        </button>
                    </div>
                    
                    <div class="form-section sticky top-48">
                        <div class="flex justify-between items-center">
                            <h2 class="text-center mb-0 border-b-0 pb-0">Convertisseur</h2>
                            <button id="swapConverterBtn" title="Inverser la conversion" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>
                            </button>
                        </div>
                        <div class="mt-4">
                            <label id="converterInputLabel" for="converterInput" class="block text-sm font-medium text-gray-700 mb-1"></label>
                            <input type="number" id="converterInput" class="w-full p-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500">
                        </div>
                        <div class="mt-4 text-center">
                            <p id="converterOutputLabel" class="text-sm text-gray-500"></p>
                            <p id="converterOutputResult" class="text-2xl font-bold text-green-600"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section mt-8">
                <h2>Aperçu du Document</h2>
                <div id="quotation-preview">
                    </div>
            </div>
        </div>
    `;

    function initializeQuotationTool() {
        const logoTopLeftUrl = "https://i.ibb.co/HDBqLXCT/Aridago-Logo-removebg-preview.png";
        const logoBottomRightUrl = "https://i.ibb.co/mFyw1zmW/Sary-sonia.png";
        let state = {
            documentTitle: 'QUOTATION',
            quotationNumber: '0000000001',
            quotationDate: new Date().toISOString().split('T')[0],
            quotationCity: 'Antananarivo',
            clientName: 'Nom du client',
            clientPhone: '+261 34 00 0000 00',
            clientEmail: 'nomprenom@exemple.com',
            clientAddress: 'Antananarivo, centre-ville 123',
            items: [
                { id: 2, description: 'Produit 2', quantity: 2, price: 30000, isText: false, directPrice: 0, align: 'left' },
                { id: 1, description: 'Produit 1', quantity: 1, price: 100000, isText: false, directPrice: 0, align: 'left' },
                { id: 3, description: 'Dédouanement + Fret', quantity: 0, price: 0, isText: true, directPrice: 50000, align: 'left' }
            ],
            notes: 'Les frais de transport Chine à Madagascar ne sont pas inclus dans cette Quotation.',
            paymentMethod: 'Espèces',
            exchangeRate: 700,
            senderInfo: 'Mr. Wang Yu (+86 15600021123)',
        };
        let isRmbToAriary = true;
        function getFormattedDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString + 'T00:00:00');
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            let formatted = new Intl.DateTimeFormat('fr-FR', options).format(date);
            return formatted.charAt(0).toUpperCase() + formatted.slice(1);
        }
        function renderQuotationPreview() {
            const previewContainer = document.getElementById('quotation-preview');
            let tableRows = '';
            let total = 0;
            state.items.forEach(item => {
                const isSpecialItem = item.description.trim().toLowerCase() === 'dédouanement + fret';
                if (item.isText || isSpecialItem) {
                    const directPrice = item.directPrice || 0;
                    total += directPrice;
                    tableRows += `
                        <tr>
                            <td colspan="3" class="font-bold" style="text-align: ${item.align || 'left'};">${item.description}</td>
                            <td class="text-right font-bold">${directPrice.toLocaleString('fr-FR')}</td>
                        </tr>
                    `;
                } else {
                    const itemTotal = item.quantity * item.price;
                    total += itemTotal;
                    tableRows += `
                        <tr>
                            <td style="text-align: ${item.align || 'left'};">${item.description}</td>
                            <td class="text-center">${item.quantity.toLocaleString('fr-FR')}</td>
                            <td class="text-right">${item.price.toLocaleString('fr-FR')}</td>
                            <td class="text-right">${itemTotal.toLocaleString('fr-FR')}</td>
                        </tr>
                    `;
                }
            });
            const totalRmb = state.exchangeRate > 0 ? total / state.exchangeRate : 0;
            tableRows += `
                <tr style="background-color: #f3f4f6;">
                    <td colspan="3" class="text-right font-bold" style="font-size: 1.1rem;">TOTAUX</td>
                    <td class="text-right font-bold" style="font-size: 1.1rem;">
                        ${total.toLocaleString('fr-FR')} Ar
                        <br>
                        <span style="font-size: 0.9rem; font-weight: 500;">(${totalRmb.toFixed(2)} RMB)</span>
                    </td>
                </tr>
            `;
            let paymentTermsText = `(1) Mode de paiement: ${state.paymentMethod}\n(2) Prix de Change: 1 RMB = ${state.exchangeRate} Ariary`;
            let signatureHtml = '';
            if (state.documentTitle === 'DEVIS') {
                signatureHtml = `<img src="${logoBottomRightUrl}" alt="Signature" style="width: 160px; height: auto; margin-left: auto; margin-top: 0.5rem;">`;
            }
            previewContainer.innerHTML = `
                <div style="background-color: #fefce8; padding: 1.5rem 2rem; border-bottom: 3px solid #f59e0b;">
                     <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div><img src="${logoTopLeftUrl}" alt="Aridago Logo" style="width: 180px; height: auto;"></div>
                        <div class="text-right">
                            <h3 style="font-size: 2.5rem; font-weight: 700; color: #000000; line-height: 1;">${state.documentTitle}</h3>
                            <p style="margin-top: 0.5rem;"><strong>Numéro :</strong> ${state.quotationNumber}</p>
                        </div>
                    </div>
                </div>
                <div style="padding: 2rem;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; align-items: end; margin-bottom: 2rem;">
                         <div>
                            <p style="background-color: #e5e7eb; padding: 0.25rem 0.5rem; display: inline-block; font-weight: bold; margin-bottom: 0.5rem; border-radius: 4px;">CONSIGNÉE À :</p>
                            <p><span class="font-bold">Nom :</span> ${state.clientName}</p>
                            <p><span class="font-bold">Tél :</span> ${state.clientPhone}</p>
                            <p><span class="font-bold">Email :</span> ${state.clientEmail}</p>
                            <p><span class="font-bold">Adresse :</span> ${state.clientAddress}</p>
                        </div>
                        <p class="text-right"><strong>${state.quotationCity}</strong>, ${getFormattedDate(state.quotationDate)}</p>
                    </div>
                    <table>
                        <thead><tr><th>DESCRIPTION</th><th>QUANTITÉ</th><th>PRIX UNITAIRE (Ar)</th><th>TOTAL (Ar)</th></tr></thead>
                        <tbody>${tableRows}</tbody>
                    </table>
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 2rem; align-items: start;">
                        <div style="font-size: 0.8rem;">
                            <div style="margin-bottom: 1rem;"><p class="font-bold">Note importante:</p><p style="white-space: pre-wrap;">${state.notes}</p></div>
                             <div><p class="font-bold">Terme de paiement:</p><p style="white-space: pre-wrap;">${paymentTermsText}</p></div>
                        </div>
                        <div style="text-align: right;">
                             <p class="font-bold">Expéditeur</p>${signatureHtml}<p style="margin-top: 1rem;">${state.senderInfo}</p>
                        </div>
                    </div>
                </div>
            `;
        }
        function renderItemsForm() {
            const container = document.getElementById('items-container');
            container.innerHTML = '';
            state.items.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = 'grid grid-cols-12 gap-2 items-center';
                const isSpecialItem = item.description.trim().toLowerCase() === 'dédouanement + fret';
                const standardInputs = `<div class="col-span-3 md:col-span-2"><input type="number" placeholder="Qté" data-id="${item.id}" data-field="quantity" value="${item.quantity}" class="w-full p-2 border border-gray-300 rounded-md"></div><div class="col-span-4 md:col-span-2"><input type="number" placeholder="P.U. (Ar)" data-id="${item.id}" data-field="price" value="${item.price}" class="w-full p-2 border border-gray-300 rounded-md"></div>`;
                const textOnlyInput = `<div class="col-span-7 md:col-span-4"><input type="number" placeholder="Prix Total (Ar)" data-id="${item.id}" data-field="directPrice" value="${item.directPrice || 0}" class="w-full p-2 border border-gray-300 rounded-md"></div>`;
                row.innerHTML = `
                    <div class="col-span-12 md:col-span-3"><input type="text" placeholder="Description" data-id="${item.id}" data-field="description" value="${item.description}" class="w-full p-2 border border-gray-300 rounded-md"></div>
                    <div class="col-span-12 md:col-span-1 flex items-center justify-start space-x-1">
                        <button title="Aligner à gauche" data-id="${item.id}" data-align="left" class="align-btn p-1 rounded ${item.align === 'left' ? 'bg-blue-500 text-white' : 'bg-gray-200'}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h10M4 18h16" /></svg></button>
                        <button title="Centrer" data-id="${item.id}" data-align="center" class="align-btn p-1 rounded ${item.align === 'center' ? 'bg-blue-500 text-white' : 'bg-gray-200'}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M7 12h10M4 18h16" /></svg></button>
                        <button title="Aligner à droite" data-id="${item.id}" data-align="right" class="align-btn p-1 rounded ${item.align === 'right' ? 'bg-blue-500 text-white' : 'bg-gray-200'}"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M10 12h10M4 18h16" /></svg></button>
                    </div>
                    ${item.isText || isSpecialItem ? textOnlyInput : standardInputs}
                    <div class="col-span-3 md:col-span-2 flex items-center justify-center">
                        <input type="checkbox" data-id="${item.id}" data-field="isText" class="h-5 w-5 text-red-600 focus:ring-red-500 border-gray-300 rounded" ${item.isText || isSpecialItem ? 'checked' : ''} ${isSpecialItem ? 'disabled' : ''}>
                        <label class="ml-2 text-sm text-gray-600">Texte seul</label>
                    </div>
                    <div class="col-span-1 flex flex-col items-center justify-center">
                        <button title="Monter" data-id="${item.id}" class="move-up-btn p-1 rounded ${index === 0 ? 'opacity-25 cursor-not-allowed' : 'hover:bg-gray-200'}" ${index === 0 ? 'disabled' : ''}><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg></button>
                        <button title="Descendre" data-id="${item.id}" class="move-down-btn p-1 rounded ${index === state.items.length - 1 ? 'opacity-25 cursor-not-allowed' : 'hover:bg-gray-200'}" ${index === state.items.length - 1 ? 'disabled' : ''}><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>
                    </div>
                    <div class="col-span-1 text-right">
                        <button data-id="${item.id}" class="removeItemBtn bg-red-100 text-red-600 p-2 rounded-full hover:bg-red-200 transition-colors"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                    </div>`;
                container.appendChild(row);
            });
            updateTotalAndPreview();
        }
        function updateTotalAndPreview() {
            const total = state.items.reduce((acc, item) => {
                const isSpecialItem = item.description.trim().toLowerCase() === 'dédouanement + fret';
                if (item.isText || isSpecialItem) {
                    return acc + (item.directPrice || 0);
                } else {
                    return acc + (item.quantity * item.price);
                }
            }, 0);
            const totalRmb = state.exchangeRate > 0 ? total / state.exchangeRate : 0;
            document.getElementById('totalDisplay').innerHTML = `${total.toLocaleString('fr-FR')} Ar<br><span class="text-xl font-semibold text-gray-500">(${totalRmb.toFixed(2)} RMB)</span>`;
            renderQuotationPreview();
        }
        function syncStateWithForm() {
            state.documentTitle = document.getElementById('documentTitleSelect').value;
            state.quotationNumber = document.getElementById('quotationNumber').value;
            state.quotationDate = document.getElementById('quotationDate').value;
            state.quotationCity = document.getElementById('quotationCity').value;
            state.clientName = document.getElementById('clientName').value;
            state.clientPhone = document.getElementById('clientPhone').value;
            state.clientEmail = document.getElementById('clientEmail').value;
            state.clientAddress = document.getElementById('clientAddress').value;
            state.notes = document.getElementById('notes').value;
            state.paymentMethod = document.getElementById('paymentMethodSelect').value;
            state.exchangeRate = parseFloat(document.getElementById('exchangeRateInput').value) || 0;
            state.senderInfo = document.getElementById('senderInfo').value;
            updateTotalAndPreview();
        }
        function updateConverterUI() {
            const inputLabel = document.getElementById('converterInputLabel');
            const outputLabel = document.getElementById('converterOutputLabel');
            const converterInput = document.getElementById('converterInput');
            if (isRmbToAriary) {
                inputLabel.textContent = 'Montant en RMB (¥)';
                outputLabel.textContent = 'Équivalent en Ariary';
                converterInput.placeholder = 'Entrez la valeur en RMB';
            } else {
                inputLabel.textContent = 'Montant en Ariary (Ar)';
                outputLabel.textContent = 'Équivalent en RMB';
                converterInput.placeholder = 'Entrez la valeur en Ariary';
            }
            updateConverter();
        }
        function updateConverter() {
            const amount = parseFloat(document.getElementById('converterInput').value) || 0;
            const resultEl = document.getElementById('converterOutputResult');
            const exchangeRate = state.exchangeRate;
            if (isRmbToAriary) {
                const calculatedAriary = amount * exchangeRate;
                resultEl.textContent = `${calculatedAriary.toLocaleString('fr-FR')} Ar`;
            } else {
                const calculatedRmb = exchangeRate > 0 ? amount / exchangeRate : 0;
                resultEl.textContent = `${calculatedRmb.toFixed(2).replace('.', ',')} RMB`;
            }
        }
        
        // Initialisation des listeners et de l'état
        document.getElementById('documentTitleSelect').value = state.documentTitle;
        document.getElementById('quotationDate').value = state.quotationDate;
        document.getElementById('paymentMethodSelect').value = state.paymentMethod;
        document.getElementById('exchangeRateInput').value = state.exchangeRate;
        document.querySelector('.lg\\:col-span-2').addEventListener('input', syncStateWithForm);
        document.getElementById('addItemBtn').addEventListener('click', () => {
            state.items.push({ id: Date.now(), description: '', quantity: 1, price: 0, isText: false, directPrice: 0, align: 'left' });
            renderItemsForm();
        });
        document.getElementById('items-container').addEventListener('change', (e) => {
            if (e.target.dataset.id) {
                const id = parseInt(e.target.dataset.id);
                const field = e.target.dataset.field;
                const item = state.items.find(i => i.id === id);
                if (item) {
                    if (e.target.type === 'checkbox') {
                        item[field] = e.target.checked;
                    } else if (e.target.type === 'number') {
                        item[field] = parseFloat(e.target.value) || 0;
                    } else {
                        item[field] = e.target.value;
                    }
                    if (item.description.trim().toLowerCase() === 'dédouanement + fret') {
                        item.isText = true;
                    }
                }
                renderItemsForm();
            }
        });
        document.getElementById('items-container').addEventListener('click', (e) => {
            const removeItemBtn = e.target.closest('.removeItemBtn');
            if (removeItemBtn) {
                const id = parseInt(removeItemBtn.dataset.id);
                state.items = state.items.filter(i => i.id !== id);
                renderItemsForm();
            }
            const alignBtn = e.target.closest('.align-btn');
            if(alignBtn){
                const id = parseInt(alignBtn.dataset.id);
                const align = alignBtn.dataset.align;
                const item = state.items.find(i => i.id === id);
                if(item){
                    item.align = align;
                    renderItemsForm();
                }
            }
            const moveUpBtn = e.target.closest('.move-up-btn');
            if (moveUpBtn) {
                const id = parseInt(moveUpBtn.dataset.id);
                const index = state.items.findIndex(i => i.id === id);
                if (index > 0) {
                    [state.items[index - 1], state.items[index]] = [state.items[index], state.items[index - 1]];
                    renderItemsForm();
                }
            }
            const moveDownBtn = e.target.closest('.move-down-btn');
            if (moveDownBtn) {
                const id = parseInt(moveDownBtn.dataset.id);
                const index = state.items.findIndex(i => i.id === id);
                if (index < state.items.length - 1) {
                    [state.items[index + 1], state.items[index]] = [state.items[index], state.items[index + 1]];
                    renderItemsForm();
                }
            }
        });
        document.getElementById('generateImageBtn').addEventListener('click', () => {
            const elementToCapture = document.getElementById('quotation-preview');
            html2canvas(elementToCapture, { scale: 2, useCORS: true }).then(canvas => {
                const imageURL = canvas.toDataURL('image/png');
                const downloadLink = document.createElement('a');
                downloadLink.href = imageURL;
                downloadLink.download = `${state.documentTitle}_${state.quotationNumber}.png`;
                downloadLink.click();
            });
        });
        document.getElementById('swapConverterBtn').addEventListener('click', () => {
            isRmbToAriary = !isRmbToAriary;
            document.getElementById('converterInput').value = '';
            updateConverterUI();
        });
        document.getElementById('converterInput').addEventListener('input', updateConverter);
        document.getElementById('exchangeRateInput').addEventListener('input', updateConverter);

        renderItemsForm();
        updateConverterUI();
    }

    // ===================================================================
    // FIN : LOGIQUE ET HTML DE L'OUTIL DE QUOTATION
    // ===================================================================


    // ================== LOGIQUE ORIGINALE DU SITE (ADAPTÉE) ==================
    const firebaseConfig = { /* ... */ }; // Config déjà définie en haut
    [cite_start]const IMGBB_API_KEY = '7dfb12ff69d1e1f349a28e4a788f2c1d'; [cite: 119]
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    [cite_start]const productsCollection = db.collection('products'); [cite: 120]
    let boutiqueProducts = [];

    // Navigation
    const pages = document.querySelectorAll('.page-content');
    const navLinks = document.querySelectorAll('.nav-link');
    function showPage(pageId) { /* ... */ } // La fonction reste la même
    navLinks.forEach(link => { /* ... */ });
    document.getElementById('admin-link-header').addEventListener('click', () => showPage('page-admin'));

    // Logique Boutique et Devis
    // Toutes les fonctions originales (loadAndRenderProducts, createProductCard, etc.)
    // sont conservées ici, sans modification.

    // ================== LOGIQUE ADMIN (MODIFIÉE) ==================
    const adminSection = document.getElementById('page-admin');

    // On génère le HTML de la page admin en incluant le bouton pour l'outil
    adminSection.innerHTML = `
        <div class="bg-slate-800 text-white p-6 md:p-10 rounded-3xl shadow-lg">
            <div id="admin-login">
                [cite_start]<h2 class="font-poppins text-3xl font-bold text-center mb-4">Accès Administrateur</h2> [cite: 192]
                <div class="max-w-sm mx-auto">
                    [cite_start]<div class="mb-4"><label for="admin-email" class="block text-sm font-semibold mb-1">Email</label><input type="email" id="admin-email" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div> [cite: 193]
                    [cite_start]<div class="mb-4"><label for="admin-password" class="block text-sm font-semibold mb-1">Mot de passe</label><input type="password" id="admin-password" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div> [cite: 193]
                    [cite_start]<button id="admin-login-btn" class="mt-4 w-full btn-primary font-bold py-3 px-4 rounded-xl">Se connecter</button> [cite: 193]
                    [cite_start]<p id="admin-error" class="text-red-400 text-center mt-2 hidden"></p> [cite: 194]
                </div>
            </div>
            <div id="admin-dashboard" class="hidden">
                [cite_start]<h2 class="font-poppins text-3xl font-bold mb-6">Tableau de bord</h2> [cite: 194]
                 <div class="mt-8 pt-6 border-t border-gray-700 flex flex-col sm:flex-row gap-4">
                    <button id="admin-logout-btn" class="bg-red-600 font-bold py-2 px-4 rounded-lg">Se déconnecter</button>
                    <button id="open-quotation-tool-btn" class="bg-blue-600 font-bold py-2 px-4 rounded-lg">Ouvrir l'Outil de Devis</button>
                    </div>
            </div>
        </div>
    `;

    // Listeners pour les nouveaux éléments
    const quotationToolModal = document.getElementById('quotation-tool-modal');
    const openQuotationToolBtn = document.getElementById('open-quotation-tool-btn');
    const closeQuotationToolBtn = document.getElementById('close-quotation-tool-btn');

    openQuotationToolBtn.addEventListener('click', () => {
        quotationToolModal.style.display = 'flex';
        if (!isQuotationToolInitialized) {
            // On injecte le HTML de l'outil et on initialise ses scripts
            quotationToolModal.querySelector('.p-4').innerHTML = quotationToolHTML;
            initializeQuotationTool();
            isQuotationToolInitialized = true;
        }
    });

    closeQuotationToolBtn.addEventListener('click', () => {
        quotationToolModal.style.display = 'none';
    });

    // Le reste du script d'administration (login, gestion des produits, etc.)
    // est conservé ici, sans modification.

});
</script>
</body>
</html>
