<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aridago - Boutique et Devis</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #FFFBEB; /* Fond clair du thème Aridago */
        }
        /* Couleurs du thème Aridago */
        :root {
            --primary-color: #d92a2a; /* Rouge Aridago */
            --secondary-color: #f7b731; /* Jaune/Orange Aridago */
        }
        .nav-link-underline::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary-color);
            transition: width 0.3s;
        }
        .nav-link-underline:hover::after, .nav-link-active::after {
            width: 100%;
        }
        .text-gradient {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-primary {
             background: linear-gradient(90deg, #d92a2a, #f7b731);
             color: white;
        }
        .btn-secondary {
            background-color: #2ab57d; /* Vert pour certains boutons d'action */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #2a9d8f;
        }
        .btn-whatsapp {
            background: linear-gradient(90deg, #25D366, #128C7E);
            color: white;
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- En-tête -->
    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-2 flex justify-between items-center">
            <!-- Groupe Logo + Nav -->
            <div class="flex items-center space-x-4 md:space-x-8">
                <a href="#" class="nav-link" data-page="accueil">
                     <img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="h-16 w-auto">
                </a>
                <nav class="flex items-center space-x-2 md:space-x-6 text-sm md:text-base">
                    <a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline nav-link-active" data-page="accueil">Accueil</a>
                    <a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline" data-page="boutique">Boutique</a>
                    <a href="#" class="font-semibold text-slate-700 hover:text-red-600 relative nav-link nav-link-underline" data-page="devis">Devis</a>
                </nav>
            </div>
            
            <!-- Icône Admin -->
            <div class="flex items-center">
                <button id="admin-link-header" class="text-slate-700 hover:text-red-600 text-lg"><i class="fas fa-user-shield"></i></button>
            </div>
        </div>
    </header>

    <!-- Bannière promotionnelle -->
    <div style="background: linear-gradient(90deg, #d92a2a, #f7b731);" class="text-white text-center py-2">
        <p class="text-sm font-semibold">Votre partenaire d'achat en Chine | Simple, rapide et fiable</p>
    </div>

    <!-- Contenu principal qui change en fonction de la navigation -->
    <main>

        <!-- =========== PAGE D'ACCUEIL =========== -->
        <section id="page-accueil" class="page-content">
            <!-- Bannière Héro -->
            <div class="relative bg-slate-900 text-white flex items-center justify-center min-h-[500px] overflow-hidden">
                <div class="absolute inset-0 bg-cover bg-center opacity-30" style="background-image: url('https://images.unsplash.com/photo-1578575437130-5278ce685a21?auto=format&fit=crop&w=1500&q=80');"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/50 to-transparent"></div>
                <div class="relative text-center max-w-3xl px-4 z-10">
                    <h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">Commander en Chine ?<br>C'est maintenant <span class="text-gradient">simple et rapide !</span></h1>
                    <p class="text-lg md:text-xl text-slate-300 mb-8">Nous sommes votre intermédiaire de confiance pour tous vos achats en Chine, livrés à Madagascar.</p>
                    <a href="#" class="btn-primary font-bold py-3 px-8 rounded-full transition duration-300 transform hover:scale-105 shadow-lg nav-link" data-page="devis">Faire une commande</a>
                </div>
            </div>

            <!-- Section Services/avantages -->
            <section class="bg-white py-16">
                <div class="container mx-auto px-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 text-center">
                        <div class="feature">
                            <i class="fas fa-search-dollar text-4xl text-red-600 mb-4"></i>
                            <h3 class="font-bold text-lg mb-2">Recherche de produits</h3>
                            <p class="text-slate-600">Nous trouvons pour vous les meilleurs produits au meilleur prix.</p>
                        </div>
                        <div class="feature">
                            <i class="fas fa-handshake text-4xl text-red-600 mb-4"></i>
                            <h3 class="font-bold text-lg mb-2">Intermédiaire de confiance</h3>
                            <p class="text-slate-600">Nous gérons l'achat, la vérification et le paiement pour vous.</p>
                        </div>
                        <div class="feature">
                            <i class="fas fa-shipping-fast text-4xl text-red-600 mb-4"></i>
                            <h3 class="font-bold text-lg mb-2">Transport sécurisé</h3>
                            <p class="text-slate-600">Nous nous occupons de l'expédition de la Chine vers Madagascar.</p>
                        </div>
                    </div>
                </div>
            </section>

             <!-- Section des produits populaires sur l'accueil -->
            <div id="popular-products-accueil" class="py-16"></div>
        </section>

        <!-- =========== PAGE BOUTIQUE =========== -->
        <section id="page-boutique" class="page-content hidden">
            <div class="container mx-auto px-4 py-16">
                 <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-2">Notre Boutique</h2>
                    <p class="text-slate-600 text-lg">Commandez directement nos articles sélectionnés pour vous, déjà à Madagascar.</p>
                     <div class="mt-6 max-w-lg mx-auto relative flex items-center">
                        <input type="text" id="search-bar" placeholder="Rechercher un produit..." class="w-full pl-6 pr-12 py-3 border-2 border-slate-200 rounded-full focus:outline-none focus:ring-2 focus:ring-red-400 transition">
                        <button id="search-btn" class="absolute right-0 top-0 h-full w-12 flex items-center justify-center text-white rounded-r-full hover:opacity-90" style="background-color: var(--secondary-color);">
                            <i class="fas fa-search"></i>
                        </button>
                     </div>
                 </div>
                 <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                    <p id="loading-products" class="text-center text-gray-500 col-span-full">Chargement des produits...</p>
                 </div>
            </div>
        </section>

        <!-- =========== PAGE DEVIS SUR MESURE =========== -->
        <section id="page-devis" class="page-content hidden">
             <!-- Le contenu de la page de devis est injecté par JavaScript -->
        </section>

        <!-- =========== PAGE DETAIL PRODUIT =========== -->
        <section id="page-detail" class="page-content hidden bg-white py-12"></section>

        <!-- =========== PAGE ADMIN =========== -->
        <section id="page-admin" class="page-content hidden container mx-auto px-4 py-16"></section>

    </main>
    
    <!-- Pied de page -->
    <footer class="bg-slate-900 text-white">
        <div class="container mx-auto px-4 py-10">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <!-- Colonne 1: A propos -->
                <div>
                     <img src="https://i.imgur.com/JFtWbuc.png" alt="Logo Aridago" class="h-16 w-auto mb-4">
                    <p class="text-slate-400 mb-4">Votre intermédiaire d'achat N°1 en Chine. Qualité, confiance et service client.</p>
                    <div class="flex space-x-4">
                        <a href="https://www.facebook.com/Aridagochine/" target="_blank" class="w-10 h-10 bg-slate-700 hover:bg-red-600 rounded-full flex items-center justify-center transition-colors"><i class="fab fa-facebook-f"></i></a>
                    </div>
                </div>
                 <!-- Colonne 2: Liens rapides -->
                <div>
                     <h3 class="text-xl font-bold mb-4 relative pb-2 after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-10 after:h-0.5 after:bg-secondary-color">Liens Rapides</h3>
                     <ul class="space-y-2">
                        <li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="accueil">Accueil</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="boutique">Boutique</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white nav-link" data-page="devis">Devis sur Mesure</a></li>
                     </ul>
                </div>
                 <!-- Colonne 3: Contact -->
                 <div>
                     <h3 class="text-xl font-bold mb-4 relative pb-2 after:content-[''] after:absolute after:left-0 after:bottom-0 after:w-10 after:h-0.5 after:bg-secondary-color">Contact</h3>
                     <ul class="space-y-3 text-slate-400">
                         <li class="flex items-start"><i class="fab fa-whatsapp w-5 mt-1 text-green-400"></i><span>+86 156 0002 1123</span></li>
                         <li class="flex items-start"><i class="fas fa-envelope w-5 mt-1"></i><span>aridagoservice@hotmail.com</span></li>
                     </ul>
                </div>
            </div>
            <div class="text-center pt-8 border-t border-slate-700">
                <p class="text-slate-500">&copy; <span id="year"></span> Aridago - Tous droits réservés.</p>
            </div>
        </div>
    </footer>

    <!-- BOUTON FLOTTANT FACEBOOK -->
    <a href="https://www.facebook.com/Aridagochine/" target="_blank" class="fixed bottom-6 right-6 bg-blue-600 hover:bg-blue-700 text-white w-16 h-16 rounded-full flex items-center justify-center shadow-xl transform hover:scale-110 transition z-40" title="Contactez-nous sur Facebook">
        <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v2.385z"></path></svg>
    </a>

    <!-- SDKs Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyBa93ZQ34S4JEz6lc7yt_2ZrIiTc2Jqh9c",
      authDomain: "boutique-aridago.firebaseapp.com",
      projectId: "boutique-aridago",
      storageBucket: "boutique-aridago.appspot.com",
      messagingSenderId: "173722302642",
      appId: "1:173722302642:web:1cad436874f3b4270eb1ab"
    };
    const IMGBB_API_KEY = '7dfb12ff69d1e1f349a28e4a788f2c1d';

    // Initialisation de Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();
    const productsCollection = db.collection('products');

document.addEventListener('DOMContentLoaded', function() {
    let boutiqueProducts = [];
    
    // ================== GESTION DE LA NAVIGATION (Single Page App) ==================
    const pages = document.querySelectorAll('.page-content');
    const navLinks = document.querySelectorAll('.nav-link');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuToggle = document.getElementById('menu-toggle');
    const menuClose = document.getElementById('menu-close');

    function showPage(pageId) {
        pages.forEach(page => {
            const isTargetPage = page.id === pageId;
            page.classList.toggle('hidden', !isTargetPage);
        });
        
        document.querySelectorAll('header .nav-link, #mobile-menu .nav-link').forEach(link => {
             const isTargetLink = `page-${link.dataset.page}` === pageId;
            link.classList.toggle('nav-link-active', isTargetLink);
            if (link.parentElement.tagName === 'NAV') { // Only apply color to header links
                 link.classList.toggle('text-red-600', isTargetLink);
            }
        });

        window.scrollTo(0, 0);
    }

    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const pageId = `page-${this.dataset.page}`;
            showPage(pageId);
            if (mobileMenu) mobileMenu.classList.add('hidden');
        });
    });

    if (menuToggle) {
        menuToggle.addEventListener('click', () => {
            mobileMenu.classList.remove('hidden');
        });
    }
    if (menuClose) {
        menuClose.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
        });
    }
    
    document.getElementById('admin-link-header').addEventListener('click', () => showPage('page-admin'));
    
    // Initialisation
    showPage('page-accueil');
    document.getElementById('year').textContent = new Date().getFullYear();

    // ================== LOGIQUE BOUTIQUE ==================
    async function loadAndRenderProducts() {
        try {
            const snapshot = await productsCollection.orderBy("name").get();
            
            if (snapshot.empty) {
                console.log("Firebase est vide. Utilisation des produits d'exemple.");
                boutiqueProducts = [
                    { id: 'mock1', name: 'Sac à dos de voyage Pro', description: 'Imperméable, grande capacité avec de multiples compartiments. Idéal pour les voyages et le quotidien.', price: 125000, images: ['https://i.imgur.com/v14n2v4.jpeg', 'https://i.imgur.com/1z4kY9M.jpeg'] },
                    { id: 'mock2', name: 'Thermos intelligent LED', description: 'Affiche la température, conserve la chaleur pendant 12h. Acier inoxydable de haute qualité.', price: 65000, images: ['https://i.imgur.com/5J7Rz72.jpeg'] },
                    { id: 'mock3', name: 'Montre connectée Sport', description: 'Suivi cardiaque, GPS intégré, étanche IP68 et multiples modes sportifs.', price: 210000, images: ['https://i.imgur.com/eBq62vJ.jpeg', 'https://i.imgur.com/b5k9g7g.jpeg'] },
                    { id: 'mock4', name: 'Mini-projecteur portable HD', description: 'Transformez n\'importe quel mur en cinéma. Compact, léger et compatible avec tous vos appareils.', price: 350000, images: ['https://i.imgur.com/e692w9d.jpeg'] },
                    { id: 'mock5', name: 'Casque audio sans fil Pro', description: 'Son haute-fidélité, réduction de bruit active et autonomie de 20h.', price: 180000, images: ['https://i.imgur.com/0a2b5n3.jpeg'] },
                    { id: 'mock6', name: 'Mini Drone 4K', description: 'Facile à piloter, caméra 4K et design pliable pour l\'emporter partout.', price: 420000, images: ['https://i.imgur.com/kP0b4Yw.jpeg'] }
                ];
            } else {
                boutiqueProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            }
            
            renderBoutique();
            renderPopularProducts(boutiqueProducts.slice(0, 4));

            if (auth.currentUser) {
                renderAdminList();
            }
        } catch (error) {
            console.error("Erreur de chargement: ", error);
            if(document.getElementById('loading-products')) {
                document.getElementById('loading-products').textContent = 'Erreur de chargement des produits.';
            }
        }
    }

    loadAndRenderProducts();

    function renderBoutique(searchTerm = '') {
        const productGrid = document.getElementById('product-grid');
        const loadingText = document.getElementById('loading-products');
        if (!productGrid || !loadingText) return;

        const searchBar = document.getElementById('search-bar');
        const lowerCaseSearchTerm = (searchTerm || searchBar.value).toLowerCase();
        
        const filteredProducts = boutiqueProducts.filter(p => {
            const name = (p.name || '').toLowerCase();
            const description = (p.description || '').toLowerCase();
            return name.includes(lowerCaseSearchTerm) || description.includes(lowerCaseSearchTerm);
        });
        
        loadingText.style.display = 'none';

        if (boutiqueProducts.length === 0) {
             productGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">Aucun produit n'a été publié pour le moment.</p>`;
        } else if (filteredProducts.length === 0) {
            productGrid.innerHTML = `<p class="text-center text-gray-500 col-span-full">Aucun produit ne correspond à votre recherche.</p>`;
        } else {
            productGrid.innerHTML = filteredProducts.map(createProductCard).join('');
        }
        
        addProductCardListeners();
    }
    
    function addProductCardListeners() {
        document.querySelectorAll('.view-product-btn').forEach(btn => {
            btn.addEventListener('click', e => {
                const productId = e.currentTarget.dataset.id;
                renderProductDetail(productId);
                showPage('page-detail');
            });
        });
    }

    document.getElementById('search-bar').addEventListener('input', () => renderBoutique());
    document.getElementById('search-btn').addEventListener('click', () => renderBoutique());

    function createProductCard(product) {
        const imageUrl = product.images && product.images.length > 0 ? product.images[0] : 'https://placehold.co/600x400/cccccc/ffffff?text=Image';
        return `
            <div class="bg-white rounded-xl shadow-lg overflow-hidden group transform hover:-translate-y-2 transition-transform duration-300 view-product-btn cursor-pointer" data-id="${product.id}">
                <div class="relative">
                    <img src="${imageUrl}" alt="${product.name}" class="w-full h-64 object-contain p-4">
                    <div class="absolute top-2 left-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full flex items-center">
                        <i class="fas fa-check-circle mr-1"></i> En stock à Mada
                    </div>
                    <div class="absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <span class="text-white btn-primary py-2 px-5 rounded-full transform hover:scale-105 transition-transform">Voir le produit</span>
                    </div>
                </div>
                <div class="p-5 text-center">
                    <h3 class="font-semibold text-lg mb-2 truncate">${product.name}</h3>
                    <p class="text-gradient font-extrabold text-xl">${product.price.toLocaleString('fr-FR')} Ar</p>
                </div>
            </div>`;
    }

    function renderPopularProducts(products) {
        const container = document.getElementById('popular-products-accueil');
        if (!container || products.length === 0) {
            if(container) container.innerHTML = '';
            return;
        }
        container.innerHTML = `
             <div class="container mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-bold mb-2">Produits Populaires</h2>
                    <p class="text-slate-600 text-lg">Les articles les plus demandés par nos clients</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                    ${products.map(createProductCard).join('')}
                </div>
            </div>`;
        addProductCardListeners();
    }

    function renderProductDetail(productId) {
        const product = boutiqueProducts.find(p => p.id === productId); 
        if (!product) return;
        
        let thumbnailsHTML = product.images.map((img, index) => `<img src="${img}" class="w-20 h-20 object-contain bg-slate-100 rounded-md cursor-pointer border-2 ${index === 0 ? 'border-red-500' : 'border-transparent'} thumbnail" data-index="${index}">`).join('');
        
        const productDetailSection = document.getElementById('page-detail');
        productDetailSection.innerHTML = `
        <div class="container mx-auto px-4">
            <button class="nav-link font-semibold mb-8 inline-flex items-center" data-page="boutique"><i class="fas fa-arrow-left mr-2"></i>Retour à la boutique</button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                <div>
                    <div class="bg-slate-100 rounded-xl shadow-lg mb-4">
                        <img id="main-product-image" src="${product.images[0]}" alt="${product.name}" class="w-full h-96 object-contain rounded-xl p-4">
                    </div>
                    <div id="thumbnail-container" class="flex flex-wrap gap-4 justify-center">${thumbnailsHTML}</div>
                </div>
                <div>
                    <h1 class="text-4xl font-bold text-slate-800">${product.name}</h1>
                    <p class="text-4xl font-extrabold text-gradient my-4">${product.price.toLocaleString('fr-FR')} Ar</p>
                    <div class="mt-4 flex items-center text-green-600 font-semibold">
                        <i class="fas fa-check-circle mr-2"></i>Produit disponible à Madagascar
                    </div>
                    <p class="mt-4 text-slate-600 whitespace-pre-wrap">${product.description}</p>
                    <div class="mt-8">
                        <a href="#" data-id="${product.id}" class="order-now-btn w-full inline-flex items-center justify-center text-center btn-secondary transition text-white font-bold py-4 px-4 rounded-xl text-lg"><i class="fab fa-whatsapp mr-3 text-2xl"></i>Commander maintenant</a>
                    </div>
                </div>
            </div>
        </div>`;
        
        productDetailSection.querySelector('.nav-link').addEventListener('click', (e) => {
            e.preventDefault();
            showPage('page-boutique');
        });
        
        productDetailSection.querySelector('.order-now-btn').addEventListener('click', e => {
            e.preventDefault();
            const id = e.currentTarget.dataset.id;
            const p = boutiqueProducts.find(p => p.id === id);
            let orderText = `*COMMANDE DIRECTE ARIDAGO*\n\n- Produit: ${p.name}\n- Prix: ${p.price.toLocaleString('fr-FR')} Ar\n\n(Frais de Livraison non inclus)`;
            window.open(`https://wa.me/8615600021123?text=${encodeURIComponent(orderText)}`, '_blank');
        });

        const mainImage = document.getElementById('main-product-image');
        const thumbnails = document.querySelectorAll('.thumbnail');
        thumbnails.forEach(thumb => {
            thumb.addEventListener('click', e => {
                const index = parseInt(e.currentTarget.dataset.index);
                mainImage.src = product.images[index];
                thumbnails.forEach(t => t.classList.remove('border-red-500'));
                e.currentTarget.classList.add('border-red-500');
            });
        });
    }

    // ================== LOGIQUE DEVIS SUR MESURE ==================
    const devisSection = document.getElementById('page-devis');
    devisSection.innerHTML = `
        <div class="py-16">
            <div class="text-center mb-12">
                 <h1 class="font-poppins text-4xl md:text-5xl font-extrabold text-gray-800 leading-tight">
                    Commander en Chine ?<br>C'est maintenant <span class="text-gradient">simple et rapide !</span>
                </h1>
                <p class="mt-4 text-lg text-gray-600 max-w-2xl mx-auto">
                    Remplissez ce formulaire pour recevoir votre devis personnalisé directement sur WhatsApp.
                </p>
             </div>
             <main class="bg-white p-6 md:p-10 rounded-3xl shadow-lg max-w-4xl mx-auto">
                <form id="devis-form">
                    <fieldset class="border-b-2 border-gray-100 pb-8">
                        <legend class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="w-10 h-10 flex items-center justify-center rounded-full text-white font-bold mr-4" style="background: linear-gradient(90deg, #d92a2a, #f7b731);">1</span> Vos informations
                        </legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                            <div><label for="nom" class="block text-sm font-semibold text-gray-600 mb-1">Nom</label><input type="text" id="nom" name="nom" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div>
                            <div><label for="prenom" class="block text-sm font-semibold text-gray-600 mb-1">Prénom</label><input type="text" id="prenom" name="prenom" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div>
                            <div><label for="whatsapp" class="block text-sm font-semibold text-gray-600 mb-1">Numéro WhatsApp</label><input type="tel" id="whatsapp" name="whatsapp" required class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div>
                            <div><label for="email" class="block text-sm font-semibold text-gray-600 mb-1">Email (Optionnel)</label><input type="email" id="email" name="email" class="w-full bg-gray-100 border-2 border-gray-200 rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div>
                        </div>
                    </fieldset>
                    <fieldset class="mt-8">
                        <legend class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                            <span class="w-10 h-10 flex items-center justify-center rounded-full text-white font-bold mr-4" style="background: linear-gradient(90deg, #d92a2a, #f7b731);">2</span> Vos produits
                        </legend>
                        <div id="product-list" class="space-y-6"></div>
                        <div class="mt-6"><button type="button" id="add-product" class="w-full flex items-center justify-center px-6 py-3 border-2 border-dashed border-red-300 text-sm font-semibold rounded-xl text-red-600 hover:bg-red-50 transition"><svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>Ajouter un autre produit</button></div>
                    </fieldset>
                    <div class="mt-10 text-center">
                        <button type="submit" class="inline-flex justify-center items-center py-4 px-16 text-lg font-bold rounded-xl btn-whatsapp shadow-lg hover:shadow-xl transform hover:scale-105 transition animate-pulse">
                            <i class="fab fa-whatsapp mr-3 text-2xl"></i>
                            Envoyer ma demande
                        </button>
                    </div>
                </form>
            </main>
            <section class="mt-12 bg-white p-6 md:p-10 rounded-3xl shadow-lg max-w-4xl mx-auto">
                 <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Questions fréquentes</h2>
                <div class="space-y-2">
                    <div class="faq-item bg-gray-50 rounded-xl">
                        <button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center">
                            <span>Quels sont les frais de transport Chine-Madagascar ?</span>
                            <i class="fas fa-chevron-down transition-transform"></i>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4 text-gray-600">
                            <p>Les frais de transport ne sont pas inclus dans le devis initial. Ils dépendent du poids et du volume total de votre commande. Nous vous fournirons une estimation détaillée de ces frais lors de la confirmation de votre commande.</p>
                        </div>
                    </div>
                    <div class="faq-item bg-gray-50 rounded-xl">
                         <button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center">
                            <span>Quels sont les délais de livraison estimés ?</span>
                            <i class="fas fa-chevron-down transition-transform"></i>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4 text-gray-600">
                            <p>Les délais varient en fonction du type de transport choisi (aérien ou maritime). En général, comptez entre 7 à 15 jours pour le transport aérien et 30 à 45 jours pour le transport maritime, après réception de tous vos articles dans notre entrepôt en Chine.</p>
                        </div>
                    </div>
                    <div class="faq-item bg-gray-50 rounded-xl">
                        <button class="faq-question w-full text-left font-bold text-gray-800 p-4 flex justify-between items-center">
                            <span>Quels sont les moyens de paiement acceptés ?</span>
                            <i class="fas fa-chevron-down transition-transform"></i>
                        </button>
                        <div class="faq-answer hidden px-4 pb-4 text-gray-600">
                            <p>Pour les paiements en <b>Yuan (CNY)</b>, nous acceptons : Alipay et WeChat Pay.<br>Pour les paiements en <b>Ariary (MGA)</b>, nous acceptons : MVola, Orange Money et Airtel Money.<br>Les détails vous seront communiqués lors de la validation de votre devis.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>`;

    const devisForm = document.getElementById('devis-form'); 
    const devisProductList = document.getElementById('product-list');
    const addProductBtn = document.getElementById('add-product');
    let productCount = 0;
    function createProductBlock() { 
        productCount++; 
        const productDiv = document.createElement('div');
        productDiv.className = 'p-5 border-2 border-gray-200 rounded-xl bg-gray-50/50 relative';
        productDiv.innerHTML = `<h4 class="font-bold text-md text-gray-800 mb-4">Produit ${productCount}</h4> ${productCount > 1 ? '<button type="button" class="absolute top-4 right-4 text-red-500 hover:text-red-700 text-2xl font-bold remove-product">&times;</button>' : ''}<div class="space-y-4"><div><label class="text-sm font-semibold text-gray-600">Nom du produit</label><input type="text" name="product_name_${productCount}" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div><div><label class="text-sm font-semibold text-gray-600">Lien du produit</label><input type="url" name="product_link_${productCount}" required class="link-input w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div><div><label class="text-sm font-semibold text-gray-600">Spécification du Produit (ex: Couleur, Taille)</label><textarea name="product_spec_${productCount}" rows="2" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></textarea></div><div class="grid grid-cols-2 gap-4"><div><label class="text-sm font-semibold text-gray-600">Prix Unitaire (CNY)</label><input type="number" step="0.01" name="product_price_${productCount}" required class="price-input w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div><div><label class="text-sm font-semibold text-gray-600">Quantité</label><input type="number" name="product_quantity_${productCount}" required class="w-full bg-white border-2 border-gray-200 rounded-xl p-3 mt-1"></div></div></div>`; 
        devisProductList.appendChild(productDiv);
        const removeBtn = productDiv.querySelector('.remove-product'); 
        if (removeBtn) removeBtn.addEventListener('click', () => productDiv.remove()); 
    }
    addProductBtn.addEventListener('click', createProductBlock);
    createProductBlock();
    
    devisForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(devisForm);
        const data = Object.fromEntries(formData.entries());
        let devisText = "";
        let totalCny = 0;
        const devisId = `ADG-${Date.now().toString().slice(-6)}`;
        devisText += `*DEMANDE DE DEVIS - ${devisId}*\n*Client:* ${data.nom} ${data.prenom}\n*WhatsApp:* ${data.whatsapp}\n`;
        if (data.email) devisText += `*Email:* ${data.email}\n`;
        devisText += `-----------------------------------\n\n`;
        const products = [];
        const productElements = devisProductList.querySelectorAll('.p-5');
        productElements.forEach((p_el) => {
            const nameInput = p_el.querySelector('input[name^="product_name_"]');
            if (nameInput && nameInput.value) {
                const id = nameInput.name.split('_').pop();
                products.push({
                    name: formData.get(`product_name_${id}`),
                    link: formData.get(`product_link_${id}`),
                    spec: formData.get(`product_spec_${id}`),
                    price: parseFloat(formData.get(`product_price_${id}`)),
                    quantity: parseInt(formData.get(`product_quantity_${id}`), 10)
                });
            }
        });
        products.forEach((p, index) => {
            const subTotal = p.price * p.quantity;
            totalCny += subTotal;
            devisText += `*Produit ${index + 1}:* ${p.name}\n*Spécification:* ${p.spec}\n*Prix Unitaire:* ${p.price.toFixed(2)} CNY\n*Quantité:* ${p.quantity}\n*Lien:* ${p.link}\n*Sous-total:* ${subTotal.toFixed(2)} CNY\n\n`;
        });
        const fraisService = totalCny * 0.10;
        const totalFinalCny = totalCny + fraisService;
        const totalAriary = totalFinalCny * 700;
        devisText += `-----------------------------------\n*Total Produits:* ${totalCny.toFixed(2)} CNY\n*Frais de service (10%):* ${fraisService.toFixed(2)} CNY\n*Total en Yuan:* ${totalFinalCny.toFixed(2)} CNY\n\n*Total en Ariary:* ${totalAriary.toLocaleString('fr-FR')} Ar\n\n*NOTE IMPORTANTE:*\nLes frais de transport Chine à Madagascar ne sont pas inclus dans ce devis.`;
        
        window.open(`https://wa.me/8615600021123?text=${encodeURIComponent(devisText)}`, '_blank');
    });

    document.querySelectorAll('.faq-question').forEach(button => {
        button.addEventListener('click', () => {
            const answer = button.nextElementSibling;
            const icon = button.querySelector('i');
            answer.classList.toggle('hidden');
            icon.classList.toggle('rotate-180');
        });
    });

    // ================== LOGIQUE ADMIN ==================
    const adminSection = document.getElementById('page-admin');
    adminSection.innerHTML = `
        <div class="bg-slate-800 text-white p-6 md:p-10 rounded-3xl shadow-lg">
            <div id="admin-login">
                <h2 class="font-poppins text-3xl font-bold text-center mb-4">Accès Administrateur</h2>
                <div class="max-w-sm mx-auto">
                    <div class="mb-4"><label for="admin-email" class="block text-sm font-semibold mb-1">Email</label><input type="email" id="admin-email" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div>
                    <div class="mb-4"><label for="admin-password" class="block text-sm font-semibold mb-1">Mot de passe</label><input type="password" id="admin-password" class="w-full bg-gray-700 border-2 border-gray-600 rounded-xl p-3 text-white focus:outline-none focus:ring-2 focus:ring-red-400 transition"></div>
                    <button id="admin-login-btn" class="mt-4 w-full btn-primary font-bold py-3 px-4 rounded-xl">Se connecter</button>
                    <p id="admin-error" class="text-red-400 text-center mt-2 hidden"></p>
                </div>
            </div>
            <div id="admin-dashboard" class="hidden">
                <h2 class="font-poppins text-3xl font-bold mb-6">Tableau de bord</h2>
                <div class="bg-gray-700 p-6 rounded-2xl mb-8">
                    <h3 id="admin-form-title" class="text-xl font-bold mb-4">Ajouter un nouveau produit</h3>
                    <form id="admin-product-form" class="space-y-4">
                        <input type="hidden" id="product-id">
                        <div><label class="block text-sm font-semibold mb-1">Nom</label><input type="text" id="product-name" required class="w-full bg-gray-600 rounded-lg p-2 text-white"></div>
                        <div><label class="block text-sm font-semibold mb-1">Description</label><textarea id="product-description" required class="w-full bg-gray-600 rounded-lg p-2 text-white" rows="2"></textarea></div>
                        <div><label class="block text-sm font-semibold mb-1">Prix (Ar)</label><input type="number" id="product-price" required class="w-full bg-gray-600 rounded-lg p-2 text-white"></div>
                        <div>
                            <label class="block text-sm font-semibold mb-1">Image(s)</label>
                            <div class="flex flex-wrap gap-2 mt-2 items-center">
                                <div id="image-preview-container" class="flex flex-wrap gap-2"></div>
                                <label for="product-image-upload" class="cursor-pointer w-16 h-16 bg-gray-600 rounded flex items-center justify-center text-gray-400 hover:bg-gray-500 hover:text-white transition"><i class="fas fa-plus"></i></label>
                            </div>
                            <input type="file" id="product-image-upload" multiple accept="image/*" class="hidden">
                            <input type="hidden" id="product-images-json">
                            <p id="upload-status" class="text-sm text-yellow-400 mt-1"></p>
                        </div>
                        <div class="flex space-x-4">
                            <button type="submit" id="admin-submit-btn" class="w-full btn-secondary font-bold py-2 px-4 rounded-lg disabled:opacity-50">Ajouter</button>
                            <button type="button" id="admin-cancel-btn" class="w-full bg-gray-500 font-bold py-2 px-4 rounded-lg hidden">Annuler</button>
                        </div>
                    </form>
                </div>
                <div>
                     <h3 class="text-xl font-bold mb-4">Produits existants</h3>
                     <div id="admin-product-list" class="space-y-4"></div>
                </div>
                 <button id="admin-logout-btn" class="mt-8 bg-red-600 font-bold py-2 px-4 rounded-lg mr-4">Se déconnecter</button>
            </div>
        </div>
    `;

    const adminLogin = document.getElementById('admin-login');
    const adminDashboard = document.getElementById('admin-dashboard');
    const adminEmailInput = document.getElementById('admin-email');
    const adminPasswordInput = document.getElementById('admin-password');
    const adminLoginBtn = document.getElementById('admin-login-btn');
    const adminError = document.getElementById('admin-error');
    const adminLogoutBtn = document.getElementById('admin-logout-btn');
    const adminProductForm = document.getElementById('admin-product-form');
    const adminProductList = document.getElementById('admin-product-list');

    auth.onAuthStateChanged(user => {
        if (user) {
            adminLogin.classList.add('hidden');
            adminDashboard.classList.remove('hidden');
            renderAdminList();
        } else {
            adminLogin.classList.remove('hidden');
            adminDashboard.classList.add('hidden');
        }
    });

    adminLoginBtn.addEventListener('click', () => {
        const email = adminEmailInput.value;
        const password = adminPasswordInput.value;
        auth.signInWithEmailAndPassword(email, password)
            .catch(error => {
                adminError.textContent = "Email ou mot de passe incorrect.";
                adminError.classList.remove('hidden');
            });
    });

    adminLogoutBtn.addEventListener('click', () => {
        auth.signOut();
        showPage('page-accueil');
    });

    const productImageUpload = document.getElementById('product-image-upload');
    const uploadStatus = document.getElementById('upload-status');
    const hiddenImagesJson = document.getElementById('product-images-json');
    const imagePreviewContainer = document.getElementById('image-preview-container');

    async function uploadToImgBB(file) {
        const formData = new FormData();
        formData.append('image', file);
        const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, { method: 'POST', body: formData });
        if (!response.ok) throw new Error('Échec du téléversement');
        const data = await response.json();
        return data.data.url;
    }

    productImageUpload.addEventListener('change', async (e) => {
        const files = e.target.files;
        if (!files.length) return;
        uploadStatus.textContent = `Téléversement de ${files.length} image(s)...`;
        document.getElementById('admin-submit-btn').disabled = true;
        
        let currentImages = hiddenImagesJson.value ? JSON.parse(hiddenImagesJson.value) : [];

        try {
            const uploadPromises = Array.from(files).map(uploadToImgBB);
            const imageUrls = await Promise.all(uploadPromises);
            currentImages.push(...imageUrls);
            hiddenImagesJson.value = JSON.stringify(currentImages);
            renderImagePreviews(currentImages);
            uploadStatus.textContent = `${currentImages.length} image(s) prête(s).`;
        } catch (error) {
            uploadStatus.textContent = `Erreur: ${error.message}`;
        } finally {
            document.getElementById('admin-submit-btn').disabled = false;
            e.target.value = '';
        }
    });

    function renderImagePreviews(images) {
        imagePreviewContainer.innerHTML = '';
        images.forEach((imgUrl, index) => {
            imagePreviewContainer.innerHTML += `<div class="relative"><img src="${imgUrl}" class="w-16 h-16 object-cover rounded"><button type="button" class="absolute -top-1 -right-1 bg-red-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs font-bold delete-img-btn" data-index="${index}">&times;</button></div>`;
        });
        document.querySelectorAll('.delete-img-btn').forEach(btn => btn.addEventListener('click', (e) => {
            const index = parseInt(e.currentTarget.dataset.index, 10);
            let currentImages = JSON.parse(hiddenImagesJson.value);
            currentImages.splice(index, 1);
            hiddenImagesJson.value = JSON.stringify(currentImages);
            renderImagePreviews(currentImages);
        }));
    }

    const adminFormTitle = document.getElementById('admin-form-title');
    const adminSubmitBtn = document.getElementById('admin-submit-btn');
    const adminCancelBtn = document.getElementById('admin-cancel-btn');
    
    adminProductForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('product-id').value;
        const productData = {
            name: document.getElementById('product-name').value,
            description: document.getElementById('product-description').value,
            price: parseFloat(document.getElementById('product-price').value),
            images: JSON.parse(hiddenImagesJson.value || '[]')
        };

        adminSubmitBtn.disabled = true;
        try {
            if (id) {
                await productsCollection.doc(id).update(productData);
            } else {
                await productsCollection.add(productData);
            }
            resetAdminForm();
            await loadAndRenderProducts();
        } catch (error) {
            console.error("Erreur d'écriture Firestore: ", error);
            alert("Une erreur s'est produite.");
        } finally {
            adminSubmitBtn.disabled = false;
        }
    });

    adminCancelBtn.addEventListener('click', resetAdminForm);

    function resetAdminForm() {
        adminProductForm.reset();
        document.getElementById('product-id').value = '';
        hiddenImagesJson.value = '[]';
        uploadStatus.textContent = '';
        imagePreviewContainer.innerHTML = '';
        adminSubmitBtn.textContent = 'Ajouter';
        adminFormTitle.textContent = 'Ajouter un nouveau produit';
        adminCancelBtn.classList.add('hidden');
    }

    function renderAdminList() {
        adminProductList.innerHTML = '';
        boutiqueProducts.forEach(p => {
            adminProductList.innerHTML += `<div class="bg-gray-600 p-3 rounded-lg flex items-center justify-between"><div><p class="font-bold">${p.name}</p><p class="text-sm text-gray-400">${p.price.toLocaleString('fr-FR')} Ar</p></div><div class="space-x-2"><button class="edit-product-btn bg-blue-500 px-3 py-1 rounded text-white" data-id="${p.id}">Modifier</button><button class="delete-product-btn bg-red-500 px-3 py-1 rounded text-white" data-id="${p.id}">Supprimer</button></div></div>`;
        });
        
        document.querySelectorAll('.edit-product-btn').forEach(btn => btn.addEventListener('click', (e) => {
            const id = e.currentTarget.dataset.id;
            const product = boutiqueProducts.find(p => p.id === id);
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-description').value = product.description;
            document.getElementById('product-price').value = product.price;
            hiddenImagesJson.value = JSON.stringify(product.images);
            renderImagePreviews(product.images);
            adminFormTitle.textContent = 'Modifier le produit';
            adminSubmitBtn.textContent = 'Mettre à jour';
            adminCancelBtn.classList.remove('hidden');
            window.scrollTo(0, adminProductForm.offsetTop);
        }));

        document.querySelectorAll('.delete-product-btn').forEach(btn => btn.addEventListener('click', async (e) => {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce produit ?')) {
                const id = e.currentTarget.dataset.id;
                try {
                    await productsCollection.doc(id).delete();
                    await loadAndRenderProducts();
                } catch (error) {
                    console.error("Erreur de suppression: ", error);
                    alert("Une erreur s'est produite.");
                }
            }
        }));
    }
});
</script>
</body>
</html>

